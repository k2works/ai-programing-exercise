# ぷよぷよゲーム アプリケーション要件定義

## 1. プロジェクト概要

### 1.1 プロジェクト名
ぷよぷよゲーム（PuyoPuyo Game）

### 1.2 目的
- テスト駆動開発（TDD）学習のためのサンプルアプリケーション
- 多言語開発環境におけるベストプラクティスの実践
- Webベースのインタラクティブなパズルゲームの提供

### 1.3 ターゲットユーザー
- プログラミング学習者
- TDD学習者  
- パズルゲーム愛好者
- 技術研修受講者

## 2. 機能要件

### 2.1 ゲーム基本機能

#### 2.1.1 ゲーム初期化機能
- **要件ID**: REQ-GAME-001
- **機能概要**: ゲームの初期状態を設定する
- **詳細**:
  - 6×13のゲームフィールドを生成
  - 初期スコア0に設定
  - 初期連鎖数0に設定
  - プレイヤー操作可能状態に設定

#### 2.1.2 ぷよ生成機能  
- **要件ID**: REQ-PUYO-001
- **機能概要**: ランダムな色のぷよペアを生成する
- **詳細**:
  - 4色（赤・青・緑・黄）からランダム選択
  - メインぷよ・サブぷよの2個1組で生成
  - 次のぷよペアを事前生成して表示

#### 2.1.3 ぷよ操作機能
- **要件ID**: REQ-CONTROL-001  
- **機能概要**: プレイヤーがぷよペアを操作する
- **詳細**:
  - 左右移動（←→キー）
  - 回転（↑キー、4方向回転）
  - 高速落下（↓キー）
  - 一気落下（スペースキー）
  - 自動落下（60フレームごと）

### 2.2 ゲームロジック機能

#### 2.2.1 ぷよ配置機能
- **要件ID**: REQ-LOGIC-001
- **機能概要**: 落下したぷよをフィールドに配置する
- **詳細**:
  - 衝突判定による配置位置決定
  - 回転時の配置可能性判定
  - フィールド境界チェック

#### 2.2.2 ぷよ消去機能
- **要件ID**: REQ-LOGIC-002
- **機能概要**: 4個以上繋がった同色ぷよを消去する
- **詳細**:
  - BFS（幅優先探索）による連結判定
  - 4個以上の同色ぷよグループを特定
  - 該当ぷよの一斉消去

#### 2.2.3 ぷよ落下機能
- **要件ID**: REQ-LOGIC-003
- **機能概要**: 宙に浮いたぷよを重力で落下させる
- **詳細**:
  - 消去後の空間検出
  - ぷよの段階的落下処理
  - 落下完了までの状態管理

#### 2.2.4 連鎖システム
- **要件ID**: REQ-LOGIC-004
- **機能概要**: 連続する消去で高得点を獲得する
- **詳細**:
  - 連鎖回数の自動カウント
  - 指数的スコア倍率適用（1連鎖=1倍、2連鎖=2倍、3連鎖=4倍...）
  - 連鎖終了の自動判定

### 2.3 ゲーム状態管理機能

#### 2.3.1 ゲームオーバー判定
- **要件ID**: REQ-STATE-001
- **機能概要**: ゲーム終了条件を判定する
- **詳細**:
  - 新しいぷよが配置不可能になった時点で終了
  - ゲームオーバー状態表示
  - 操作受付停止

#### 2.3.2 スコア計算機能
- **要件ID**: REQ-SCORE-001
- **機能概要**: 消去したぷよ数に応じてスコアを計算する
- **詳細**:
  - 基本スコア: 消去ぷよ数 × 10点
  - 連鎖ボーナス: 基本スコア × 連鎖倍率
  - リアルタイムスコア更新

#### 2.3.3 ゲームリセット機能
- **要件ID**: REQ-STATE-002
- **機能概要**: ゲームを初期状態に戻す
- **詳細**:
  - フィールドクリア
  - スコア・連鎖数リセット
  - 新しいゲーム開始可能状態への復帰

### 2.4 ユーザーインターフェース機能

#### 2.4.1 ゲーム画面描画
- **要件ID**: REQ-UI-001
- **機能概要**: HTML5 Canvasによるゲーム画面表示
- **詳細**:
  - 384×640ピクセルのメインゲーム画面
  - ぷよの色別描画（32×32ピクセル）
  - 落下中ぷよのハイライト表示
  - グリッドライン表示

#### 2.4.2 情報表示機能  
- **要件ID**: REQ-UI-002
- **機能概要**: ゲーム情報をリアルタイム表示
- **詳細**:
  - 現在スコア表示
  - 連鎖数表示
  - 次のぷよ表示（64×64ピクセル）
  - ゲーム状態表示

#### 2.4.3 操作UI機能
- **要件ID**: REQ-UI-003
- **機能概要**: ゲーム制御のためのUI要素
- **詳細**:
  - Start Gameボタン
  - Resetボタン  
  - 操作説明表示
  - レスポンシブデザイン対応

## 3. 非機能要件

### 3.1 パフォーマンス要件

#### 3.1.1 レスポンス性能
- **要件ID**: REQ-PERF-001
- **指標**: キー入力からゲーム反応まで50ms以内
- **測定方法**: ブラウザ開発者ツールでのパフォーマンス測定

#### 3.1.2 フレームレート
- **要件ID**: REQ-PERF-002  
- **指標**: 60FPS安定動作
- **測定方法**: requestAnimationFrameによるゲームループ監視

#### 3.1.3 メモリ使用量
- **要件ID**: REQ-PERF-003
- **指標**: ブラウザメモリ使用量100MB以下維持
- **測定方法**: ブラウザメモリプロファイラー

### 3.2 ユーザビリティ要件

#### 3.2.1 直感的操作
- **要件ID**: REQ-USE-001
- **指標**: 操作説明なしでも基本操作を把握可能
- **確認方法**: ユーザビリティテスト

#### 3.2.2 視覚的フィードバック
- **要件ID**: REQ-USE-002
- **指標**: ユーザー操作に対する即座の視覚的反応
- **確認方法**: 操作時のアニメーション・色変化確認

### 3.3 可用性要件

#### 3.3.1 ブラウザ互換性
- **要件ID**: REQ-AVAIL-001
- **対象**: Chrome 90+、Firefox 90+、Safari 14+、Edge 90+
- **確認方法**: 各ブラウザでの動作確認

#### 3.3.2 デバイス対応
- **要件ID**: REQ-AVAIL-002
- **対象**: デスクトップ（1920×1080以上）、タブレット（1024×768以上）
- **確認方法**: レスポンシブデザインテスト

### 3.4 保守性要件

#### 3.4.1 テストカバレッジ
- **要件ID**: REQ-MAIN-001
- **指標**: 単体テストカバレッジ90%以上
- **測定方法**: c8カバレッジツール

#### 3.4.2 コード品質
- **要件ID**: REQ-MAIN-002
- **指標**: ESLint・Prettierによる静的解析エラー0件
- **測定方法**: CI/CDパイプラインでの自動チェック

## 4. 技術要件

### 4.1 開発環境要件

#### 4.1.1 プログラミング言語
- **TypeScript 5.8+**: 型安全性とIDEサポート
- **JavaScript ES2020+**: ブラウザ実行環境

#### 4.1.2 ランタイム環境
- **Node.js 22+**: 開発環境・ビルドツール
- **Modern Browser**: HTML5 Canvas・ES2020対応

#### 4.1.3 開発ツールチェーン
- **Vite 7.0+**: 高速ビルド・開発サーバー
- **Vitest 3.2+**: テストフレームワーク
- **ESLint 9.0+**: 静的解析
- **Prettier 3.6+**: コードフォーマット

### 4.2 アーキテクチャ要件

#### 4.2.1 設計原則
- **要件ID**: REQ-ARCH-001
- **原則**: Clean Architecture準拠
- **詳細**:
  - 関心の分離（UI・ビジネスロジック・データ）
  - 依存関係逆転の適用
  - 単一責任原則の遵守

#### 4.2.2 モジュール構成
- **要件ID**: REQ-ARCH-002
- **構成**:
  - `Game`: ゲーム状態管理・制御ロジック
  - `Stage`: フィールド・ぷよ配置管理
  - `Player`: プレイヤー操作・入力処理
  - `Renderer`: 画面描画・視覚表現
  - `Input`: キーボード入力・イベント処理

### 4.3 品質保証要件

#### 4.3.1 テスト駆動開発
- **要件ID**: REQ-QA-001
- **手法**: Red-Green-Refactorサイクル
- **カバレッジ**: 単体テスト64ケース以上

#### 4.3.2 継続的インテグレーション
- **要件ID**: REQ-QA-002
- **要素**:
  - 自動テスト実行
  - 静的解析チェック
  - ビルド成功確認

#### 4.3.3 型安全性
- **要件ID**: REQ-QA-003
- **設定**: TypeScript strict mode有効
- **チェック**: コンパイル時型検証

## 5. 制約事項

### 5.1 技術制約
- シングルページアプリケーション（SPA）として実装
- 外部ライブラリ依存を最小限に抑制
- ネイティブWeb API使用を優先

### 5.2 運用制約  
- 開発環境はDockerコンテナ内で統一
- ローカル開発専用（本番運用想定なし）
- 学習目的での使用に限定

### 5.3 データ制約
- ゲーム進行データの永続化なし
- ユーザーデータ保存機能なし
- セッションベースの一時データのみ

## 6. 受入れ基準

### 6.1 機能受入れ基準
- [ ] すべての基本機能が正常動作する
- [ ] ゲームが完全にプレイ可能である
- [ ] UIが直感的で使いやすい
- [ ] 全テストケースが成功する

### 6.2 品質受入れ基準  
- [ ] TypeScriptコンパイルエラー0件
- [ ] ESLint・Prettierエラー0件
- [ ] テストカバレッジ90%以上
- [ ] パフォーマンス要件を満たす

### 6.3 ドキュメント受入れ基準
- [ ] 要件定義書の完成
- [ ] 設計ドキュメントの完成  
- [ ] テスト仕様書の完成
- [ ] 操作マニュアルの完成

---

**作成日**: 2025年7月20日  
**作成者**: Claude Code  
**バージョン**: 1.0  
**承認者**: プロジェクトオーナー