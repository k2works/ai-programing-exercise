# キャンセル操作ガイド

## 概要

会議室予約システム（MRS）での予約キャンセル機能の操作ガイドです。ユーザー自身の予約キャンセルと管理者権限でのキャンセル操作について説明します。

## 基本的な予約キャンセル（一般ユーザー）

### 1. キャンセル可能な予約の条件

**キャンセル可能**
- 自分が作成した予約
- ステータスが「確定」の予約
- 終了時刻が現在時刻より未来の予約

**キャンセル不可**
- 他人が作成した予約（管理者を除く）
- 既にキャンセル済みの予約
- 終了時刻が過去の予約

### 2. キャンセル操作手順

#### 2.1 予約一覧からのキャンセル

1. **予約一覧の確認**
   - 「マイ予約」タブで自分の予約を表示
   - キャンセル可能な予約には「キャンセル」ボタンが表示

2. **キャンセルダイアログの表示**
   - 対象予約の「キャンセル」ボタンをクリック
   - キャンセル理由入力ダイアログが開く

3. **キャンセル理由の入力**
   - キャンセル理由を入力（必須項目）
   - 文字数制限：500文字以内
   - リアルタイムで文字数カウントが表示

4. **キャンセル実行**
   - 入力内容を確認
   - 「予約をキャンセル」ボタンをクリック
   - 処理中は「キャンセル中...」と表示

5. **完了確認**
   - 成功メッセージが表示
   - 予約一覧が自動更新
   - 予約ステータスが「キャンセル」に変更

### 3. キャンセル理由入力のガイドライン

**推奨される理由の例**
- 会議が延期になりました
- 参加者の都合がつかなくなりました  
- 急用が入りました
- システムトラブルにより会議を開催できません
- 別の会議室に変更します

**避けるべき理由**
- 理由なし（空欄）
- 不適切な表現
- 個人的すぎる詳細情報

## 管理者による予約キャンセル

### 1. 管理者権限の確認

管理者の場合、以下の追加機能が利用可能です：
- 全ユーザーの予約キャンセル
- 管理者専用キャンセル機能
- 詳細な監査ログの記録

### 2. 管理者キャンセル操作手順

#### 2.1 管理パネルからのキャンセル

1. **管理機能の起動**
   - 画面右上の「管理機能」ボタンをクリック
   - 管理者キャンセル機能パネルが表示

2. **対象予約の検索**
   - 予約タイトル、ユーザーID、会議室IDで検索
   - ステータスフィルターで絞り込み
   - 対象予約を特定

3. **管理者権限でのキャンセル**
   - 対象予約の「キャンセル」ボタンをクリック
   - 管理者専用のキャンセルダイアログが表示
   - キャンセル理由と管理者コメントを入力

4. **キャンセル実行と記録**
   - 詳細な監査ログが自動作成
   - 管理者情報、IPアドレス等のセキュリティ情報も記録
   - 不可逆的な監査証跡として保存

#### 2.2 予約一覧からの直接キャンセル

1. **全予約表示**
   - 「全予約」タブで全ユーザーの予約を表示
   - 管理者は他人の予約もキャンセル可能

2. **権限チェック**
   - システムが自動的に管理者権限を確認
   - 一般ユーザーには表示されないキャンセルボタンが表示

3. **通常のキャンセル手順**
   - 一般ユーザーと同じ手順でキャンセル実行
   - 管理者による操作として記録される

## エラーハンドリングとトラブルシューティング

### 1. よくあるエラーと対処法

#### エラーメッセージ一覧

**「キャンセル理由を入力してください。」**
- 原因：理由欄が空欄
- 対処：必須項目のため理由を入力してください

**「キャンセル理由は500文字以内で入力してください。」**
- 原因：文字数制限超過
- 対処：500文字以内に短縮してください

**「この予約をキャンセルする権限がありません。」**
- 原因：他人の予約または管理者権限なし
- 対処：自分の予約のみキャンセル可能、管理者の場合は権限を確認

**「予約が見つかりません。既にキャンセルされている可能性があります。」**
- 原因：予約が存在しないまたは削除済み
- 対処：予約一覧を更新して最新状態を確認

**「この予約は既にキャンセルされています。」**
- 原因：同時操作により既にキャンセル済み
- 対処：予約一覧を更新して確認

**「ネットワークエラーが発生しました。しばらく待ってから再試行してください。」**
- 原因：API接続エラー
- 対処：ネットワーク接続を確認し、時間をおいて再試行

### 2. パフォーマンス関連の問題

**処理が遅い場合**
- 多数の同時アクセス時に発生
- 「キャンセル中...」表示中は操作を控える
- 通常30秒以内に完了

**タイムアウトエラー**
- 処理時間が規定値を超過
- ページを更新して予約状態を確認
- 必要に応じて再度キャンセル操作

## セキュリティとプライバシー

### 1. 監査ログ

**記録される情報**
- 操作実行者
- 操作日時
- 対象予約情報
- キャンセル理由
- IPアドレス
- ブラウザ情報

**監査ログの特徴**
- 改ざん不可能
- 長期保存（データ保持ポリシーに従う）
- 管理者のみ閲覧可能

### 2. データ保護

**個人情報の取り扱い**
- キャンセル理由は適切に暗号化して保存
- 不適切な内容の入力は避ける
- 監査ログは厳格なアクセス制御下で管理

## ベストプラクティス

### 1. 一般ユーザー向け

**事前準備**
- キャンセル前に関係者に連絡
- 代替案があれば事前に準備
- キャンセル理由は具体的かつ簡潔に

**操作時の注意**
- キャンセル操作は取り消し不可
- 理由入力は慎重に行う
- 完了メッセージを必ず確認

### 2. 管理者向け

**責任ある運用**
- 他人の予約キャンセル時は事前連絡を推奨
- 緊急時以外は予約者の同意を得る
- 詳細な理由とコメントを記録

**セキュリティ意識**
- 管理者権限の適切な使用
- 操作ログの定期確認
- 不正アクセスの早期発見

## FAQ（よくある質問）

**Q1: キャンセルした予約を復旧できますか？**
A1: キャンセル操作は取り消し不可です。必要に応じて新規予約を作成してください。

**Q2: 過去の予約はキャンセルできますか？**
A2: 終了時刻が過去の予約はキャンセルできません。

**Q3: キャンセル理由は他の人に見えますか？**
A3: 一般ユーザーには表示されません。管理者のみが監査目的で確認可能です。

**Q4: 管理者が他人の予約をキャンセルした場合、予約者に通知されますか？**
A4: 現在のバージョンでは自動通知機能はありません。管理者から直接連絡することを推奨します。

**Q5: システムエラーでキャンセルが失敗した場合はどうすればいいですか？**
A5: 予約一覧を更新して状態を確認し、必要に応じて再操作してください。問題が続く場合はシステム管理者に連絡してください。

## 更新履歴

| バージョン | 日付 | 更新内容 |
|-----------|------|----------|
| 1.0 | 2025-09-04 | 初版作成（イテレーション3完了版） |
| 1.1 | 2025-09-04 | 管理者機能の詳細説明を追加 |

---

**注意**: このドキュメントはイテレーション3時点の機能を基に作成されています。今後のアップデートで機能追加される場合があります。