# ä½œæ¥­å±¥æ­´ 2025-08-27

## æ¦‚è¦

2025-08-27ã®ä½œæ¥­å†…å®¹ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

## ã‚³ãƒŸãƒƒãƒˆ: 1c2089d

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
style: Fix code indentation and formatting
- Adjust indentation for draw-cell and draw-next-cell functions
- Improve code readability with consistent formatting
- Clean up whitespace and alignment in drawing functions
- Maintain same functionality with better code style
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit 1c2089dfb36ed008b599c5f190a96f955f43331c
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 07:04:05 2025 +0000

    style: Fix code indentation and formatting
    
    - Adjust indentation for draw-cell and draw-next-cell functions
    - Improve code readability with consistent formatting
    - Clean up whitespace and alignment in drawing functions
    - Maintain same functionality with better code style

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 1a53cdb..3b2f8d9 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -766,10 +766,10 @@
     (doseq [y (range board-height)
             x (range board-width)]
       (let [cell-value (get-in board [y x])]
-        ;; ç©ºã®ã‚»ãƒ«ï¼ˆå€¤ãŒ0ï¼‰ã®å ´åˆã¯æç”»ã‚’ã‚¹ã‚­ãƒƒãƒ—
-        (when (not= cell-value 0)
-          (let [color (get colors cell-value "#ffffff")]
-            (draw-cell x y color)))))))
+     ;; ç©ºã®ã‚»ãƒ«ï¼ˆå€¤ãŒ0ï¼‰ã®å ´åˆã¯æç”»ã‚’ã‚¹ã‚­ãƒƒãƒ—
+     (when (not= cell-value 0)
+       (let [color (get colors cell-value "#ffffff")]
+         (draw-cell x y color)))))))
 
 (defn init-canvas
   "CanvasåˆæœŸåŒ–

```

## ã‚³ãƒŸãƒƒãƒˆ: b30e1d6

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
feat: Hide empty cell borders for cleaner visual appearance
- Update draw-board function to skip rendering empty cells (value 0)
- Remove unnecessary white borders that were cluttering the game board
- Only draw cells that contain actual puyo pieces
- Improve visual clarity by showing only relevant game elements
- Maintain clean background appearance without distracting grid lines
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit b30e1d6651c6e69460882bf93eb2497364b6d3b2
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 07:02:37 2025 +0000

    feat: Hide empty cell borders for cleaner visual appearance
    
    - Update draw-board function to skip rendering empty cells (value 0)
    - Remove unnecessary white borders that were cluttering the game board
    - Only draw cells that contain actual puyo pieces
    - Improve visual clarity by showing only relevant game elements
    - Maintain clean background appearance without distracting grid lines

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 8356be8..1a53cdb 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -747,17 +747,17 @@
   [x y color]
   (when @ctx
     (let [center-x (+ (* x cell-size) (/ cell-size 2))
-          center-y (+ (* y cell-size) (/ cell-size 2))
-          radius (- (/ cell-size 2) 2)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
-      ;; å††ã‚’æç”»
-      (.beginPath @ctx)
-      (.arc @ctx center-x center-y radius 0 (* 2 js/Math.PI))
+      center-y (+ (* y cell-size) (/ cell-size 2))
+      radius (- (/ cell-size 2) 2)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
+  ;; å††ã‚’æç”»
+  (.beginPath @ctx)
+  (.arc @ctx center-x center-y radius 0 (* 2 js/Math.PI))
       (set! (.-fillStyle @ctx) color)
       (.fill @ctx)
-      ;; å††ã®å¢ƒç•Œç·šã‚’æç”»
-      (set! (.-strokeStyle @ctx) "#000000")
+;; å††ã®å¢ƒç•Œç·šã‚’æç”»
+(set! (.-strokeStyle @ctx) "#000000")
       (set! (.-lineWidth @ctx) 2)
-      (.stroke @ctx))))
+   (.stroke @ctx))))
 
 (defn draw-board
   "ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ã‚’æç”»"
@@ -765,9 +765,11 @@
   (let [board (:board @game-state)]
     (doseq [y (range board-height)
             x (range board-width)]
-      (let [cell-value (get-in board [y x])
-            color (get colors cell-value "#ffffff")]
-        (draw-cell x y color)))))
+      (let [cell-value (get-in board [y x])]
+        ;; ç©ºã®ã‚»ãƒ«ï¼ˆå€¤ãŒ0ï¼‰ã®å ´åˆã¯æç”»ã‚’ã‚¹ã‚­ãƒƒãƒ—
+        (when (not= cell-value 0)
+          (let [color (get colors cell-value "#ffffff")]
+            (draw-cell x y color)))))))
 
 (defn init-canvas
   "CanvasåˆæœŸåŒ–
@@ -838,18 +840,18 @@
   [x y color]
   (when @next-ctx
     (let [cell-size 20
-          center-x (+ (* x cell-size) (/ cell-size 2))
-          center-y (+ (* y cell-size) (/ cell-size 2))
-          radius (- (/ cell-size 2) 1)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
-      ;; å††ã‚’æç”»
-      (.beginPath @next-ctx)
-      (.arc @next-ctx center-x center-y radius 0 (* 2 js/Math.PI))
+      center-x (+ (* x cell-size) (/ cell-size 2))
+      center-y (+ (* y cell-size) (/ cell-size 2))
+      radius (- (/ cell-size 2) 1)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
+  ;; å††ã‚’æç”»
+  (.beginPath @next-ctx)
+  (.arc @next-ctx center-x center-y radius 0 (* 2 js/Math.PI))
       (set! (.-fillStyle @next-ctx) color)
       (.fill @next-ctx)
-      ;; å††ã®å¢ƒç•Œç·šã‚’æç”»
-      (set! (.-strokeStyle @next-ctx) "#000")
+;; å††ã®å¢ƒç•Œç·šã‚’æç”»
+(set! (.-strokeStyle @next-ctx) "#000")
       (set! (.-lineWidth @next-ctx) 1)
-      (.stroke @next-ctx))))
+   (.stroke @next-ctx))))
 
 (defn render-next-piece
   "æ¬¡ã®ã·ã‚ˆã‚’æç”»"

```

## ã‚³ãƒŸãƒƒãƒˆ: b7cf489

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
feat: Change puyo shape from square to circle
- Update draw-cell function to render circular puyos instead of rectangles
  - Use canvas arc method to draw circles with proper center positioning
  - Add margin by reducing radius slightly for better visual appearance
  - Maintain black border for clear puyo definition
- Update draw-next-cell function for circular next piece display
  - Apply same circular rendering to next piece preview area
  - Scale circle size appropriately for smaller next piece canvas
- Improve visual aesthetics with more traditional puyo appearance
- All tests pass and build successful with new circular rendering
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit b7cf489b7915cd1ea7ee204806f422c753b6d327
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 06:57:38 2025 +0000

    feat: Change puyo shape from square to circle
    
    - Update draw-cell function to render circular puyos instead of rectangles
      - Use canvas arc method to draw circles with proper center positioning
      - Add margin by reducing radius slightly for better visual appearance
      - Maintain black border for clear puyo definition
    - Update draw-next-cell function for circular next piece display
      - Apply same circular rendering to next piece preview area
      - Scale circle size appropriately for smaller next piece canvas
    - Improve visual aesthetics with more traditional puyo appearance
    - All tests pass and build successful with new circular rendering

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index e4139fa..8356be8 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -743,13 +743,21 @@
                       :game-running false}))
 
 (defn draw-cell
-  "ã‚»ãƒ«ã‚’æç”»"
+  "ã‚»ãƒ«ã‚’æç”»ï¼ˆå††å½¢ï¼‰"
   [x y color]
   (when @ctx
-    (set! (.-fillStyle @ctx) color)
-    (.fillRect @ctx (* x cell-size) (* y cell-size) cell-size cell-size)
-    (set! (.-strokeStyle @ctx) "#000000")
-    (.strokeRect @ctx (* x cell-size) (* y cell-size) cell-size cell-size)))
+    (let [center-x (+ (* x cell-size) (/ cell-size 2))
+          center-y (+ (* y cell-size) (/ cell-size 2))
+          radius (- (/ cell-size 2) 2)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
+      ;; å††ã‚’æç”»
+      (.beginPath @ctx)
+      (.arc @ctx center-x center-y radius 0 (* 2 js/Math.PI))
+      (set! (.-fillStyle @ctx) color)
+      (.fill @ctx)
+      ;; å††ã®å¢ƒç•Œç·šã‚’æç”»
+      (set! (.-strokeStyle @ctx) "#000000")
+      (set! (.-lineWidth @ctx) 2)
+      (.stroke @ctx))))
 
 (defn draw-board
   "ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ã‚’æç”»"
@@ -826,13 +834,22 @@
   nil)
 
 (defn draw-next-cell
-  "æ¬¡ã®ã·ã‚ˆã‚¨ãƒªã‚¢ã§ã‚»ãƒ«ã‚’æç”»"
+  "æ¬¡ã®ã·ã‚ˆã‚¨ãƒªã‚¢ã§ã‚»ãƒ«ã‚’æç”»ï¼ˆå††å½¢ï¼‰"
   [x y color]
   (when @next-ctx
-    (set! (.-fillStyle @next-ctx) color)
-    (.fillRect @next-ctx (* x 20) (* y 20) 20 20)
-    (set! (.-strokeStyle @next-ctx) "#000")
-    (.strokeRect @next-ctx (* x 20) (* y 20) 20 20)))
+    (let [cell-size 20
+          center-x (+ (* x cell-size) (/ cell-size 2))
+          center-y (+ (* y cell-size) (/ cell-size 2))
+          radius (- (/ cell-size 2) 1)] ; å°‘ã—å°ã•ã‚ã®å††ã«ã—ã¦ãƒãƒ¼ã‚¸ãƒ³ã‚’ä½œã‚‹
+      ;; å††ã‚’æç”»
+      (.beginPath @next-ctx)
+      (.arc @next-ctx center-x center-y radius 0 (* 2 js/Math.PI))
+      (set! (.-fillStyle @next-ctx) color)
+      (.fill @next-ctx)
+      ;; å††ã®å¢ƒç•Œç·šã‚’æç”»
+      (set! (.-strokeStyle @next-ctx) "#000")
+      (set! (.-lineWidth @next-ctx) 1)
+      (.stroke @next-ctx))))
 
 (defn render-next-piece
   "æ¬¡ã®ã·ã‚ˆã‚’æç”»"

```

## ã‚³ãƒŸãƒƒãƒˆ: 48ec7b0

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
feat: Add next piece display functionality
- Add next piece preview area in HTML layout with improved side panel design
- Implement next-piece canvas for showing upcoming puyo pieces
- Add CSS styling for next piece area with consistent design
- Update game state to include next-piece field
- Add render-next-piece function to draw next piece in separate canvas
- Modify game logic to use next piece system:
  - Generate next piece on game initialization
  - Move next piece to current when piece is placed
  - Generate new next piece continuously
- Add next piece canvas initialization in init function
- Fix syntax errors and bracket mismatches in game logic
- Update game flow to seamlessly transition from next to current piece

The next piece display enhances gameplay by allowing players to plan ahead strategically.
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/public/index.html
- M	app/src/puyo/core.cljs
- D	app/test/puyo/test-gravity.cljs

### å¤‰æ›´å†…å®¹

```diff
commit 48ec7b026ae6aaa09734b34d57124c339052be7b
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 06:52:57 2025 +0000

    feat: Add next piece display functionality
    
    - Add next piece preview area in HTML layout with improved side panel design
    - Implement next-piece canvas for showing upcoming puyo pieces
    - Add CSS styling for next piece area with consistent design
    - Update game state to include next-piece field
    - Add render-next-piece function to draw next piece in separate canvas
    - Modify game logic to use next piece system:
      - Generate next piece on game initialization
      - Move next piece to current when piece is placed
      - Generate new next piece continuously
    - Add next piece canvas initialization in init function
    - Fix syntax errors and bracket mismatches in game logic
    - Update game flow to seamlessly transition from next to current piece
    
    The next piece display enhances gameplay by allowing players to plan ahead strategically.

diff --git a/app/public/index.html b/app/public/index.html
index 45abc6c..ad79df2 100644
--- a/app/public/index.html
+++ b/app/public/index.html
@@ -27,6 +27,19 @@
             margin: 20px auto;
             background-color: #fff;
         }
+        #next-piece-area {
+            text-align: center;
+            margin-top: 20px;
+        }
+        #next-piece-area h3 {
+            margin: 0 0 10px 0;
+            font-size: 16px;
+            color: #333;
+        }
+        #next-piece-canvas {
+            border: 2px solid #666;
+            background-color: #fff;
+        }
         .controls {
             margin: 20px 0;
         }
@@ -51,13 +64,19 @@
 <body>
     <div id="app">
         <h1>ğŸ® Puyo Puyo Game ğŸ®</h1>
-        <div id="game-info">
-            <p>Score: <span id="score">0</span></p>
-            <p>Level: <span id="level">1</span></p>
-            <p>Chain: <span id="chain">0</span></p>
-            <p>Time: <span id="time">0:00</span></p>
+        <div style="display: flex; justify-content: center; align-items: flex-start; gap: 20px;">
+            <canvas id="game-board" width="320" height="480"></canvas>
+            <div id="game-info">
+                <p>Score: <span id="score">0</span></p>
+                <p>Level: <span id="level">1</span></p>
+                <p>Chain: <span id="chain">0</span></p>
+                <p>Time: <span id="time">0:00</span></p>
+                <div id="next-piece-area">
+                    <h3>Next</h3>
+                    <canvas id="next-piece-canvas" width="80" height="80"></canvas>
+                </div>
+            </div>
         </div>
-        <canvas id="game-board" width="320" height="480"></canvas>
         <div class="controls">
             <button id="start-button">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
             <button id="reset-button">ãƒªã‚»ãƒƒãƒˆ</button>
diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 4599106..e4139fa 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -3,6 +3,7 @@
 ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®åˆæœŸåŒ–
 (defonce game-state (atom {:board []
                            :current-piece nil
+                           :next-piece nil
                            :score 0
                            :level 1
                            :chain-count 0
@@ -12,6 +13,8 @@
 ;; HTMLè¦ç´ ã¸ã®å‚ç…§
 (defonce canvas (atom nil))
 (defonce ctx (atom nil))
+(defonce next-canvas (atom nil))
+(defonce next-ctx (atom nil))
 (defonce game-timer (atom nil))
 (defonce drop-timer (atom nil))
 
@@ -734,6 +737,7 @@
   []
   (reset! game-state {:board (create-empty-board)
                       :current-piece nil
+                      :next-piece (setup-next-puyo)
                       :score 0
                       :level 1
                       :game-running false}))
@@ -821,6 +825,32 @@
       (draw-cell (:x puyo2) (:y puyo2) color2)))
   nil)
 
+(defn draw-next-cell
+  "æ¬¡ã®ã·ã‚ˆã‚¨ãƒªã‚¢ã§ã‚»ãƒ«ã‚’æç”»"
+  [x y color]
+  (when @next-ctx
+    (set! (.-fillStyle @next-ctx) color)
+    (.fillRect @next-ctx (* x 20) (* y 20) 20 20)
+    (set! (.-strokeStyle @next-ctx) "#000")
+    (.strokeRect @next-ctx (* x 20) (* y 20) 20 20)))
+
+(defn render-next-piece
+  "æ¬¡ã®ã·ã‚ˆã‚’æç”»"
+  []
+  (when (and @next-ctx (:next-piece @game-state))
+    ;; èƒŒæ™¯ã‚¯ãƒªã‚¢
+    (set! (.-fillStyle @next-ctx) "#f0f0f0")
+    (.fillRect @next-ctx 0 0 80 80)
+    
+    (let [next-piece (:next-piece @game-state)
+          puyo1 (:puyo1 next-piece)
+          puyo2 (:puyo2 next-piece)
+          color1 (get-puyo-color (:color puyo1))
+          color2 (get-puyo-color (:color puyo2))]
+      ;; ç¸¦é…ç½®ã§ä¸­å¤®ã«è¡¨ç¤º
+      (draw-next-cell 1 1 color1)  ; ä¸Šã®ã·ã‚ˆ
+      (draw-next-cell 1 2 color2)))) ; ä¸‹ã®ã·ã‚ˆ
+
 (defn update-game-display
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°
    
@@ -970,6 +1000,9 @@
     (when-let [current-piece (:current-piece @game-state)]
       (render-puyo-pair current-piece))
 
+    ;; æ¬¡ã®ã·ã‚ˆæç”»
+    (render-next-piece)
+
     ;; UIæ›´æ–°
     (update-all-game-info!)))
 
@@ -1004,9 +1037,19 @@
       :piece-placed (do
                       (place-puyo-pair! (:current-piece @game-state))
                       (process-line-clear!)
-                      (let [new-piece (spawn-new-puyo-pair)]
-                        (if (can-place-puyo-pair? new-piece (:board @game-state))
-                          (swap! game-state assoc :current-piece new-piece)
+                      ;; æ¬¡ã®ã·ã‚ˆã‚’ç¾åœ¨ã®ã·ã‚ˆã«ã—ã¦ã€æ–°ã—ã„æ¬¡ã®ã·ã‚ˆã‚’ç”Ÿæˆ
+                      (let [next-piece (:next-piece @game-state)
+                            positioned-piece (if next-piece
+                                               (merge next-piece 
+                                                      {:puyo1 (merge (:puyo1 next-piece) {:x (quot board-width 2) :y 0})
+                                                       :puyo2 (merge (:puyo2 next-piece) {:x (quot board-width 2) :y 1})
+                                                       :rotation 0})
+                                               (spawn-new-puyo-pair))
+                            new-next-piece (setup-next-puyo)]
+                        (if (can-place-puyo-pair? positioned-piece (:board @game-state))
+                          (swap! game-state assoc 
+                                 :current-piece positioned-piece
+                                 :next-piece new-next-piece)
                           (do
                             (process-game-over!)
                             (stop-drop-timer!)))))
@@ -1031,9 +1074,17 @@
   (init-game-state!)
   (reset-chain-count!)
   (reset-game-time!)
-  (swap! game-state assoc
-         :game-running true
-         :current-piece (spawn-new-puyo-pair))
+  ;; æ¬¡ã®ã·ã‚ˆã‚’ç¾åœ¨ã®ã·ã‚ˆã«ã—ã¦ã€æ–°ã—ã„æ¬¡ã®ã·ã‚ˆã‚’ç”Ÿæˆ
+  (let [next-piece (:next-piece @game-state)
+        positioned-piece (merge next-piece 
+                               {:puyo1 (merge (:puyo1 next-piece) {:x (quot board-width 2) :y 0})
+                                :puyo2 (merge (:puyo2 next-piece) {:x (quot board-width 2) :y 1})
+                                :rotation 0})
+        new-next-piece (setup-next-puyo)]
+    (swap! game-state assoc
+           :game-running true
+           :current-piece positioned-piece
+           :next-piece new-next-piece))
   (update-all-game-info!)
   (start-game-timer!)
   (start-drop-timer!)
@@ -1278,6 +1329,11 @@
         (reset! canvas canvas-elem)
         (reset! ctx (.getContext canvas-elem "2d")))
 
+      ;; æ¬¡ã®ã·ã‚ˆCanvasè¦ç´ ã®å–å¾—
+      (when-let [next-canvas-elem (.getElementById js/document "next-piece-canvas")]
+        (reset! next-canvas next-canvas-elem)
+        (reset! next-ctx (.getContext next-canvas-elem "2d")))
+
       ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
       (init-game-state!)
 
diff --git a/app/test/puyo/test-gravity.cljs b/app/test/puyo/test-gravity.cljs
deleted file mode 100644
index a4f57ea..0000000
--- a/app/test/puyo/test-gravity.cljs
+++ /dev/null
@@ -1,47 +0,0 @@
-(ns gravity-test
-  (:require [puyo.core :as puyo]))
-
-;; é‡åŠ›ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
-(defn test-floating-puyo-gravity []
-  (println "=== æµ®ã„ã¦ã„ã‚‹ã·ã‚ˆã®é‡åŠ›ãƒ†ã‚¹ãƒˆ ===")
-  
-  ;; ãƒ†ã‚¹ãƒˆç”¨ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ä½œæˆ
-  (let [test-board (-> (puyo/create-empty-board)
-                       ;; åº•ã«èµ¤ã·ã‚ˆã‚’é…ç½®
-                       (puyo/place-puyo 3 11 :red)
-                       ;; ç©ºé–“ã‚’ç©ºã‘ã¦ä¸Šã«é’ã·ã‚ˆã‚’é…ç½®ï¼ˆæµ®ã„ãŸçŠ¶æ…‹ï¼‰
-                       (puyo/place-puyo 3 9 :blue))]
-    
-    (println "ãƒ†ã‚¹ãƒˆå‰ã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
-    (doseq [row (range 12)]
-      (let [line (apply str (map #(case (puyo/get-puyo-at test-board % row)
-                                    :red "R"
-                                    :blue "B"
-                                    :green "G"
-                                    :yellow "Y"
-                                    " ") (range 8)))]
-        (println (str row ": " line))))
-    
-    ;; é‡åŠ›ã‚’é©ç”¨
-    (let [after-gravity (puyo/drop-floating-puyos test-board)]
-      (println "\né‡åŠ›é©ç”¨å¾Œã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
-      (doseq [row (range 12)]
-        (let [line (apply str (map #(case (puyo/get-puyo-at after-gravity % row)
-                                      :red "R"
-                                      :blue "B"
-                                      :green "G"
-                                      :yellow "Y"
-                                      " ") (range 8)))]
-          (println (str row ": " line))))
-      
-      ;; é’ã·ã‚ˆãŒè½ä¸‹ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
-      (let [blue-at-10 (= :blue (puyo/get-puyo-at after-gravity 3 10))
-            blue-at-9 (= :blue (puyo/get-puyo-at after-gravity 3 9))]
-        (if blue-at-10
-          (println "\nâœ“ ãƒ†ã‚¹ãƒˆæˆåŠŸ: é’ã·ã‚ˆãŒæ­£ã—ãè½ä¸‹ã—ã¾ã—ãŸ")
-          (if blue-at-9
-            (println "\nâœ— ãƒ†ã‚¹ãƒˆå¤±æ•—: é’ã·ã‚ˆãŒè½ä¸‹ã—ã¦ã„ã¾ã›ã‚“")
-            (println "\n? ãƒ†ã‚¹ãƒˆä¸æ˜: é’ã·ã‚ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")))))))
-
-;; ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
-(test-floating-puyo-gravity)

```

## ã‚³ãƒŸãƒƒãƒˆ: df33253

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
Fix test-gravity.cljs not being executed in npm run test
- Renamed test-gravity.cljs to gravity_test.cljs to match ClojureScript naming conventions
- Updated namespace from test-gravity to puyo.gravity-test to comply with shadow-cljs :ns-regexp -test$ pattern
- Added missing functions in puyo.core:
  - get-puyo-at: retrieves puyo color at specified coordinates
  - place-puyo: places puyo at specified coordinates (non-destructive)
- Removed duplicate test_gravity.cljs file
- Test now properly executes and passes with gravity simulation
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs
- A	app/test/puyo/gravity_test.cljs
- M	app/test/puyo/test-gravity.cljs

### å¤‰æ›´å†…å®¹

```diff
commit df33253570aabde8cf9b09a08d6398174a3f8dfd
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 06:42:54 2025 +0000

    Fix test-gravity.cljs not being executed in npm run test
    
    - Renamed test-gravity.cljs to gravity_test.cljs to match ClojureScript naming conventions
    - Updated namespace from test-gravity to puyo.gravity-test to comply with shadow-cljs :ns-regexp -test$ pattern
    - Added missing functions in puyo.core:
      - get-puyo-at: retrieves puyo color at specified coordinates
      - place-puyo: places puyo at specified coordinates (non-destructive)
    - Removed duplicate test_gravity.cljs file
    - Test now properly executes and passes with gravity simulation

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 1f4ee66..4599106 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -668,6 +668,36 @@
   []
   (vec (repeat board-height (vec (repeat board-width 0)))))
 
+(defn get-puyo-at
+  "æŒ‡å®šã—ãŸåº§æ¨™ã®ã·ã‚ˆã®è‰²ã‚’å–å¾—"
+  [board x y]
+  (if (and (>= x 0) (< x board-width)
+           (>= y 0) (< y board-height))
+    (let [color (get-in board [y x])]
+      (case color
+        1 :red
+        2 :green
+        3 :blue
+        4 :yellow
+        5 :purple
+        nil))
+    nil))
+
+(defn place-puyo
+  "æŒ‡å®šã—ãŸåº§æ¨™ã«ã·ã‚ˆã‚’é…ç½®ï¼ˆéç ´å£Šçš„ï¼‰"
+  [board x y color]
+  (if (and (>= x 0) (< x board-width)
+           (>= y 0) (< y board-height))
+    (let [color-num (case color
+                      :red 1
+                      :green 2
+                      :blue 3
+                      :yellow 4
+                      :purple 5
+                      0)]
+      (assoc-in board [y x] color-num))
+    board))
+
 (defn place-puyo-pair!
   "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹"
   [puyo-pair]
diff --git a/app/test/puyo/gravity_test.cljs b/app/test/puyo/gravity_test.cljs
new file mode 100644
index 0000000..af87a2d
--- /dev/null
+++ b/app/test/puyo/gravity_test.cljs
@@ -0,0 +1,47 @@
+(ns puyo.gravity-test
+  (:require [puyo.core :as puyo]))
+
+;; é‡åŠ›ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
+(defn test-floating-puyo-gravity []
+  (println "=== æµ®ã„ã¦ã„ã‚‹ã·ã‚ˆã®é‡åŠ›ãƒ†ã‚¹ãƒˆ ===")
+  
+  ;; ãƒ†ã‚¹ãƒˆç”¨ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ä½œæˆ
+  (let [test-board (-> (puyo/create-empty-board)
+                       ;; åº•ã«èµ¤ã·ã‚ˆã‚’é…ç½®
+                       (puyo/place-puyo 3 11 :red)
+                       ;; ç©ºé–“ã‚’ç©ºã‘ã¦ä¸Šã«é’ã·ã‚ˆã‚’é…ç½®ï¼ˆæµ®ã„ãŸçŠ¶æ…‹ï¼‰
+                       (puyo/place-puyo 3 9 :blue))]
+    
+    (println "ãƒ†ã‚¹ãƒˆå‰ã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
+    (doseq [row (range 12)]
+      (let [line (apply str (map #(case (puyo/get-puyo-at test-board % row)
+                                    :red "R"
+                                    :blue "B"
+                                    :green "G"
+                                    :yellow "Y"
+                                    " ") (range 8)))]
+        (println (str row ": " line))))
+    
+    ;; é‡åŠ›ã‚’é©ç”¨
+    (let [after-gravity (puyo/drop-floating-puyos test-board)]
+      (println "\né‡åŠ›é©ç”¨å¾Œã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
+      (doseq [row (range 12)]
+        (let [line (apply str (map #(case (puyo/get-puyo-at after-gravity % row)
+                                      :red "R"
+                                      :blue "B"
+                                      :green "G"
+                                      :yellow "Y"
+                                      " ") (range 8)))]
+          (println (str row ": " line))))
+      
+      ;; é’ã·ã‚ˆãŒè½ä¸‹ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
+      (let [blue-at-10 (= :blue (puyo/get-puyo-at after-gravity 3 10))
+            blue-at-9 (= :blue (puyo/get-puyo-at after-gravity 3 9))]
+        (if blue-at-10
+          (println "\nâœ“ ãƒ†ã‚¹ãƒˆæˆåŠŸ: é’ã·ã‚ˆãŒæ­£ã—ãè½ä¸‹ã—ã¾ã—ãŸ")
+          (if blue-at-9
+            (println "\nâœ— ãƒ†ã‚¹ãƒˆå¤±æ•—: é’ã·ã‚ˆãŒè½ä¸‹ã—ã¦ã„ã¾ã›ã‚“")
+            (println "\n? ãƒ†ã‚¹ãƒˆä¸æ˜: é’ã·ã‚ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")))))))
+
+;; ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
+(test-floating-puyo-gravity)
diff --git a/app/test/puyo/test-gravity.cljs b/app/test/puyo/test-gravity.cljs
index f8067f0..a4f57ea 100644
--- a/app/test/puyo/test-gravity.cljs
+++ b/app/test/puyo/test-gravity.cljs
@@ -1,4 +1,4 @@
-(ns test-gravity
+(ns gravity-test
   (:require [puyo.core :as puyo]))
 
 ;; é‡åŠ›ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```

## ã‚³ãƒŸãƒƒãƒˆ: ce519f1

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
refactor: test-gravity.cljsãƒ•ã‚¡ã‚¤ãƒ«ã‚’test/puyoãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´ç†ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®æ”¹å–„
- é–¢é€£ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«


### å¤‰æ›´å†…å®¹

```diff
commit ce519f1d3bdf5aca88f1a5a95a9b5ff72f185de4
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 04:52:34 2025 +0000

    refactor: test-gravity.cljsãƒ•ã‚¡ã‚¤ãƒ«ã‚’test/puyoãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
    
    - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´ç†ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®æ”¹å–„
    - é–¢é€£ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ç½®

diff --git a/app/test-gravity.cljs b/app/test/puyo/test-gravity.cljs
similarity index 100%
rename from app/test-gravity.cljs
rename to app/test/puyo/test-gravity.cljs

```

## ã‚³ãƒŸãƒƒãƒˆ: 82a62c7

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
refactor: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å‰Šé™¤ã¨lintã‚¨ãƒ©ãƒ¼ä¿®æ­£
- ã™ã¹ã¦ã®js/console.logãƒ‡ãƒãƒƒã‚°æ–‡ã‚’å‰Šé™¤
- ClojureScriptå‰æ–¹å‚ç…§lintã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
  - é–¢æ•°å®šç¾©é †åºã‚’é©åˆ‡ã«æ•´ç†
  - é‡è¤‡ã—ãŸé–¢æ•°å®šç¾©ã‚’å‰Šé™¤
- ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š
  - lintã‚¨ãƒ©ãƒ¼: 6å€‹ â†’ 0å€‹
  - ãƒ†ã‚¹ãƒˆ: 54å€‹ã™ã¹ã¦é€šé
  - ãƒ“ãƒ«ãƒ‰: è­¦å‘Šãªã—ã§æ­£å¸¸å®Œäº†
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit 82a62c79c28755c322c6780b9c01e4e2d9d37f9e
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 04:48:53 2025 +0000

    refactor: ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°å‰Šé™¤ã¨lintã‚¨ãƒ©ãƒ¼ä¿®æ­£
    
    - ã™ã¹ã¦ã®js/console.logãƒ‡ãƒãƒƒã‚°æ–‡ã‚’å‰Šé™¤
    - ClojureScriptå‰æ–¹å‚ç…§lintã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
      - é–¢æ•°å®šç¾©é †åºã‚’é©åˆ‡ã«æ•´ç†
      - é‡è¤‡ã—ãŸé–¢æ•°å®šç¾©ã‚’å‰Šé™¤
    - ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š
      - lintã‚¨ãƒ©ãƒ¼: 6å€‹ â†’ 0å€‹
      - ãƒ†ã‚¹ãƒˆ: 54å€‹ã™ã¹ã¦é€šé
      - ãƒ“ãƒ«ãƒ‰: è­¦å‘Šãªã—ã§æ­£å¸¸å®Œäº†

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 5aa9545..1f4ee66 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -669,13 +669,8 @@
   (vec (repeat board-height (vec (repeat board-width 0)))))
 
 (defn place-puyo-pair!
-  "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ãï¼‰"
+  "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹"
   [puyo-pair]
-  (js/console.log "=== place-puyo-pair! å®Ÿè¡Œé–‹å§‹ ===")
-  (js/console.log "é…ç½®å¯¾è±¡ã·ã‚ˆãƒšã‚¢:"
-                  "puyo1(" (get-in puyo-pair [:puyo1 :x]) "," (get-in puyo-pair [:puyo1 :y]) ")"
-                  "puyo2(" (get-in puyo-pair [:puyo2 :x]) "," (get-in puyo-pair [:puyo2 :y]) ")"
-                  "rotation:" (:rotation puyo-pair))
   (let [positions (get-puyo-pair-positions
                    (get-in puyo-pair [:puyo1 :x])
                    (get-in puyo-pair [:puyo1 :y])
@@ -684,35 +679,25 @@
         puyo2-pos (second positions)
         color1 (get-in puyo-pair [:puyo1 :color])
         color2 (get-in puyo-pair [:puyo2 :color])]
-    (js/console.log "é…ç½®åº§æ¨™:"
-                    "puyo1-pos(" (:x puyo1-pos) "," (:y puyo1-pos) ")"
-                    "puyo2-pos(" (:x puyo2-pos) "," (:y puyo2-pos) ")")
-    (js/console.log "é…ç½®è‰²:" "color1=" color1 "color2=" color2)
     (swap! game-state
            update :board
            #(-> %
                 (assoc-in [(:y puyo1-pos) (:x puyo1-pos)] color1)
                 (assoc-in [(:y puyo2-pos) (:x puyo2-pos)] color2)
-                (drop-floating-puyos)))
-    (js/console.log "âœ“ ãƒœãƒ¼ãƒ‰é…ç½®å®Œäº†")
-    (js/console.log "=== place-puyo-pair! å®Ÿè¡Œçµ‚äº† ===")))
+                (drop-floating-puyos)))))
 
 (defn process-line-clear!
-  "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ãï¼‰"
+  "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ "
   []
-  (js/console.log "=== process-line-clear! å®Ÿè¡Œé–‹å§‹ ===")
   (let [board (:board @game-state)
         chain-result (execute-chain board)]
-    (js/console.log "é€£é–çµæœ:" "chains=" (:chain-count chain-result)
-                    "score=" (:total-score chain-result))
     (swap! game-state merge
            {:board (:board chain-result)
             :score (+ (:score @game-state) (:total-score chain-result))
             :chain-count (:chain-count chain-result)})
-    (js/console.log "âœ“ ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°å®Œäº†")
     ;; TODO: update-all-game-info!ã®å‘¼ã³å‡ºã—ã‚’ä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
     ;; (update-all-game-info!)
-    (js/console.log "=== process-line-clear! å®Ÿè¡Œçµ‚äº† ===")))
+    ))
 
 (defn init-game-state!
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸåŒ–"
@@ -924,17 +909,39 @@
     (js/clearInterval @game-timer)
     (reset! game-timer nil)))
 
-(defn start-drop-timer!
-  "ã·ã‚ˆè½ä¸‹ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ï¼ˆ500msã”ã¨ã«ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ï¼‰"
+;; è£œåŠ©é–¢æ•°ç¾¤ï¼ˆå‰æ–¹å‚ç…§å›é¿ã®ãŸã‚å…ˆã«å®šç¾©ï¼‰
+(defn drop-puyo-pair-one-step
+  "çµ„ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹"
+  [puyo-pair board]
+  (let [moved-down (-> puyo-pair
+                       (update-in [:puyo1 :y] inc)
+                       (update-in [:puyo2 :y] inc))]
+    (if (can-place-puyo-pair? moved-down board)
+      moved-down
+      puyo-pair)))
+
+(defn process-game-over!
+  "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†"
   []
-  (when @drop-timer
-    (js/clearInterval @drop-timer))
-  (reset! drop-timer
-          (js/setInterval
-           (fn []
-             (when (:game-running @game-state)
-               (process-auto-drop!)))
-           500)))
+  (swap! game-state assoc :game-over true :game-running false))
+
+(defn render-game
+  "ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æç”»"
+  []
+  (when @ctx
+    ;; ç”»é¢ã‚¯ãƒªã‚¢
+    (set! (.-fillStyle @ctx) "#f0f0f0")
+    (.fillRect @ctx 0 0 (* board-width cell-size) (* board-height cell-size))
+
+    ;; ãƒœãƒ¼ãƒ‰æç”»
+    (draw-board)
+
+    ;; ç¾åœ¨ã®çµ„ã·ã‚ˆæç”»
+    (when-let [current-piece (:current-piece @game-state)]
+      (render-puyo-pair current-piece))
+
+    ;; UIæ›´æ–°
+    (update-all-game-info!)))
 
 (defn stop-drop-timer!
   "ã·ã‚ˆè½ä¸‹ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢"
@@ -976,38 +983,21 @@
       :dropped (render-game)
       nil)))
 
-(defn render-game
-  "ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æç”»"
+(defn start-drop-timer!
+  "ã·ã‚ˆè½ä¸‹ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ï¼ˆ500msã”ã¨ã«ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ï¼‰"
   []
-  (when @ctx
-    ;; ç”»é¢ã‚¯ãƒªã‚¢
-    (set! (.-fillStyle @ctx) "#f0f0f0")
-    (.fillRect @ctx 0 0 (* board-width cell-size) (* board-height cell-size))
-
-    ;; ãƒœãƒ¼ãƒ‰æç”»
-    (draw-board)
-
-    ;; ç¾åœ¨ã®çµ„ã·ã‚ˆæç”»
-    (when-let [current-piece (:current-piece @game-state)]
-      (render-puyo-pair current-piece))
-
-    ;; UIæ›´æ–°
-    (update-all-game-info!)))
+  (when @drop-timer
+    (js/clearInterval @drop-timer))
+  (reset! drop-timer
+          (js/setInterval
+           (fn []
+             (when (:game-running @game-state)
+               (process-auto-drop!)))
+           500)))
 
 (defn start-game
   "ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹"
   []
-  (js/console.log "ğŸš¨ğŸš¨ğŸš¨ start-game é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸï¼ğŸš¨ğŸš¨ğŸš¨")
-  (js/console.log "=== start-game å®Ÿè¡Œé–‹å§‹ ===")
-  (js/console.log "ğŸ“ start-game å‘¼ã³å‡ºã—å…ƒã‚’ç‰¹å®šä¸­...")
-
-  ;; ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å‡ºåŠ›ã—ã¦å‘¼ã³å‡ºã—å…ƒã‚’ç‰¹å®š
-  (try
-    (throw (js/Error. "Stack trace for debugging"))
-    (catch js/Error e
-      (js/console.log "ğŸ“ Stack trace:")
-      (js/console.log (.-stack e))))
-
   (init-game-state!)
   (reset-chain-count!)
   (reset-game-time!)
@@ -1017,9 +1007,7 @@
   (update-all-game-info!)
   (start-game-timer!)
   (start-drop-timer!)
-  (render-game)
-  (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹!")
-  (js/console.log "=== start-game å®Ÿè¡Œçµ‚äº† ==="))
+  (render-game))
 
 (defn reset-game
   "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ"
@@ -1030,280 +1018,92 @@
   (reset-chain-count!)
   (reset-game-time!)
   (update-all-game-info!)
-  (render-game)
-  (js/console.log "ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ"))
+  (render-game))
 
 ;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²æ¸ˆã¿ãƒ•ãƒ©ã‚°
 (defonce event-listeners-setup (atom false))
 
-(defn setup-event-listeners
-  "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆé‡è¤‡ç™»éŒ²é˜²æ­¢ä»˜ãï¼‰"
-  []
-  (js/console.log "=== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹ ===")
-  (if @event-listeners-setup
-    (js/console.log "âœ“ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯æ—¢ã«è¨­å®šæ¸ˆã¿ - ã‚¹ã‚­ãƒƒãƒ—")
-    (do
-      (js/console.log "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’æ–°è¦è¨­å®šä¸­...")
-
-      ;; ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³
-      (when-let [start-btn (.getElementById js/document "start-button")]
-        (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
-        (.addEventListener start-btn "click"
-                           (fn [event]
-                             (js/console.log "ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ")
-                             (js/console.log "ç¾åœ¨ã®ã‚²ãƒ¼ãƒ å®Ÿè¡ŒçŠ¶æ…‹:" (:game-running @game-state))
-                             (if (:game-running @game-state)
-                               (js/console.log "âš ï¸ ã‚²ãƒ¼ãƒ å®Ÿè¡Œä¸­ã®ãŸã‚ã€start-gameã‚’ã‚¹ã‚­ãƒƒãƒ—")
-                               (do
-                                 (js/console.log "âœ… ã‚²ãƒ¼ãƒ åœæ­¢ä¸­ã®ãŸã‚ã€start-gameã‚’å®Ÿè¡Œ")
-                                 (start-game))))))
-
-      ;; ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
-      (when-let [reset-btn (.getElementById js/document "reset-button")]
-        (js/console.log "ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
-        (.addEventListener reset-btn "click" reset-game))
-
-      ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
-      (js/console.log "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
-      (.addEventListener js/document "keydown"
-                         (fn [event]
-                           (js/console.log "ğŸ¹ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ - Key:" (.-key event) "Target:" (.-tagName (.-target event)))
-                           (when (:game-running @game-state)
-                             (let [key (.-key event)]
-                               ;; ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’èª¤ã£ã¦ç™ºç«ã•ã›ãªã„ã‚ˆã†ã« preventDefault
-                               (when (= key " ")
-                                 (js/console.log "ğŸš« ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²æ­¢")
-                                 (.preventDefault event))
-                               (handle-key-input key)))))
-
-      (reset! event-listeners-setup true)
-      (js/console.log "âœ“ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†")))
-  (js/console.log "=== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šçµ‚äº† ==="))
-
-;; ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
-(defonce app-initialized (atom false))
-
-(defn init
-  "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–"
-  []
-  (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹ ===")
-  (if @app-initialized
-    (do
-      (js/console.log "âœ— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ã§ã™ - ã‚¹ã‚­ãƒƒãƒ—")
-      (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–çµ‚äº†ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰ ==="))
-    (do
-      (js/console.log "Puyo Puyo Game åˆæœŸåŒ–ä¸­...")
-
-      ;; Canvasè¦ç´ ã®å–å¾—
-      (when-let [canvas-elem (.getElementById js/document "game-board")]
-        (js/console.log "Canvasè¦ç´ å–å¾—æˆåŠŸ")
-        (reset! canvas canvas-elem)
-        (reset! ctx (.getContext canvas-elem "2d")))
-
-      ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
-      (js/console.log "ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–å®Ÿè¡Œ")
-      (init-game-state!)
-
-      ;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
-      (js/console.log "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Ÿè¡Œ")
-      (setup-event-listeners)
-
-      ;; åˆæœŸæç”»
-      (js/console.log "åˆæœŸæç”»å®Ÿè¡Œ")
-      (render-game)
-
-      ;; åˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
-      (reset! app-initialized true)
-      (js/console.log "åˆæœŸåŒ–å®Œäº†")
-      (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–çµ‚äº† ==="))))
-
-;; DOMContentLoadedã§è‡ªå‹•åˆæœŸåŒ–
-(when (exists? js/document)
-  (js/console.log "=== DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ===")
-  (.addEventListener js/document "DOMContentLoaded"
-                     (fn [e]
-                       (js/console.log "âœ“ DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆç™ºç« - inité–¢æ•°å‘¼ã³å‡ºã—")
-                       (init)))
-
-  ;; ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ 
-  (.addEventListener js/window "error"
-                     (fn [e]
-                       (js/console.error "âœ—âœ—âœ— ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼æ¤œå‡º âœ—âœ—âœ—")
-                       (js/console.error "Error:" e)
-                       (js/console.error "Message:" (.-message e))
-                       (js/console.error "Filename:" (.-filename e))
-                       (js/console.error "Line:" (.-lineno e))))
-
-  ;; Unhandled Promise Rejectionãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ   
-  (.addEventListener js/window "unhandledrejection"
-                     (fn [e]
-                       (js/console.error "âœ—âœ—âœ— Unhandled Promise Rejection æ¤œå‡º âœ—âœ—âœ—")
-                       (js/console.error "Reason:" (.-reason e)))))
-
-;; =============================================================================
-;; T017: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å‡¦ç†
-;; =============================================================================
-
-;; è£œåŠ©é–¢æ•°ç¾¤ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å‡¦ç†ç”¨ï¼‰
-(defn drop-puyo-pair-one-step
-  "çµ„ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹"
-  [puyo-pair board]
-  (let [moved-down (-> puyo-pair
-                       (update-in [:puyo1 :y] inc)
-                       (update-in [:puyo2 :y] inc))]
-    (if (can-place-puyo-pair? moved-down board)
-      moved-down
-      puyo-pair)))
-
-(defn hard-drop-puyo-pair
-  "çµ„ã·ã‚ˆã‚’ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆæœ€ä¸‹æ®µã¾ã§ä¸€æ°—ã«è½ä¸‹ï¼‰è©³ç´°ãƒ­ã‚°ä»˜ã"
-  [puyo-pair board]
-  (js/console.log "=== hard-drop-puyo-pair å®Ÿè¡Œé–‹å§‹ ===")
-  (js/console.log "é–‹å§‹ä½ç½®:"
-                  "puyo1(" (get-in puyo-pair [:puyo1 :x]) "," (get-in puyo-pair [:puyo1 :y]) ")"
-                  "puyo2(" (get-in puyo-pair [:puyo2 :x]) "," (get-in puyo-pair [:puyo2 :y]) ")")
-  (loop [current-piece puyo-pair
-         step-count 0]
-    (js/console.log (str "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ— ã‚¹ãƒ†ãƒƒãƒ— " step-count ":")
-                    "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
-                    "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
-    (let [dropped-piece (drop-puyo-pair-one-step current-piece board)]
-      (if (= dropped-piece current-piece)
-        (do
-          (js/console.log "âœ“ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº† - æœ€çµ‚ä½ç½®:"
-                          "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
-                          "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
-          (js/console.log "=== hard-drop-puyo-pair å®Ÿè¡Œçµ‚äº† ===")
-          current-piece)
-        (recur dropped-piece (inc step-count))))))
-
 ;; ç§»å‹•å‡¦ç†é–¢æ•°ç¾¤
 (defn process-left-movement!
-  "å·¦ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + è©³ç´°ãƒ­ã‚°ï¼‰"
+  "å·¦ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œï¼‰"
   []
-  (js/console.log "=== å·¦ç§»å‹•å‡¦ç†é–‹å§‹ ===")
-  (let [result (atom nil)
-        start-time (js/Date.now)]
+  (let [result (atom nil)]
     (swap! game-state
            (fn [state]
              (let [current-piece (:current-piece state)
                    board (:board state)]
                (if current-piece
+                 (let [moved-piece (move-puyo-pair-left current-piece board)]
+                   (if (not= moved-piece current-piece)
+                     (do
+                       (reset! result {:result :moved :direction :left})
+                       (assoc state :current-piece moved-piece))
+                     (do
+                       (reset! result {:result :failed :reason "cannot-move"})
+                       state)))
                  (do
-                   (js/console.log "å·¦ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                                   "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
-                                   "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
-                   (let [moved-piece (move-puyo-pair-left current-piece board)]
-                     (if (not= moved-piece current-piece)
-                       (do
-                         (js/console.log "å·¦ç§»å‹•å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                                         "puyo1(" (get-in moved-piece [:puyo1 :x]) "," (get-in moved-piece [:puyo1 :y]) ")"
-                                         "puyo2(" (get-in moved-piece [:puyo2 :x]) "," (get-in moved-piece [:puyo2 :y]) ")")
-                         (js/console.log "âœ“ å·¦ç§»å‹•æˆåŠŸ")
-                         (reset! result {:result :moved :direction :left})
-                         (assoc state :current-piece moved-piece))
-                       (do
-                         (js/console.log "âœ— å·¦ç§»å‹•ã§ãã¾ã›ã‚“")
-                         (reset! result {:result :failed :reason "cannot-move"})
-                         state))))
-                 (do
-                   (js/console.log "âœ— å·¦ç§»å‹•å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
                    (reset! result {:result :failed :reason "no-piece"})
                    state)))))
-    (let [end-time (js/Date.now)
-          duration (- end-time start-time)]
-      (js/console.log "å·¦ç§»å‹•å‡¦ç†æ™‚é–“:" duration "ms")
-      (when (= (:result @result) :moved)
-        (js/console.log "æç”»å®Ÿè¡Œ")
-        (render-game))
-      (js/console.log "=== å·¦ç§»å‹•å‡¦ç†çµ‚äº† ===")
-      @result)))
+    (when (= (:result @result) :moved)
+      (render-game))
+    @result))
 
 (defn process-right-movement!
-  "å³ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + è©³ç´°ãƒ­ã‚°ï¼‰"
+  "å³ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œï¼‰"
   []
-  (js/console.log "=== å³ç§»å‹•å‡¦ç†é–‹å§‹ ===")
-  (let [result (atom nil)
-        start-time (js/Date.now)]
+  (let [result (atom nil)]
     (swap! game-state
            (fn [state]
              (let [current-piece (:current-piece state)
                    board (:board state)]
                (if current-piece
+                 (let [moved-piece (move-puyo-pair-right current-piece board)]
+                   (if (not= moved-piece current-piece)
+                     (do
+                       (reset! result {:result :moved :direction :right})
+                       (assoc state :current-piece moved-piece))
+                     (do
+                       (reset! result {:result :failed :reason "cannot-move"})
+                       state)))
                  (do
-                   (js/console.log "å³ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                                   "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
-                                   "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
-                   (let [moved-piece (move-puyo-pair-right current-piece board)]
-                     (if (not= moved-piece current-piece)
-                       (do
-                         (js/console.log "å³ç§»å‹•å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                                         "puyo1(" (get-in moved-piece [:puyo1 :x]) "," (get-in moved-piece [:puyo1 :y]) ")"
-                                         "puyo2(" (get-in moved-piece [:puyo2 :x]) "," (get-in moved-piece [:puyo2 :y]) ")")
-                         (js/console.log "âœ“ å³ç§»å‹•æˆåŠŸ")
-                         (reset! result {:result :moved :direction :right})
-                         (assoc state :current-piece moved-piece))
-                       (do
-                         (js/console.log "âœ— å³ç§»å‹•ã§ãã¾ã›ã‚“")
-                         (reset! result {:result :failed :reason "cannot-move"})
-                         state))))
-                 (do
-                   (js/console.log "âœ— å³ç§»å‹•å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
                    (reset! result {:result :failed :reason "no-piece"})
                    state)))))
-    (let [end-time (js/Date.now)
-          duration (- end-time start-time)]
-      (js/console.log "å³ç§»å‹•å‡¦ç†æ™‚é–“:" duration "ms")
-      (when (= (:result @result) :moved)
-        (js/console.log "æç”»å®Ÿè¡Œ")
-        (render-game))
-      (js/console.log "=== å³ç§»å‹•å‡¦ç†çµ‚äº† ===")
-      @result)))
+    (when (= (:result @result) :moved)
+      (render-game))
+    @result))
 
 (defn process-rotation!
-  "å›è»¢å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + äºŒé‡å®Ÿè¡Œé˜²æ­¢ï¼‰"
+  "å›è»¢å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œï¼‰"
   []
-  (js/console.log "=== å›è»¢å‡¦ç†é–‹å§‹ ===")
-  ;; ã‚¹ãƒ¯ãƒƒãƒ—é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒˆãƒŸãƒƒã‚¯ã«çŠ¶æ…‹ã‚’æ›´æ–°
-  (let [result (atom nil)
-        start-time (js/Date.now)]
+  (let [result (atom nil)]
     (swap! game-state
            (fn [state]
              (let [current-piece (:current-piece state)
                    board (:board state)]
                (if current-piece
+                 (let [rotated-piece (rotate-puyo-pair current-piece)]
+                   (if (can-place-puyo-pair? rotated-piece board)
+                     (do
+                       (reset! result {:result :rotated :new-rotation (:rotation rotated-piece)})
+                       (assoc state :current-piece rotated-piece))
+                     (do
+                       (reset! result {:result :failed :reason "cannot-place"})
+                       state)))
                  (do
-                   (js/console.log "å›è»¢å‰ã®ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹:" (pr-str current-piece))
-                   (js/console.log "å›è»¢å‰ã®å›è»¢çŠ¶æ…‹:" (:rotation current-piece))
-                   (js/console.log "å›è»¢å‰puyo1ä½ç½®:" (get-in current-piece [:puyo1 :x]) (get-in current-piece [:puyo1 :y]))
-                   (js/console.log "å›è»¢å‰puyo2ä½ç½®:" (get-in current-piece [:puyo2 :x]) (get-in current-piece [:puyo2 :y]))
-                   (let [rotated-piece (rotate-puyo-pair current-piece)]
-                     (js/console.log "å›è»¢è¨ˆç®—å¾Œã®ãƒ”ãƒ¼ã‚¹:" (pr-str rotated-piece))
-                     (js/console.log "å›è»¢è¨ˆç®—å¾Œã®çŠ¶æ…‹:" (:rotation rotated-piece))
-                     (js/console.log "å›è»¢è¨ˆç®—å¾Œpuyo1ä½ç½®:" (get-in rotated-piece [:puyo1 :x]) (get-in rotated-piece [:puyo1 :y]))
-                     (js/console.log "å›è»¢è¨ˆç®—å¾Œpuyo2ä½ç½®:" (get-in rotated-piece [:puyo2 :x]) (get-in rotated-piece [:puyo2 :y]))
-                     (if (can-place-puyo-pair? rotated-piece board)
-                       (do
-                         (js/console.log "âœ“ å›è»¢æˆåŠŸ - çŠ¶æ…‹æ›´æ–°å®Ÿè¡Œ")
-                         (reset! result {:result :rotated :new-rotation (:rotation rotated-piece)})
-                         (assoc state :current-piece rotated-piece))
-                       (do
-                         (js/console.log "âœ— å›è»¢å¤±æ•—: é…ç½®ã§ãã¾ã›ã‚“")
-                         (reset! result {:result :failed :reason "cannot-place"})
-                         state))))
-                 (do
-                   (js/console.log "âœ— å›è»¢å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
                    (reset! result {:result :failed :reason "no-piece"})
                    state)))))
-    ;; çŠ¶æ…‹æ›´æ–°å¾Œã«æç”»ã‚’å®Ÿè¡Œ
-    (let [end-time (js/Date.now)
-          duration (- end-time start-time)]
-      (js/console.log "å›è»¢å‡¦ç†æ™‚é–“:" duration "ms")
-      (when (= (:result @result) :rotated)
-        (js/console.log "æç”»å®Ÿè¡Œ")
-        (render-game))
-      (js/console.log "=== å›è»¢å‡¦ç†çµ‚äº† ===")
-      @result)))
+    (when (= (:result @result) :rotated)
+      (render-game))
+    @result))
+
+(defn hard-drop-puyo-pair
+  "çµ„ã·ã‚ˆã‚’ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆæœ€ä¸‹æ®µã¾ã§ä¸€æ°—ã«è½ä¸‹ï¼‰"
+  [puyo-pair board]
+  (loop [current-piece puyo-pair]
+    (let [dropped-piece (drop-puyo-pair-one-step current-piece board)]
+      (if (= dropped-piece current-piece)
+        current-piece
+        (recur dropped-piece)))))
 
 (defn process-soft-drop!
   "é«˜é€Ÿè½ä¸‹å‡¦ç†"
@@ -1320,76 +1120,44 @@
           {:result :bottom-reached})))))
 
 (defn process-hard-drop!
-  "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ã + ã·ã‚ˆå›ºå®šå‡¦ç†ï¼‰"
+  "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ï¼ˆã·ã‚ˆå›ºå®šå‡¦ç†ï¼‰"
   []
-  (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†é–‹å§‹ ===")
-
   ;; ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ä¸­ã¯ä»–ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢
-  (js/console.log "â¸ï¸ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ä¸­ - ä»–ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢")
   (stop-drop-timer!)
 
   (try
     (let [current-piece (:current-piece @game-state)
           board (:board @game-state)]
       (if current-piece
-        (do
-          (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                          "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
-                          "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
-          (let [final-piece (hard-drop-puyo-pair current-piece board)]
-            (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
-                            "puyo1(" (get-in final-piece [:puyo1 :x]) "," (get-in final-piece [:puyo1 :y]) ")"
-                            "puyo2(" (get-in final-piece [:puyo2 :x]) "," (get-in final-piece [:puyo2 :y]) ")")
-            (js/console.log "âœ“ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸ - ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«å›ºå®šã—ã¾ã™")
-
-            ;; ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢
-            (swap! game-state assoc :current-piece nil)
-            (js/console.log "ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")
+        (let [final-piece (hard-drop-puyo-pair current-piece board)]
+          ;; ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢
+          (swap! game-state assoc :current-piece nil)
 
             ;; ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«å›ºå®š
-            (place-puyo-pair! final-piece)
-            (process-line-clear!)
-
-            ;; æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒã‚§ãƒƒã‚¯æ”¹å–„ï¼‰
-            (let [new-piece (spawn-new-puyo-pair)]
-              (js/console.log "æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ç”Ÿæˆä½ç½®:"
-                              "puyo1(" (get-in new-piece [:puyo1 :x]) "," (get-in new-piece [:puyo1 :y]) ")"
-                              "puyo2(" (get-in new-piece [:puyo2 :x]) "," (get-in new-piece [:puyo2 :y]) ")")
-              ;; æ–°ã—ã„ã·ã‚ˆãŒé…ç½®å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå±é™ºãƒ©ã‚¤ãƒ³åˆ¤å®šã§ã¯ãªãé…ç½®å¯èƒ½æ€§ã®ã¿ï¼‰
-              (if (can-place-puyo-pair? new-piece (:board @game-state))
-                (do
-                  (swap! game-state assoc :current-piece new-piece)
-                  (js/console.log "âœ“ æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ç”ŸæˆæˆåŠŸ"))
-                (do
-                  (js/console.log "âœ— ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼: æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ãã¾ã›ã‚“")
-                  (js/console.log "ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ï¼ˆä¸Šéƒ¨2è¡Œï¼‰:")
-                  (doseq [y [0 1]]
-                    (js/console.log (str "y=" y ": " (vec (for [x (range board-width)] (get-in (:board @game-state) [y x]))))))
-                  (process-game-over!)
-                  (stop-drop-timer!))))
+          (place-puyo-pair! final-piece)
+          (process-line-clear!)
+
+            ;; æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆ
+          (let [new-piece (spawn-new-puyo-pair)]
+              ;; æ–°ã—ã„ã·ã‚ˆãŒé…ç½®å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
+            (if (can-place-puyo-pair? new-piece (:board @game-state))
+              (swap! game-state assoc :current-piece new-piece)
+              (do
+                (process-game-over!)
+                (stop-drop-timer!))))
 
             ;; ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº†å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
-            (js/console.log "â–¶ï¸ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº† - ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹")
-            (start-drop-timer!)
+          (start-drop-timer!)
 
-            (render-game)
-            (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº† ===")
-            {:result :hard-dropped-and-placed :final-y (get-in final-piece [:puyo1 :y])}))
-        (do
-          (js/console.log "âœ— ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
-          (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº† ===")
-          {:result :failed :reason "no-piece"})))
+          (render-game)
+          {:result :hard-dropped-and-placed :final-y (get-in final-piece [:puyo1 :y])})
+        {:result :failed :reason "no-piece"}))
     (catch js/Error e
-      (js/console.error "âœ—âœ—âœ— ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ âœ—âœ—âœ—")
-      (js/console.error "ã‚¨ãƒ©ãƒ¼è©³ç´°:" e)
-      (js/console.error "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:" (.-message e))
-      (js/console.error "ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:" (.-stack e))
+      (js/console.error "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:" e)
       ;; ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
       (start-drop-timer!)
-      (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº†ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰ ===")
       {:result :error :error e})))
 
-;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
 ;; ã‚­ãƒ¼å…¥åŠ›ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¶å¾¡
 (def ^:private last-rotation-time (atom 0))
 (def ^:private last-left-move-time (atom 0))
@@ -1402,57 +1170,119 @@
 (defn handle-key-input
   "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’å‡¦ç†ã—ã¦ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°"
   [key]
-  (js/console.log "Key:" key "Game running:" (:game-running @game-state) "Current piece:" (some? (:current-piece @game-state)))
   (when (and (:game-running @game-state)
              (:current-piece @game-state))
     (case key
       "ArrowLeft" (let [current-time (js/Date.now)
                         time-since-last-move (- current-time @last-left-move-time)]
-                    (js/console.log "å·¦ç§»å‹•ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-move "ms")
                     (if (> time-since-last-move movement-debounce-ms)
                       (do
-                        (js/console.log "å·¦ç§»å‹•å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
                         (reset! last-left-move-time current-time)
                         (process-left-movement!))
-                      (do
-                        (js/console.log "å·¦ç§»å‹•ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
-                        {:result :debounced :reason "too-soon"})))
+                      {:result :debounced :reason "too-soon"}))
       "ArrowRight" (let [current-time (js/Date.now)
                          time-since-last-move (- current-time @last-right-move-time)]
-                     (js/console.log "å³ç§»å‹•ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-move "ms")
                      (if (> time-since-last-move movement-debounce-ms)
                        (do
-                         (js/console.log "å³ç§»å‹•å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
                          (reset! last-right-move-time current-time)
                          (process-right-movement!))
-                       (do
-                         (js/console.log "å³ç§»å‹•ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
-                         {:result :debounced :reason "too-soon"})))
+                       {:result :debounced :reason "too-soon"}))
       "ArrowUp" (let [current-time (js/Date.now)
                       time-since-last-rotation (- current-time @last-rotation-time)]
-                  (js/console.log "å›è»¢ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-rotation "ms")
                   (if (> time-since-last-rotation rotation-debounce-ms)
                     (do
-                      (js/console.log "å›è»¢å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
                       (reset! last-rotation-time current-time)
                       (process-rotation!))
-                    (do
-                      (js/console.log "å›è»¢ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
-                      {:result :debounced :reason "too-soon"})))
+                    {:result :debounced :reason "too-soon"}))
       "ArrowDown" (process-soft-drop!)
       " " (let [current-time (js/Date.now)
                 time-since-last-drop (- current-time @last-hard-drop-time)]
-            (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-drop "ms")
             (if (> time-since-last-drop hard-drop-debounce-ms)
               (do
-                (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
                 (reset! last-hard-drop-time current-time)
                 (process-hard-drop!))
-              (do
-                (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
-                {:result :debounced :reason "too-soon"})))
+              {:result :debounced :reason "too-soon"}))
       nil)))
 
+(defn setup-event-listeners
+  "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆé‡è¤‡ç™»éŒ²é˜²æ­¢ä»˜ãï¼‰"
+  []
+  (if @event-listeners-setup
+    nil
+    (do
+      ;; ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³
+      (when-let [start-btn (.getElementById js/document "start-button")]
+        (.addEventListener start-btn "click"
+                           (fn [_event]
+                             (if (:game-running @game-state)
+                               nil
+                               (start-game)))))
+
+      ;; ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
+      (when-let [reset-btn (.getElementById js/document "reset-button")]
+        (.addEventListener reset-btn "click" reset-game))
+
+      ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
+      (.addEventListener js/document "keydown"
+                         (fn [event]
+                           (when (:game-running @game-state)
+                             (let [key (.-key event)]
+                               ;; ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’èª¤ã£ã¦ç™ºç«ã•ã›ãªã„ã‚ˆã†ã« preventDefault
+                               (when (= key " ")
+                                 (.preventDefault event))
+                               (handle-key-input key)))))
+
+      (reset! event-listeners-setup true))))
+
+;; ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
+(defonce app-initialized (atom false))
+
+(defn init
+  "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–"
+  []
+  (if @app-initialized
+    nil
+    (do
+      ;; Canvasè¦ç´ ã®å–å¾—
+      (when-let [canvas-elem (.getElementById js/document "game-board")]
+        (reset! canvas canvas-elem)
+        (reset! ctx (.getContext canvas-elem "2d")))
+
+      ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
+      (init-game-state!)
+
+      ;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
+      (setup-event-listeners)
+
+      ;; åˆæœŸæç”»
+      (render-game)
+
+      ;; åˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
+      (reset! app-initialized true))))
+
+;; DOMContentLoadedã§è‡ªå‹•åˆæœŸåŒ–
+(when (exists? js/document)
+  (.addEventListener js/document "DOMContentLoaded"
+                     (fn [_e]
+                       (init)))
+
+  ;; ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ 
+  (.addEventListener js/window "error"
+                     (fn [e]
+                       (js/console.error "Error:" e)
+                       (js/console.error "Message:" (.-message e))
+                       (js/console.error "Filename:" (.-filename e))
+                       (js/console.error "Line:" (.-lineno e))))
+
+  ;; Unhandled Promise Rejectionãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ   
+  (.addEventListener js/window "unhandledrejection"
+                     (fn [e]
+                       (js/console.error "Unhandled Promise Rejection:" (.-reason e)))))
+
+;; =============================================================================
+;; T017: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å‡¦ç†
+;; =============================================================================
+
 ;; T019: ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–¢æ•°ç¾¤
 (defn reset-game-state!
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸå€¤ã«ãƒªã‚»ãƒƒãƒˆ"
@@ -1503,11 +1333,6 @@
                    (range board-width)))
            [0 1]))))
 
-(defn process-game-over!
-  "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†"
-  []
-  (swap! game-state assoc :game-over true :game-running false))
-
 (defn check-and-handle-game-over!
   "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å¿…è¦ã«å¿œã˜ã¦å‡¦ç†ã‚’å®Ÿè¡Œ"
   []

```

## ã‚³ãƒŸãƒƒãƒˆ: 55c1896

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
fix: ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã«ã‚ˆã‚‹ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆå•é¡Œã‚’è§£æ±º
- ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã«ã‚²ãƒ¼ãƒ å®Ÿè¡ŒçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ 
- ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®preventDefaultã‚’å®Ÿè£…ã—ã¦ãƒœã‚¿ãƒ³èª¤ç™ºç«ã‚’é˜²æ­¢
- ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ã®å®Œå…¨ãªã·ã‚ˆå›ºå®šæ©Ÿèƒ½ã‚’å®Ÿè£…
- è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ©Ÿèƒ½ã¨ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹åˆ†æã‚’è¿½åŠ 
- é‡è¤‡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²é˜²æ­¢æ©Ÿèƒ½ã‚’å®Ÿè£…
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã®äºŒé‡å®Ÿè¡Œé˜²æ­¢æ©Ÿèƒ½ã‚’è¿½åŠ 
- ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ©Ÿèƒ½ã§ã‚­ãƒ¼å…¥åŠ›ã®é€£ç¶šå®Ÿè¡Œåˆ¶å¾¡ã‚’å¼·åŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã®å®‰å…¨æ€§ã‚’å‘ä¸Š
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit 55c1896372ea26853033cce69161b99acf396f66
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 04:09:32 2025 +0000

    fix: ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã«ã‚ˆã‚‹ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆå•é¡Œã‚’è§£æ±º
    
    - ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã«ã‚²ãƒ¼ãƒ å®Ÿè¡ŒçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ 
    - ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®preventDefaultã‚’å®Ÿè£…ã—ã¦ãƒœã‚¿ãƒ³èª¤ç™ºç«ã‚’é˜²æ­¢
    - ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ã®å®Œå…¨ãªã·ã‚ˆå›ºå®šæ©Ÿèƒ½ã‚’å®Ÿè£…
    - è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æ©Ÿèƒ½ã¨ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹åˆ†æã‚’è¿½åŠ 
    - é‡è¤‡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²é˜²æ­¢æ©Ÿèƒ½ã‚’å®Ÿè£…
    - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã®äºŒé‡å®Ÿè¡Œé˜²æ­¢æ©Ÿèƒ½ã‚’è¿½åŠ 
    - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ©Ÿèƒ½ã§ã‚­ãƒ¼å…¥åŠ›ã®é€£ç¶šå®Ÿè¡Œåˆ¶å¾¡ã‚’å¼·åŒ–
    - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã®å®‰å…¨æ€§ã‚’å‘ä¸Š

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index f41bc7f..5aa9545 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -669,8 +669,13 @@
   (vec (repeat board-height (vec (repeat board-width 0)))))
 
 (defn place-puyo-pair!
-  "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹"
+  "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ãï¼‰"
   [puyo-pair]
+  (js/console.log "=== place-puyo-pair! å®Ÿè¡Œé–‹å§‹ ===")
+  (js/console.log "é…ç½®å¯¾è±¡ã·ã‚ˆãƒšã‚¢:"
+                  "puyo1(" (get-in puyo-pair [:puyo1 :x]) "," (get-in puyo-pair [:puyo1 :y]) ")"
+                  "puyo2(" (get-in puyo-pair [:puyo2 :x]) "," (get-in puyo-pair [:puyo2 :y]) ")"
+                  "rotation:" (:rotation puyo-pair))
   (let [positions (get-puyo-pair-positions
                    (get-in puyo-pair [:puyo1 :x])
                    (get-in puyo-pair [:puyo1 :y])
@@ -679,23 +684,35 @@
         puyo2-pos (second positions)
         color1 (get-in puyo-pair [:puyo1 :color])
         color2 (get-in puyo-pair [:puyo2 :color])]
+    (js/console.log "é…ç½®åº§æ¨™:"
+                    "puyo1-pos(" (:x puyo1-pos) "," (:y puyo1-pos) ")"
+                    "puyo2-pos(" (:x puyo2-pos) "," (:y puyo2-pos) ")")
+    (js/console.log "é…ç½®è‰²:" "color1=" color1 "color2=" color2)
     (swap! game-state
            update :board
            #(-> %
                 (assoc-in [(:y puyo1-pos) (:x puyo1-pos)] color1)
                 (assoc-in [(:y puyo2-pos) (:x puyo2-pos)] color2)
-                (drop-floating-puyos)))))
+                (drop-floating-puyos)))
+    (js/console.log "âœ“ ãƒœãƒ¼ãƒ‰é…ç½®å®Œäº†")
+    (js/console.log "=== place-puyo-pair! å®Ÿè¡Œçµ‚äº† ===")))
 
 (defn process-line-clear!
-  "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ "
+  "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ãï¼‰"
   []
+  (js/console.log "=== process-line-clear! å®Ÿè¡Œé–‹å§‹ ===")
   (let [board (:board @game-state)
         chain-result (execute-chain board)]
+    (js/console.log "é€£é–çµæœ:" "chains=" (:chain-count chain-result)
+                    "score=" (:total-score chain-result))
     (swap! game-state merge
            {:board (:board chain-result)
             :score (+ (:score @game-state) (:total-score chain-result))
             :chain-count (:chain-count chain-result)})
-    (update-all-game-info!)))
+    (js/console.log "âœ“ ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°å®Œäº†")
+    ;; TODO: update-all-game-info!ã®å‘¼ã³å‡ºã—ã‚’ä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
+    ;; (update-all-game-info!)
+    (js/console.log "=== process-line-clear! å®Ÿè¡Œçµ‚äº† ===")))
 
 (defn init-game-state!
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸåŒ–"
@@ -980,6 +997,17 @@
 (defn start-game
   "ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹"
   []
+  (js/console.log "ğŸš¨ğŸš¨ğŸš¨ start-game é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸï¼ğŸš¨ğŸš¨ğŸš¨")
+  (js/console.log "=== start-game å®Ÿè¡Œé–‹å§‹ ===")
+  (js/console.log "ğŸ“ start-game å‘¼ã³å‡ºã—å…ƒã‚’ç‰¹å®šä¸­...")
+
+  ;; ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å‡ºåŠ›ã—ã¦å‘¼ã³å‡ºã—å…ƒã‚’ç‰¹å®š
+  (try
+    (throw (js/Error. "Stack trace for debugging"))
+    (catch js/Error e
+      (js/console.log "ğŸ“ Stack trace:")
+      (js/console.log (.-stack e))))
+
   (init-game-state!)
   (reset-chain-count!)
   (reset-game-time!)
@@ -990,7 +1018,8 @@
   (start-game-timer!)
   (start-drop-timer!)
   (render-game)
-  (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹!"))
+  (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹!")
+  (js/console.log "=== start-game å®Ÿè¡Œçµ‚äº† ==="))
 
 (defn reset-game
   "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ"
@@ -1004,48 +1033,112 @@
   (render-game)
   (js/console.log "ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ"))
 
+;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²æ¸ˆã¿ãƒ•ãƒ©ã‚°
+(defonce event-listeners-setup (atom false))
+
 (defn setup-event-listeners
-  "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š"
+  "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆé‡è¤‡ç™»éŒ²é˜²æ­¢ä»˜ãï¼‰"
   []
-  ;; ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³
-  (when-let [start-btn (.getElementById js/document "start-button")]
-    (.addEventListener start-btn "click" start-game))
-
-  ;; ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
-  (when-let [reset-btn (.getElementById js/document "reset-button")]
-    (.addEventListener reset-btn "click" reset-game))
-
-  ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
-  (.addEventListener js/document "keydown"
-                     (fn [event]
-                       (when (:game-running @game-state)
-                         (let [key (.-key event)]
-                           (handle-key-input key))))))
+  (js/console.log "=== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹ ===")
+  (if @event-listeners-setup
+    (js/console.log "âœ“ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯æ—¢ã«è¨­å®šæ¸ˆã¿ - ã‚¹ã‚­ãƒƒãƒ—")
+    (do
+      (js/console.log "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’æ–°è¦è¨­å®šä¸­...")
+
+      ;; ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³
+      (when-let [start-btn (.getElementById js/document "start-button")]
+        (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
+        (.addEventListener start-btn "click"
+                           (fn [event]
+                             (js/console.log "ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ")
+                             (js/console.log "ç¾åœ¨ã®ã‚²ãƒ¼ãƒ å®Ÿè¡ŒçŠ¶æ…‹:" (:game-running @game-state))
+                             (if (:game-running @game-state)
+                               (js/console.log "âš ï¸ ã‚²ãƒ¼ãƒ å®Ÿè¡Œä¸­ã®ãŸã‚ã€start-gameã‚’ã‚¹ã‚­ãƒƒãƒ—")
+                               (do
+                                 (js/console.log "âœ… ã‚²ãƒ¼ãƒ åœæ­¢ä¸­ã®ãŸã‚ã€start-gameã‚’å®Ÿè¡Œ")
+                                 (start-game))))))
+
+      ;; ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
+      (when-let [reset-btn (.getElementById js/document "reset-button")]
+        (js/console.log "ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
+        (.addEventListener reset-btn "click" reset-game))
+
+      ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
+      (js/console.log "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š")
+      (.addEventListener js/document "keydown"
+                         (fn [event]
+                           (js/console.log "ğŸ¹ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ - Key:" (.-key event) "Target:" (.-tagName (.-target event)))
+                           (when (:game-running @game-state)
+                             (let [key (.-key event)]
+                               ;; ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’èª¤ã£ã¦ç™ºç«ã•ã›ãªã„ã‚ˆã†ã« preventDefault
+                               (when (= key " ")
+                                 (js/console.log "ğŸš« ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’é˜²æ­¢")
+                                 (.preventDefault event))
+                               (handle-key-input key)))))
+
+      (reset! event-listeners-setup true)
+      (js/console.log "âœ“ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†")))
+  (js/console.log "=== ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šçµ‚äº† ==="))
+
+;; ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
+(defonce app-initialized (atom false))
 
 (defn init
   "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–"
   []
-  (js/console.log "Puyo Puyo Game åˆæœŸåŒ–ä¸­...")
-
-  ;; Canvasè¦ç´ ã®å–å¾—
-  (when-let [canvas-elem (.getElementById js/document "game-board")]
-    (reset! canvas canvas-elem)
-    (reset! ctx (.getContext canvas-elem "2d")))
-
-  ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
-  (init-game-state!)
-
-  ;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
-  (setup-event-listeners)
-
-  ;; åˆæœŸæç”»
-  (render-game)
-
-  (js/console.log "åˆæœŸåŒ–å®Œäº†"))
+  (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹ ===")
+  (if @app-initialized
+    (do
+      (js/console.log "âœ— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ã§ã™ - ã‚¹ã‚­ãƒƒãƒ—")
+      (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–çµ‚äº†ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰ ==="))
+    (do
+      (js/console.log "Puyo Puyo Game åˆæœŸåŒ–ä¸­...")
+
+      ;; Canvasè¦ç´ ã®å–å¾—
+      (when-let [canvas-elem (.getElementById js/document "game-board")]
+        (js/console.log "Canvasè¦ç´ å–å¾—æˆåŠŸ")
+        (reset! canvas canvas-elem)
+        (reset! ctx (.getContext canvas-elem "2d")))
+
+      ;; ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–
+      (js/console.log "ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–å®Ÿè¡Œ")
+      (init-game-state!)
+
+      ;; ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
+      (js/console.log "ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Ÿè¡Œ")
+      (setup-event-listeners)
+
+      ;; åˆæœŸæç”»
+      (js/console.log "åˆæœŸæç”»å®Ÿè¡Œ")
+      (render-game)
+
+      ;; åˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
+      (reset! app-initialized true)
+      (js/console.log "åˆæœŸåŒ–å®Œäº†")
+      (js/console.log "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–çµ‚äº† ==="))))
 
 ;; DOMContentLoadedã§è‡ªå‹•åˆæœŸåŒ–
 (when (exists? js/document)
-  (.addEventListener js/document "DOMContentLoaded" init))
+  (js/console.log "=== DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ===")
+  (.addEventListener js/document "DOMContentLoaded"
+                     (fn [e]
+                       (js/console.log "âœ“ DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆç™ºç« - inité–¢æ•°å‘¼ã³å‡ºã—")
+                       (init)))
+
+  ;; ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ 
+  (.addEventListener js/window "error"
+                     (fn [e]
+                       (js/console.error "âœ—âœ—âœ— ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼æ¤œå‡º âœ—âœ—âœ—")
+                       (js/console.error "Error:" e)
+                       (js/console.error "Message:" (.-message e))
+                       (js/console.error "Filename:" (.-filename e))
+                       (js/console.error "Line:" (.-lineno e))))
+
+  ;; Unhandled Promise Rejectionãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ   
+  (.addEventListener js/window "unhandledrejection"
+                     (fn [e]
+                       (js/console.error "âœ—âœ—âœ— Unhandled Promise Rejection æ¤œå‡º âœ—âœ—âœ—")
+                       (js/console.error "Reason:" (.-reason e)))))
 
 ;; =============================================================================
 ;; T017: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å‡¦ç†
@@ -1063,13 +1156,26 @@
       puyo-pair)))
 
 (defn hard-drop-puyo-pair
-  "çµ„ã·ã‚ˆã‚’ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆæœ€ä¸‹æ®µã¾ã§ä¸€æ°—ã«è½ä¸‹ï¼‰"
+  "çµ„ã·ã‚ˆã‚’ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆæœ€ä¸‹æ®µã¾ã§ä¸€æ°—ã«è½ä¸‹ï¼‰è©³ç´°ãƒ­ã‚°ä»˜ã"
   [puyo-pair board]
-  (loop [current-piece puyo-pair]
+  (js/console.log "=== hard-drop-puyo-pair å®Ÿè¡Œé–‹å§‹ ===")
+  (js/console.log "é–‹å§‹ä½ç½®:"
+                  "puyo1(" (get-in puyo-pair [:puyo1 :x]) "," (get-in puyo-pair [:puyo1 :y]) ")"
+                  "puyo2(" (get-in puyo-pair [:puyo2 :x]) "," (get-in puyo-pair [:puyo2 :y]) ")")
+  (loop [current-piece puyo-pair
+         step-count 0]
+    (js/console.log (str "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ— ã‚¹ãƒ†ãƒƒãƒ— " step-count ":")
+                    "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
+                    "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
     (let [dropped-piece (drop-puyo-pair-one-step current-piece board)]
       (if (= dropped-piece current-piece)
-        current-piece
-        (recur dropped-piece)))))
+        (do
+          (js/console.log "âœ“ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº† - æœ€çµ‚ä½ç½®:"
+                          "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
+                          "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
+          (js/console.log "=== hard-drop-puyo-pair å®Ÿè¡Œçµ‚äº† ===")
+          current-piece)
+        (recur dropped-piece (inc step-count))))))
 
 ;; ç§»å‹•å‡¦ç†é–¢æ•°ç¾¤
 (defn process-left-movement!
@@ -1084,7 +1190,7 @@
                    board (:board state)]
                (if current-piece
                  (do
-                   (js/console.log "å·¦ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:" 
+                   (js/console.log "å·¦ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
                                    "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
                                    "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
                    (let [moved-piece (move-puyo-pair-left current-piece board)]
@@ -1125,7 +1231,7 @@
                    board (:board state)]
                (if current-piece
                  (do
-                   (js/console.log "å³ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:" 
+                   (js/console.log "å³ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
                                    "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
                                    "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
                    (let [moved-piece (move-puyo-pair-right current-piece board)]
@@ -1214,23 +1320,84 @@
           {:result :bottom-reached})))))
 
 (defn process-hard-drop!
-  "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†"
+  "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ï¼ˆè©³ç´°ãƒ­ã‚°ä»˜ã + ã·ã‚ˆå›ºå®šå‡¦ç†ï¼‰"
   []
-  (let [current-piece (:current-piece @game-state)
-        board (:board @game-state)]
-    (when current-piece
-      (let [final-piece (hard-drop-puyo-pair current-piece board)]
-        (swap! game-state assoc :current-piece final-piece)
-        (render-game)
-        {:result :hard-dropped :final-y (get-in final-piece [:puyo1 :y])}))))
+  (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†é–‹å§‹ ===")
+
+  ;; ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ä¸­ã¯ä»–ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢
+  (js/console.log "â¸ï¸ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ä¸­ - ä»–ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢")
+  (stop-drop-timer!)
+
+  (try
+    (let [current-piece (:current-piece @game-state)
+          board (:board @game-state)]
+      (if current-piece
+        (do
+          (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
+                          "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
+                          "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
+          (let [final-piece (hard-drop-puyo-pair current-piece board)]
+            (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
+                            "puyo1(" (get-in final-piece [:puyo1 :x]) "," (get-in final-piece [:puyo1 :y]) ")"
+                            "puyo2(" (get-in final-piece [:puyo2 :x]) "," (get-in final-piece [:puyo2 :y]) ")")
+            (js/console.log "âœ“ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸ - ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«å›ºå®šã—ã¾ã™")
+
+            ;; ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢
+            (swap! game-state assoc :current-piece nil)
+            (js/console.log "ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")
+
+            ;; ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«å›ºå®š
+            (place-puyo-pair! final-piece)
+            (process-line-clear!)
+
+            ;; æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒã‚§ãƒƒã‚¯æ”¹å–„ï¼‰
+            (let [new-piece (spawn-new-puyo-pair)]
+              (js/console.log "æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ç”Ÿæˆä½ç½®:"
+                              "puyo1(" (get-in new-piece [:puyo1 :x]) "," (get-in new-piece [:puyo1 :y]) ")"
+                              "puyo2(" (get-in new-piece [:puyo2 :x]) "," (get-in new-piece [:puyo2 :y]) ")")
+              ;; æ–°ã—ã„ã·ã‚ˆãŒé…ç½®å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå±é™ºãƒ©ã‚¤ãƒ³åˆ¤å®šã§ã¯ãªãé…ç½®å¯èƒ½æ€§ã®ã¿ï¼‰
+              (if (can-place-puyo-pair? new-piece (:board @game-state))
+                (do
+                  (swap! game-state assoc :current-piece new-piece)
+                  (js/console.log "âœ“ æ–°ã—ã„ã·ã‚ˆãƒšã‚¢ç”ŸæˆæˆåŠŸ"))
+                (do
+                  (js/console.log "âœ— ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼: æ–°ã—ã„ã·ã‚ˆã‚’é…ç½®ã§ãã¾ã›ã‚“")
+                  (js/console.log "ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ï¼ˆä¸Šéƒ¨2è¡Œï¼‰:")
+                  (doseq [y [0 1]]
+                    (js/console.log (str "y=" y ": " (vec (for [x (range board-width)] (get-in (:board @game-state) [y x]))))))
+                  (process-game-over!)
+                  (stop-drop-timer!))))
+
+            ;; ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº†å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
+            (js/console.log "â–¶ï¸ ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Œäº† - ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹")
+            (start-drop-timer!)
+
+            (render-game)
+            (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº† ===")
+            {:result :hard-dropped-and-placed :final-y (get-in final-piece [:puyo1 :y])}))
+        (do
+          (js/console.log "âœ— ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
+          (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº† ===")
+          {:result :failed :reason "no-piece"})))
+    (catch js/Error e
+      (js/console.error "âœ—âœ—âœ— ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ âœ—âœ—âœ—")
+      (js/console.error "ã‚¨ãƒ©ãƒ¼è©³ç´°:" e)
+      (js/console.error "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:" (.-message e))
+      (js/console.error "ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:" (.-stack e))
+      ;; ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
+      (start-drop-timer!)
+      (js/console.log "=== ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†çµ‚äº†ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰ ===")
+      {:result :error :error e})))
 
 ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
 ;; ã‚­ãƒ¼å…¥åŠ›ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¶å¾¡
 (def ^:private last-rotation-time (atom 0))
 (def ^:private last-left-move-time (atom 0))
 (def ^:private last-right-move-time (atom 0))
+(def ^:private last-hard-drop-time (atom 0))
 (def ^:private rotation-debounce-ms 200) ; 200msä»¥å†…ã®é€£ç¶šå›è»¢ã‚’é˜²ã
 (def ^:private movement-debounce-ms 100) ; 100msä»¥å†…ã®é€£ç¶šç§»å‹•ã‚’é˜²ã
+(def ^:private hard-drop-debounce-ms 300) ; 300msä»¥å†…ã®é€£ç¶šãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚’é˜²ã
 
 (defn handle-key-input
   "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’å‡¦ç†ã—ã¦ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°"
@@ -1273,7 +1440,17 @@
                       (js/console.log "å›è»¢ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
                       {:result :debounced :reason "too-soon"})))
       "ArrowDown" (process-soft-drop!)
-      " " (process-hard-drop!)
+      " " (let [current-time (js/Date.now)
+                time-since-last-drop (- current-time @last-hard-drop-time)]
+            (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-drop "ms")
+            (if (> time-since-last-drop hard-drop-debounce-ms)
+              (do
+                (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
+                (reset! last-hard-drop-time current-time)
+                (process-hard-drop!))
+              (do
+                (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
+                {:result :debounced :reason "too-soon"})))
       nil)))
 
 ;; T019: ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–¢æ•°ç¾¤

```

## ã‚³ãƒŸãƒƒãƒˆ: 21df835

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
feat: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®é‡è¤‡ã¨ã‚²ãƒ¼ãƒ ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã®ä¿®æ­£
- ã·ã‚ˆè‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…ï¼ˆ500msã‚¿ã‚¤ãƒãƒ¼ï¼‰
- æµ®ã„ã¦ã„ã‚‹ã·ã‚ˆã®é‡åŠ›ã‚·ã‚¹ãƒ†ãƒ ã‚’è¿½åŠ 
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®é‡è¤‡é˜²æ­¢æ©Ÿèƒ½ã‚’å®Ÿè£…
  - å›è»¢: 200msãƒ‡ãƒã‚¦ãƒ³ã‚¹
  - å·¦å³ç§»å‹•: 100msãƒ‡ãƒã‚¦ãƒ³ã‚¹
- ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œã«ã‚ˆã‚‹ç«¶åˆçŠ¶æ…‹ã®è§£æ±º
- è©³ç´°ãƒ­ã‚°ã«ã‚ˆã‚‹å‹•ä½œã®å¯è¦–åŒ–

ä¿®æ­£å†…å®¹:
- è‡ªå‹•è½ä¸‹ä¸­ã®180åº¦å›è»¢å•é¡Œã‚’è§£æ±º â†’ 90åº¦å›è»¢
- å·¦å³ã‚­ãƒ¼ã®2ãƒã‚¹ç§»å‹•å•é¡Œã‚’è§£æ±º â†’ 1ãƒã‚¹ç§»å‹•
- ã·ã‚ˆé…ç½®å¾Œã®æµ®ã„ãŸã·ã‚ˆè‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’è¿½åŠ 
- å…¨54ãƒ†ã‚¹ãƒˆé€šé
- ã‚²ãƒ¼ãƒ åŸºæœ¬æ“ä½œãŒæ­£ç¢ºã«å‹•ä½œ
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs
- A	app/test-gravity.cljs

### å¤‰æ›´å†…å®¹

```diff
commit 21df83529282f12f48d6cd0f698b0ff35379fc44
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 03:30:39 2025 +0000

    feat: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®é‡è¤‡ã¨ã‚²ãƒ¼ãƒ ç‰©ç†ã‚¨ãƒ³ã‚¸ãƒ³ã®ä¿®æ­£
    
    - ã·ã‚ˆè‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…ï¼ˆ500msã‚¿ã‚¤ãƒãƒ¼ï¼‰
    - æµ®ã„ã¦ã„ã‚‹ã·ã‚ˆã®é‡åŠ›ã‚·ã‚¹ãƒ†ãƒ ã‚’è¿½åŠ 
    - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®é‡è¤‡é˜²æ­¢æ©Ÿèƒ½ã‚’å®Ÿè£…
      - å›è»¢: 200msãƒ‡ãƒã‚¦ãƒ³ã‚¹
      - å·¦å³ç§»å‹•: 100msãƒ‡ãƒã‚¦ãƒ³ã‚¹
    - ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œã«ã‚ˆã‚‹ç«¶åˆçŠ¶æ…‹ã®è§£æ±º
    - è©³ç´°ãƒ­ã‚°ã«ã‚ˆã‚‹å‹•ä½œã®å¯è¦–åŒ–
    
    ä¿®æ­£å†…å®¹:
    - è‡ªå‹•è½ä¸‹ä¸­ã®180åº¦å›è»¢å•é¡Œã‚’è§£æ±º â†’ 90åº¦å›è»¢
    - å·¦å³ã‚­ãƒ¼ã®2ãƒã‚¹ç§»å‹•å•é¡Œã‚’è§£æ±º â†’ 1ãƒã‚¹ç§»å‹•
    - ã·ã‚ˆé…ç½®å¾Œã®æµ®ã„ãŸã·ã‚ˆè‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’è¿½åŠ 
    - å…¨54ãƒ†ã‚¹ãƒˆé€šé
    - ã‚²ãƒ¼ãƒ åŸºæœ¬æ“ä½œãŒæ­£ç¢ºã«å‹•ä½œ

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index ade90b1..f41bc7f 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -683,7 +683,8 @@
            update :board
            #(-> %
                 (assoc-in [(:y puyo1-pos) (:x puyo1-pos)] color1)
-                (assoc-in [(:y puyo2-pos) (:x puyo2-pos)] color2)))))
+                (assoc-in [(:y puyo2-pos) (:x puyo2-pos)] color2)
+                (drop-floating-puyos)))))
 
 (defn process-line-clear!
   "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ "
@@ -926,27 +927,37 @@
     (reset! drop-timer nil)))
 
 (defn process-auto-drop!
-  "è‡ªå‹•è½ä¸‹å‡¦ç†ï¼šç¾åœ¨ã®ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ã•ã›ã‚‹"
+  "è‡ªå‹•è½ä¸‹å‡¦ç†ï¼šç¾åœ¨ã®ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ã•ã›ã‚‹ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œï¼‰"
   []
-  (when-let [current-piece (:current-piece @game-state)]
-    (let [board (:board @game-state)
-          dropped-piece (drop-puyo-pair-one-step current-piece board)]
-      (if (= dropped-piece current-piece)
-        ;; è½ä¸‹ã§ããªã„å ´åˆã¯ã·ã‚ˆã‚’é…ç½®ã—ã¦æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆ
-        (do
-          (place-puyo-pair! current-piece)
-          (process-line-clear!)
-          (let [new-piece (spawn-new-puyo-pair)]
-            (if (can-place-puyo-pair? new-piece (:board @game-state))
-              (swap! game-state assoc :current-piece new-piece)
-              ;; æ–°ã—ã„ã·ã‚ˆãŒé…ç½®ã§ããªã„å ´åˆã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
-              (do
-                (process-game-over!)
-                (stop-drop-timer!)))))
-        ;; è½ä¸‹ã§ãã‚‹å ´åˆã¯ä½ç½®ã‚’æ›´æ–°
-        (do
-          (swap! game-state assoc :current-piece dropped-piece)
-          (render-game))))))
+  (let [result (atom nil)]
+    (swap! game-state
+           (fn [state]
+             (if-let [current-piece (:current-piece state)]
+               (let [board (:board state)
+                     dropped-piece (drop-puyo-pair-one-step current-piece board)]
+                 (if (= dropped-piece current-piece)
+                   ;; è½ä¸‹ã§ããªã„å ´åˆã¯ã·ã‚ˆã‚’é…ç½®ã—ã¦æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆ
+                   (do
+                     (reset! result :piece-placed)
+                     state) ; é…ç½®å‡¦ç†ã¯åˆ¥é€”å®Ÿè¡Œ
+                   ;; è½ä¸‹ã§ãã‚‹å ´åˆã¯ä½ç½®ã‚’æ›´æ–°
+                   (do
+                     (reset! result :dropped)
+                     (assoc state :current-piece dropped-piece))))
+               state)))
+    ;; çµæœã«å¿œã˜ã¦å¾Œç¶šå‡¦ç†ã‚’å®Ÿè¡Œ
+    (case @result
+      :piece-placed (do
+                      (place-puyo-pair! (:current-piece @game-state))
+                      (process-line-clear!)
+                      (let [new-piece (spawn-new-puyo-pair)]
+                        (if (can-place-puyo-pair? new-piece (:board @game-state))
+                          (swap! game-state assoc :current-piece new-piece)
+                          (do
+                            (process-game-over!)
+                            (stop-drop-timer!)))))
+      :dropped (render-game)
+      nil)))
 
 (defn render-game
   "ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æç”»"
@@ -1062,46 +1073,131 @@
 
 ;; ç§»å‹•å‡¦ç†é–¢æ•°ç¾¤
 (defn process-left-movement!
-  "å·¦ç§»å‹•å‡¦ç†"
+  "å·¦ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + è©³ç´°ãƒ­ã‚°ï¼‰"
   []
-  (let [current-piece (:current-piece @game-state)
-        board (:board @game-state)]
-    (when current-piece
-      (let [moved-piece (move-puyo-pair-left current-piece board)]
-        (if (not= moved-piece current-piece)
-          (do
-            (js/console.log "å·¦ç§»å‹•æˆåŠŸ")
-            (swap! game-state assoc :current-piece moved-piece)
-            (render-game)
-            {:result :moved :direction :left})
-          (js/console.log "å·¦ç§»å‹•ã§ãã¾ã›ã‚“"))))))
+  (js/console.log "=== å·¦ç§»å‹•å‡¦ç†é–‹å§‹ ===")
+  (let [result (atom nil)
+        start-time (js/Date.now)]
+    (swap! game-state
+           (fn [state]
+             (let [current-piece (:current-piece state)
+                   board (:board state)]
+               (if current-piece
+                 (do
+                   (js/console.log "å·¦ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:" 
+                                   "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
+                                   "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
+                   (let [moved-piece (move-puyo-pair-left current-piece board)]
+                     (if (not= moved-piece current-piece)
+                       (do
+                         (js/console.log "å·¦ç§»å‹•å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
+                                         "puyo1(" (get-in moved-piece [:puyo1 :x]) "," (get-in moved-piece [:puyo1 :y]) ")"
+                                         "puyo2(" (get-in moved-piece [:puyo2 :x]) "," (get-in moved-piece [:puyo2 :y]) ")")
+                         (js/console.log "âœ“ å·¦ç§»å‹•æˆåŠŸ")
+                         (reset! result {:result :moved :direction :left})
+                         (assoc state :current-piece moved-piece))
+                       (do
+                         (js/console.log "âœ— å·¦ç§»å‹•ã§ãã¾ã›ã‚“")
+                         (reset! result {:result :failed :reason "cannot-move"})
+                         state))))
+                 (do
+                   (js/console.log "âœ— å·¦ç§»å‹•å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
+                   (reset! result {:result :failed :reason "no-piece"})
+                   state)))))
+    (let [end-time (js/Date.now)
+          duration (- end-time start-time)]
+      (js/console.log "å·¦ç§»å‹•å‡¦ç†æ™‚é–“:" duration "ms")
+      (when (= (:result @result) :moved)
+        (js/console.log "æç”»å®Ÿè¡Œ")
+        (render-game))
+      (js/console.log "=== å·¦ç§»å‹•å‡¦ç†çµ‚äº† ===")
+      @result)))
 
 (defn process-right-movement!
-  "å³ç§»å‹•å‡¦ç†"
+  "å³ç§»å‹•å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + è©³ç´°ãƒ­ã‚°ï¼‰"
   []
-  (let [current-piece (:current-piece @game-state)
-        board (:board @game-state)]
-    (when current-piece
-      (let [moved-piece (move-puyo-pair-right current-piece board)]
-        (if (not= moved-piece current-piece)
-          (do
-            (js/console.log "å³ç§»å‹•æˆåŠŸ")
-            (swap! game-state assoc :current-piece moved-piece)
-            (render-game)
-            {:result :moved :direction :right})
-          (js/console.log "å³ç§»å‹•ã§ãã¾ã›ã‚“"))))))
+  (js/console.log "=== å³ç§»å‹•å‡¦ç†é–‹å§‹ ===")
+  (let [result (atom nil)
+        start-time (js/Date.now)]
+    (swap! game-state
+           (fn [state]
+             (let [current-piece (:current-piece state)
+                   board (:board state)]
+               (if current-piece
+                 (do
+                   (js/console.log "å³ç§»å‹•å‰ã®ãƒ”ãƒ¼ã‚¹ä½ç½®:" 
+                                   "puyo1(" (get-in current-piece [:puyo1 :x]) "," (get-in current-piece [:puyo1 :y]) ")"
+                                   "puyo2(" (get-in current-piece [:puyo2 :x]) "," (get-in current-piece [:puyo2 :y]) ")")
+                   (let [moved-piece (move-puyo-pair-right current-piece board)]
+                     (if (not= moved-piece current-piece)
+                       (do
+                         (js/console.log "å³ç§»å‹•å¾Œã®ãƒ”ãƒ¼ã‚¹ä½ç½®:"
+                                         "puyo1(" (get-in moved-piece [:puyo1 :x]) "," (get-in moved-piece [:puyo1 :y]) ")"
+                                         "puyo2(" (get-in moved-piece [:puyo2 :x]) "," (get-in moved-piece [:puyo2 :y]) ")")
+                         (js/console.log "âœ“ å³ç§»å‹•æˆåŠŸ")
+                         (reset! result {:result :moved :direction :right})
+                         (assoc state :current-piece moved-piece))
+                       (do
+                         (js/console.log "âœ— å³ç§»å‹•ã§ãã¾ã›ã‚“")
+                         (reset! result {:result :failed :reason "cannot-move"})
+                         state))))
+                 (do
+                   (js/console.log "âœ— å³ç§»å‹•å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
+                   (reset! result {:result :failed :reason "no-piece"})
+                   state)))))
+    (let [end-time (js/Date.now)
+          duration (- end-time start-time)]
+      (js/console.log "å³ç§»å‹•å‡¦ç†æ™‚é–“:" duration "ms")
+      (when (= (:result @result) :moved)
+        (js/console.log "æç”»å®Ÿè¡Œ")
+        (render-game))
+      (js/console.log "=== å³ç§»å‹•å‡¦ç†çµ‚äº† ===")
+      @result)))
 
 (defn process-rotation!
-  "å›è»¢å‡¦ç†"
+  "å›è»¢å‡¦ç†ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œ + äºŒé‡å®Ÿè¡Œé˜²æ­¢ï¼‰"
   []
-  (let [current-piece (:current-piece @game-state)
-        board (:board @game-state)]
-    (when current-piece
-      (let [rotated-piece (rotate-puyo-pair current-piece)]
-        (when (can-place-puyo-pair? rotated-piece board)
-          (swap! game-state assoc :current-piece rotated-piece)
-          (render-game)
-          {:result :rotated :new-rotation (:rotation rotated-piece)})))))
+  (js/console.log "=== å›è»¢å‡¦ç†é–‹å§‹ ===")
+  ;; ã‚¹ãƒ¯ãƒƒãƒ—é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒˆãƒŸãƒƒã‚¯ã«çŠ¶æ…‹ã‚’æ›´æ–°
+  (let [result (atom nil)
+        start-time (js/Date.now)]
+    (swap! game-state
+           (fn [state]
+             (let [current-piece (:current-piece state)
+                   board (:board state)]
+               (if current-piece
+                 (do
+                   (js/console.log "å›è»¢å‰ã®ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹:" (pr-str current-piece))
+                   (js/console.log "å›è»¢å‰ã®å›è»¢çŠ¶æ…‹:" (:rotation current-piece))
+                   (js/console.log "å›è»¢å‰puyo1ä½ç½®:" (get-in current-piece [:puyo1 :x]) (get-in current-piece [:puyo1 :y]))
+                   (js/console.log "å›è»¢å‰puyo2ä½ç½®:" (get-in current-piece [:puyo2 :x]) (get-in current-piece [:puyo2 :y]))
+                   (let [rotated-piece (rotate-puyo-pair current-piece)]
+                     (js/console.log "å›è»¢è¨ˆç®—å¾Œã®ãƒ”ãƒ¼ã‚¹:" (pr-str rotated-piece))
+                     (js/console.log "å›è»¢è¨ˆç®—å¾Œã®çŠ¶æ…‹:" (:rotation rotated-piece))
+                     (js/console.log "å›è»¢è¨ˆç®—å¾Œpuyo1ä½ç½®:" (get-in rotated-piece [:puyo1 :x]) (get-in rotated-piece [:puyo1 :y]))
+                     (js/console.log "å›è»¢è¨ˆç®—å¾Œpuyo2ä½ç½®:" (get-in rotated-piece [:puyo2 :x]) (get-in rotated-piece [:puyo2 :y]))
+                     (if (can-place-puyo-pair? rotated-piece board)
+                       (do
+                         (js/console.log "âœ“ å›è»¢æˆåŠŸ - çŠ¶æ…‹æ›´æ–°å®Ÿè¡Œ")
+                         (reset! result {:result :rotated :new-rotation (:rotation rotated-piece)})
+                         (assoc state :current-piece rotated-piece))
+                       (do
+                         (js/console.log "âœ— å›è»¢å¤±æ•—: é…ç½®ã§ãã¾ã›ã‚“")
+                         (reset! result {:result :failed :reason "cannot-place"})
+                         state))))
+                 (do
+                   (js/console.log "âœ— å›è»¢å¤±æ•—: ç¾åœ¨ã®ãƒ”ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“")
+                   (reset! result {:result :failed :reason "no-piece"})
+                   state)))))
+    ;; çŠ¶æ…‹æ›´æ–°å¾Œã«æç”»ã‚’å®Ÿè¡Œ
+    (let [end-time (js/Date.now)
+          duration (- end-time start-time)]
+      (js/console.log "å›è»¢å‡¦ç†æ™‚é–“:" duration "ms")
+      (when (= (:result @result) :rotated)
+        (js/console.log "æç”»å®Ÿè¡Œ")
+        (render-game))
+      (js/console.log "=== å›è»¢å‡¦ç†çµ‚äº† ===")
+      @result)))
 
 (defn process-soft-drop!
   "é«˜é€Ÿè½ä¸‹å‡¦ç†"
@@ -1129,6 +1225,13 @@
         {:result :hard-dropped :final-y (get-in final-piece [:puyo1 :y])}))))
 
 ;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
+;; ã‚­ãƒ¼å…¥åŠ›ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¶å¾¡
+(def ^:private last-rotation-time (atom 0))
+(def ^:private last-left-move-time (atom 0))
+(def ^:private last-right-move-time (atom 0))
+(def ^:private rotation-debounce-ms 200) ; 200msä»¥å†…ã®é€£ç¶šå›è»¢ã‚’é˜²ã
+(def ^:private movement-debounce-ms 100) ; 100msä»¥å†…ã®é€£ç¶šç§»å‹•ã‚’é˜²ã
+
 (defn handle-key-input
   "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’å‡¦ç†ã—ã¦ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°"
   [key]
@@ -1136,13 +1239,39 @@
   (when (and (:game-running @game-state)
              (:current-piece @game-state))
     (case key
-      "ArrowLeft" (do
-                    (js/console.log "å·¦ç§»å‹•")
-                    (process-left-movement!))
-      "ArrowRight" (do
-                     (js/console.log "å³ç§»å‹•")
-                     (process-right-movement!))
-      "ArrowUp" (process-rotation!)
+      "ArrowLeft" (let [current-time (js/Date.now)
+                        time-since-last-move (- current-time @last-left-move-time)]
+                    (js/console.log "å·¦ç§»å‹•ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-move "ms")
+                    (if (> time-since-last-move movement-debounce-ms)
+                      (do
+                        (js/console.log "å·¦ç§»å‹•å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
+                        (reset! last-left-move-time current-time)
+                        (process-left-movement!))
+                      (do
+                        (js/console.log "å·¦ç§»å‹•ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
+                        {:result :debounced :reason "too-soon"})))
+      "ArrowRight" (let [current-time (js/Date.now)
+                         time-since-last-move (- current-time @last-right-move-time)]
+                     (js/console.log "å³ç§»å‹•ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-move "ms")
+                     (if (> time-since-last-move movement-debounce-ms)
+                       (do
+                         (js/console.log "å³ç§»å‹•å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
+                         (reset! last-right-move-time current-time)
+                         (process-right-movement!))
+                       (do
+                         (js/console.log "å³ç§»å‹•ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
+                         {:result :debounced :reason "too-soon"})))
+      "ArrowUp" (let [current-time (js/Date.now)
+                      time-since-last-rotation (- current-time @last-rotation-time)]
+                  (js/console.log "å›è»¢ã‚­ãƒ¼æ¤œå‡º - å‰å›ã‹ã‚‰ã®çµŒéæ™‚é–“:" time-since-last-rotation "ms")
+                  (if (> time-since-last-rotation rotation-debounce-ms)
+                    (do
+                      (js/console.log "å›è»¢å®Ÿè¡Œ - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶OK")
+                      (reset! last-rotation-time current-time)
+                      (process-rotation!))
+                    (do
+                      (js/console.log "å›è»¢ã‚¹ã‚­ãƒƒãƒ— - ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¡ä»¶NG")
+                      {:result :debounced :reason "too-soon"})))
       "ArrowDown" (process-soft-drop!)
       " " (process-hard-drop!)
       nil)))
diff --git a/app/test-gravity.cljs b/app/test-gravity.cljs
new file mode 100644
index 0000000..f8067f0
--- /dev/null
+++ b/app/test-gravity.cljs
@@ -0,0 +1,47 @@
+(ns test-gravity
+  (:require [puyo.core :as puyo]))
+
+;; é‡åŠ›ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
+(defn test-floating-puyo-gravity []
+  (println "=== æµ®ã„ã¦ã„ã‚‹ã·ã‚ˆã®é‡åŠ›ãƒ†ã‚¹ãƒˆ ===")
+  
+  ;; ãƒ†ã‚¹ãƒˆç”¨ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ä½œæˆ
+  (let [test-board (-> (puyo/create-empty-board)
+                       ;; åº•ã«èµ¤ã·ã‚ˆã‚’é…ç½®
+                       (puyo/place-puyo 3 11 :red)
+                       ;; ç©ºé–“ã‚’ç©ºã‘ã¦ä¸Šã«é’ã·ã‚ˆã‚’é…ç½®ï¼ˆæµ®ã„ãŸçŠ¶æ…‹ï¼‰
+                       (puyo/place-puyo 3 9 :blue))]
+    
+    (println "ãƒ†ã‚¹ãƒˆå‰ã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
+    (doseq [row (range 12)]
+      (let [line (apply str (map #(case (puyo/get-puyo-at test-board % row)
+                                    :red "R"
+                                    :blue "B"
+                                    :green "G"
+                                    :yellow "Y"
+                                    " ") (range 8)))]
+        (println (str row ": " line))))
+    
+    ;; é‡åŠ›ã‚’é©ç”¨
+    (let [after-gravity (puyo/drop-floating-puyos test-board)]
+      (println "\né‡åŠ›é©ç”¨å¾Œã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:")
+      (doseq [row (range 12)]
+        (let [line (apply str (map #(case (puyo/get-puyo-at after-gravity % row)
+                                      :red "R"
+                                      :blue "B"
+                                      :green "G"
+                                      :yellow "Y"
+                                      " ") (range 8)))]
+          (println (str row ": " line))))
+      
+      ;; é’ã·ã‚ˆãŒè½ä¸‹ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
+      (let [blue-at-10 (= :blue (puyo/get-puyo-at after-gravity 3 10))
+            blue-at-9 (= :blue (puyo/get-puyo-at after-gravity 3 9))]
+        (if blue-at-10
+          (println "\nâœ“ ãƒ†ã‚¹ãƒˆæˆåŠŸ: é’ã·ã‚ˆãŒæ­£ã—ãè½ä¸‹ã—ã¾ã—ãŸ")
+          (if blue-at-9
+            (println "\nâœ— ãƒ†ã‚¹ãƒˆå¤±æ•—: é’ã·ã‚ˆãŒè½ä¸‹ã—ã¦ã„ã¾ã›ã‚“")
+            (println "\n? ãƒ†ã‚¹ãƒˆä¸æ˜: é’ã·ã‚ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")))))))
+
+;; ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
+(test-floating-puyo-gravity)

```

## ã‚³ãƒŸãƒƒãƒˆ: e492f65

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
fix: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã§ã·ã‚ˆã®å·¦å³ç§»å‹•ã‚’ä¿®æ­£
- setup-event-listenersã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’handle-key-inputé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ä¿®æ­£
- å¤ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã®ã¿ã§å®Ÿéš›ã®ç§»å‹•å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã„ãªã‹ã£ãŸå•é¡Œã‚’è§£æ±º
- DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã§è‡ªå‹•åˆæœŸåŒ–ã‚’è¿½åŠ 
- ç§»å‹•æˆåŠŸãƒ»å¤±æ•—ã®ãƒ­ã‚°ã‚’è¿½åŠ ã—ã¦ãƒ‡ãƒãƒƒã‚°ã‚’æ”¹å–„

Fixes: ã·ã‚ˆãŒå·¦å³ã«å‹•ã‹ãªã„å•é¡Œã‚’è§£æ±º
Tests: 54ãƒ†ã‚¹ãƒˆå…¨ã¦é€šéã€ã€Œå·¦ç§»å‹•æˆåŠŸã€ã€Œå³ç§»å‹•æˆåŠŸã€ãƒ­ã‚°ã§å‹•ä½œç¢ºèªæ¸ˆã¿
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit e492f650c696dbeef0458a8d5f6b42ab2fcb20d9
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 03:05:30 2025 +0000

    fix: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã§ã·ã‚ˆã®å·¦å³ç§»å‹•ã‚’ä¿®æ­£
    
    - setup-event-listenersã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’handle-key-inputé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ä¿®æ­£
    - å¤ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã®ã¿ã§å®Ÿéš›ã®ç§»å‹•å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã„ãªã‹ã£ãŸå•é¡Œã‚’è§£æ±º
    - DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã§è‡ªå‹•åˆæœŸåŒ–ã‚’è¿½åŠ 
    - ç§»å‹•æˆåŠŸãƒ»å¤±æ•—ã®ãƒ­ã‚°ã‚’è¿½åŠ ã—ã¦ãƒ‡ãƒãƒƒã‚°ã‚’æ”¹å–„
    
    Fixes: ã·ã‚ˆãŒå·¦å³ã«å‹•ã‹ãªã„å•é¡Œã‚’è§£æ±º
    Tests: 54ãƒ†ã‚¹ãƒˆå…¨ã¦é€šéã€ã€Œå·¦ç§»å‹•æˆåŠŸã€ã€Œå³ç§»å‹•æˆåŠŸã€ãƒ­ã‚°ã§å‹•ä½œç¢ºèªæ¸ˆã¿

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index c8d2881..ade90b1 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -1009,13 +1009,7 @@
                      (fn [event]
                        (when (:game-running @game-state)
                          (let [key (.-key event)]
-                           (case key
-                             "ArrowLeft" (js/console.log "å·¦ç§»å‹•")
-                             "ArrowRight" (js/console.log "å³ç§»å‹•")
-                             "ArrowDown" (js/console.log "é«˜é€Ÿè½ä¸‹")
-                             "ArrowUp" (js/console.log "å›è»¢")
-                             " " (js/console.log "ãƒãƒ¼ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—")
-                             nil))))))
+                           (handle-key-input key))))))
 
 (defn init
   "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–"
@@ -1034,7 +1028,13 @@
   (setup-event-listeners)
 
   ;; åˆæœŸæç”»
-  (render-game))
+  (render-game)
+
+  (js/console.log "åˆæœŸåŒ–å®Œäº†"))
+
+;; DOMContentLoadedã§è‡ªå‹•åˆæœŸåŒ–
+(when (exists? js/document)
+  (.addEventListener js/document "DOMContentLoaded" init))
 
 ;; =============================================================================
 ;; T017: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å‡¦ç†
@@ -1068,10 +1068,13 @@
         board (:board @game-state)]
     (when current-piece
       (let [moved-piece (move-puyo-pair-left current-piece board)]
-        (when (not= moved-piece current-piece)
-          (swap! game-state assoc :current-piece moved-piece)
-          (render-game)
-          {:result :moved :direction :left})))))
+        (if (not= moved-piece current-piece)
+          (do
+            (js/console.log "å·¦ç§»å‹•æˆåŠŸ")
+            (swap! game-state assoc :current-piece moved-piece)
+            (render-game)
+            {:result :moved :direction :left})
+          (js/console.log "å·¦ç§»å‹•ã§ãã¾ã›ã‚“"))))))
 
 (defn process-right-movement!
   "å³ç§»å‹•å‡¦ç†"
@@ -1080,10 +1083,13 @@
         board (:board @game-state)]
     (when current-piece
       (let [moved-piece (move-puyo-pair-right current-piece board)]
-        (when (not= moved-piece current-piece)
-          (swap! game-state assoc :current-piece moved-piece)
-          (render-game)
-          {:result :moved :direction :right})))))
+        (if (not= moved-piece current-piece)
+          (do
+            (js/console.log "å³ç§»å‹•æˆåŠŸ")
+            (swap! game-state assoc :current-piece moved-piece)
+            (render-game)
+            {:result :moved :direction :right})
+          (js/console.log "å³ç§»å‹•ã§ãã¾ã›ã‚“"))))))
 
 (defn process-rotation!
   "å›è»¢å‡¦ç†"
@@ -1126,26 +1132,21 @@
 (defn handle-key-input
   "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’å‡¦ç†ã—ã¦ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’æ›´æ–°"
   [key]
+  (js/console.log "Key:" key "Game running:" (:game-running @game-state) "Current piece:" (some? (:current-piece @game-state)))
   (when (and (:game-running @game-state)
              (:current-piece @game-state))
     (case key
-      "ArrowLeft" (process-left-movement!)
-      "ArrowRight" (process-right-movement!)
+      "ArrowLeft" (do
+                    (js/console.log "å·¦ç§»å‹•")
+                    (process-left-movement!))
+      "ArrowRight" (do
+                     (js/console.log "å³ç§»å‹•")
+                     (process-right-movement!))
       "ArrowUp" (process-rotation!)
       "ArrowDown" (process-soft-drop!)
       " " (process-hard-drop!)
       nil)))
 
-;; ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æ›´æ–°
-(defn update-keyboard-handler!
-  "ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’æ–°ã—ã„å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã§æ›´æ–°"
-  []
-  (.addEventListener js/document "keydown"
-                     (fn [event]
-                       (when (:game-running @game-state)
-                         (let [key (.-key event)]
-                           (handle-key-input key))))))
-
 ;; T019: ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–¢æ•°ç¾¤
 (defn reset-game-state!
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸå€¤ã«ãƒªã‚»ãƒƒãƒˆ"

```

## ã‚³ãƒŸãƒƒãƒˆ: dda3bb9

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```
feat: ã·ã‚ˆã®è‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…
- drop-timer atomã‚’è¿½åŠ ã—ã¦ã·ã‚ˆã®è‡ªå‹•è½ä¸‹ã‚’åˆ¶å¾¡
- ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã¨ãƒªã‚»ãƒƒãƒˆæ™‚ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’é©åˆ‡ã«åˆ¶å¾¡
- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†ã‚’æ”¹å–„

Fixes: ã‚²ãƒ¼ãƒ é–‹å§‹ã—ã¦ã‚‚ã·ã‚ˆãŒè½ä¸‹ã—ãªã„å•é¡Œã‚’è§£æ±º
```

### å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- M	app/src/puyo/core.cljs

### å¤‰æ›´å†…å®¹

```diff
commit dda3bb9043b4525054218f39ea81c601472d3fbe
Author: k2works <kakimomokuri@gmail.com>
Date:   Wed Aug 27 02:38:17 2025 +0000

    feat: ã·ã‚ˆã®è‡ªå‹•è½ä¸‹æ©Ÿèƒ½ã‚’å®Ÿè£…
    
    - drop-timer atomã‚’è¿½åŠ ã—ã¦ã·ã‚ˆã®è‡ªå‹•è½ä¸‹ã‚’åˆ¶å¾¡
    - ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã¨ãƒªã‚»ãƒƒãƒˆæ™‚ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’é©åˆ‡ã«åˆ¶å¾¡
    - ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†ã‚’æ”¹å–„
    
    Fixes: ã‚²ãƒ¼ãƒ é–‹å§‹ã—ã¦ã‚‚ã·ã‚ˆãŒè½ä¸‹ã—ãªã„å•é¡Œã‚’è§£æ±º

diff --git a/app/src/puyo/core.cljs b/app/src/puyo/core.cljs
index 3bca79e..c8d2881 100644
--- a/app/src/puyo/core.cljs
+++ b/app/src/puyo/core.cljs
@@ -13,6 +13,7 @@
 (defonce canvas (atom nil))
 (defonce ctx (atom nil))
 (defonce game-timer (atom nil))
+(defonce drop-timer (atom nil))
 
 ;; ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ã®è¨­å®š
 (def board-width 8)
@@ -667,6 +668,34 @@
   []
   (vec (repeat board-height (vec (repeat board-width 0)))))
 
+(defn place-puyo-pair!
+  "çµ„ã·ã‚ˆã‚’ãƒœãƒ¼ãƒ‰ã«é…ç½®ã™ã‚‹"
+  [puyo-pair]
+  (let [positions (get-puyo-pair-positions
+                   (get-in puyo-pair [:puyo1 :x])
+                   (get-in puyo-pair [:puyo1 :y])
+                   (:rotation puyo-pair))
+        puyo1-pos (first positions)
+        puyo2-pos (second positions)
+        color1 (get-in puyo-pair [:puyo1 :color])
+        color2 (get-in puyo-pair [:puyo2 :color])]
+    (swap! game-state
+           update :board
+           #(-> %
+                (assoc-in [(:y puyo1-pos) (:x puyo1-pos)] color1)
+                (assoc-in [(:y puyo2-pos) (:x puyo2-pos)] color2)))))
+
+(defn process-line-clear!
+  "é€£é–å‡¦ç†ã‚’å®Ÿè¡Œã—ã€çµæœã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ "
+  []
+  (let [board (:board @game-state)
+        chain-result (execute-chain board)]
+    (swap! game-state merge
+           {:board (:board chain-result)
+            :score (+ (:score @game-state) (:total-score chain-result))
+            :chain-count (:chain-count chain-result)})
+    (update-all-game-info!)))
+
 (defn init-game-state!
   "ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸåŒ–"
   []
@@ -877,6 +906,48 @@
     (js/clearInterval @game-timer)
     (reset! game-timer nil)))
 
+(defn start-drop-timer!
+  "ã·ã‚ˆè½ä¸‹ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ï¼ˆ500msã”ã¨ã«ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ï¼‰"
+  []
+  (when @drop-timer
+    (js/clearInterval @drop-timer))
+  (reset! drop-timer
+          (js/setInterval
+           (fn []
+             (when (:game-running @game-state)
+               (process-auto-drop!)))
+           500)))
+
+(defn stop-drop-timer!
+  "ã·ã‚ˆè½ä¸‹ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢"
+  []
+  (when @drop-timer
+    (js/clearInterval @drop-timer)
+    (reset! drop-timer nil)))
+
+(defn process-auto-drop!
+  "è‡ªå‹•è½ä¸‹å‡¦ç†ï¼šç¾åœ¨ã®ã·ã‚ˆã‚’1ãƒã‚¹ä¸‹ã«è½ä¸‹ã•ã›ã‚‹"
+  []
+  (when-let [current-piece (:current-piece @game-state)]
+    (let [board (:board @game-state)
+          dropped-piece (drop-puyo-pair-one-step current-piece board)]
+      (if (= dropped-piece current-piece)
+        ;; è½ä¸‹ã§ããªã„å ´åˆã¯ã·ã‚ˆã‚’é…ç½®ã—ã¦æ–°ã—ã„ã·ã‚ˆã‚’ç”Ÿæˆ
+        (do
+          (place-puyo-pair! current-piece)
+          (process-line-clear!)
+          (let [new-piece (spawn-new-puyo-pair)]
+            (if (can-place-puyo-pair? new-piece (:board @game-state))
+              (swap! game-state assoc :current-piece new-piece)
+              ;; æ–°ã—ã„ã·ã‚ˆãŒé…ç½®ã§ããªã„å ´åˆã¯ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
+              (do
+                (process-game-over!)
+                (stop-drop-timer!)))))
+        ;; è½ä¸‹ã§ãã‚‹å ´åˆã¯ä½ç½®ã‚’æ›´æ–°
+        (do
+          (swap! game-state assoc :current-piece dropped-piece)
+          (render-game))))))
+
 (defn render-game
   "ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æç”»"
   []
@@ -906,6 +977,7 @@
          :current-piece (spawn-new-puyo-pair))
   (update-all-game-info!)
   (start-game-timer!)
+  (start-drop-timer!)
   (render-game)
   (js/console.log "ã‚²ãƒ¼ãƒ é–‹å§‹!"))
 
@@ -913,6 +985,7 @@
   "ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ"
   []
   (stop-game-timer!)
+  (stop-drop-timer!)
   (init-game-state!)
   (reset-chain-count!)
   (reset-game-time!)

```

