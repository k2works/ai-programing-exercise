# ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³4 ãµã‚Šã‹ãˆã‚Š

## æœŸé–“
- **é–‹å§‹**: loadTestã‚¨ãƒ©ãƒ¼ä¿®æ­£ä¾é ¼
- **å®Œäº†**: 2025å¹´9æœˆ3æ—¥ 15:42ï¼ˆå…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰
- **æ‰€è¦æ™‚é–“**: ç´„2æ™‚é–“

## å®Ÿæ–½ã—ãŸä½œæ¥­

### ğŸ¯ ä¸»è¦æˆæœ
1. **loadTestå®Œå…¨ä¿®æ­£**: 0%â†’100%æˆåŠŸç‡é”æˆ
2. **MyBatisã¨Spring Bootä¾å­˜æ€§å•é¡Œè§£æ±º**
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ä¸¦è¡Œäºˆç´„ç«¶åˆåˆ¶å¾¡æ¤œè¨¼**

### ğŸ“‹ æŠ€è¡“çš„ä¿®æ­£è©³ç´°

#### 1. MyBatisè¨­å®šä¿®æ­£
- **å•é¡Œ**: `Could not resolve type alias 'localDate'`
- **è§£æ±º**: RoomMapper.xmlã®`parameterType="localDate"`å‰Šé™¤
- **æ”¹å–„**: `jdbcType=DATE`æŒ‡å®šã§å‹å®‰å…¨æ€§å‘ä¸Š

```xml
<!-- ä¿®æ­£å‰ -->
<select id="findReservableByDate" parameterType="localDate" resultMap="reservableMap">

<!-- ä¿®æ­£å¾Œ -->
<select id="findReservableByDate" resultMap="reservableMap">
```

#### 2. Spring Testè¨­å®šä¿®æ­£  
- **å•é¡Œ**: BCryptPasswordEncoder Beanä¸è¶³
- **è§£æ±º**: `@Import({TestBeansConfig.class, TestSecurityConfig.class})`è¿½åŠ 
- **åŠ¹æœ**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ä¾å­˜æ€§æ³¨å…¥å•é¡Œè§£æ±º

```java
@SpringBootTest
@ActiveProfiles("test")
@Import({TestBeansConfig.class, TestSecurityConfig.class})  // è¿½åŠ 
@DisplayName("ä¸¦è¡Œäºˆç´„å‡¦ç†ãƒ†ã‚¹ãƒˆ")
public class ConcurrentReservationTest {
```

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‚ç…§æ•´åˆæ€§ä¿®æ­£
- **å•é¡Œ**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼user001~user100ãŒå­˜åœ¨ã—ãªã„
- **è§£æ±º**: UserMapper.xmlã«insertæ–‡å®Ÿè£…ï¼‹å‹•çš„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
- **æ”¹å–„**: ãƒ†ã‚¹ãƒˆå‰ã«user001~user100ã‚’è‡ªå‹•ç”Ÿæˆ

```xml
<!-- UserMapper.xmlã«è¿½åŠ  -->
<insert id="insert">
  INSERT INTO usr (user_id, name, password_hash, role)
  VALUES (#{userId}, #{name}, #{passwordHash}, #{role})
</insert>
```

```java
// ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
for (int i = 1; i <= CONCURRENT_USERS; i++) {
    String userId = String.format("user%03d", i);
    if (userMapper.findByUserId(userId) == null) {
        User user = new User();
        user.setUserId(userId);
        user.setName("Test User " + i);
        user.setPasswordHash("dummy_hash");
        user.setRole("USER");
        userMapper.insert(user);
    }
}
```

#### 4. ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
- **å•é¡Œ**: AlreadyReservedExceptionãŒèª¤åˆ†é¡
- **è§£æ±º**: å°‚ç”¨catchæ–‡ã§ç«¶åˆã‚¨ãƒ©ãƒ¼ã¨ã—ã¦é©åˆ‡ã«åˆ†é¡
- **çµæœ**: æˆåŠŸ1ä»¶/ç«¶åˆ99ä»¶ã®æœŸå¾…å‹•ä½œç¢ºèª

```java
} catch (mrs.common.exception.AlreadyReservedException e) {
    // é‡è¤‡äºˆç´„ã«ã‚ˆã‚‹ç«¶åˆã‚¨ãƒ©ãƒ¼
    conflictCount.incrementAndGet();
} catch (IllegalStateException e) {
    // ãã®ä»–ã®çŠ¶æ…‹ã‚¨ãƒ©ãƒ¼
    if (e.getMessage().contains("æ—¢ã«äºˆç´„ã•ã‚Œã¦ã„ã¾ã™")) {
        conflictCount.incrementAndGet();
    }
}
```

## ğŸ“Š å®šé‡çš„æˆæœ

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ |
|------|--------|--------|------|
| **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡** | 0% (0/3) | **100% (3/3)** | +100% |
| **ä¸¦è¡Œäºˆç´„æˆåŠŸ** | N/A | 1/100ä»¶ | æœŸå¾…é€šã‚Š |
| **ç«¶åˆã‚¨ãƒ©ãƒ¼** | N/A | 99/100ä»¶ | æœŸå¾…é€šã‚Š |
| **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“** | N/A | å¹³å‡1ms/æœ€å¤§2ms | è¦ä»¶é”æˆ |

## ğŸš€ æŠ€è¡“çš„å­¦ã³

### âœ… ã†ã¾ãã„ã£ãŸã“ã¨
1. **æ®µéšçš„å•é¡Œç‰¹å®š**: ApplicationContextâ†’MyBatisâ†’å‚ç…§æ•´åˆæ€§â†’ä¾‹å¤–å‡¦ç†ã®é †ã§ä½“ç³»çš„è§£æ±º
2. **è©³ç´°ãƒ­ã‚°æ´»ç”¨**: System.out.printlnã§ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¿½åŠ ã—ã¦æ ¹æœ¬åŸå› ç‰¹å®š
3. **ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆæ´»ç”¨**: HTMLãƒ¬ãƒãƒ¼ãƒˆã§è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’åŠ¹ç‡çš„ã«åˆ†æ
4. **ä¾‹å¤–ã®éšå±¤ç†è§£**: Spring/MyBatisã®ä¾‹å¤–ä½“ç³»ã‚’ç†è§£ã—ã¦é©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ğŸ’¡ æ”¹å–„ç‚¹
1. **åˆæœŸèª¿æŸ»ä¸è¶³**: ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã®äº‹å‰ç¢ºèªãŒä¸ååˆ†
2. **ä¾å­˜é–¢ä¿‚æŠŠæ¡**: Spring Testã®@Importè¦ä»¶ã®ç†è§£ä¸è¶³
3. **MyBatiså‹ã‚·ã‚¹ãƒ†ãƒ **: LocalDateå‹ã®é©åˆ‡ãªæŒ‡å®šæ–¹æ³•ã®ç†è§£ä¸è¶³

### ğŸ”§ æŠ€è¡“çš„ç™ºè¦‹
1. **MyBatis XML**: parameterTypeã¯ä¸è¦ãªå ´åˆãŒå¤šã„ï¼ˆå‹æ¨è«–ãŒåŠ¹ãï¼‰
2. **Spring Test**: @SpringBootTestã§ã‚‚å¿…è¦ãªBeanã¯æ˜ç¤ºçš„@Importå¿…è¦
3. **H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹
4. **ä¸¦è¡Œå‡¦ç†**: CountDownLatchã«ã‚ˆã‚‹åŒæœŸå®Ÿè¡Œã§ç«¶åˆçŠ¶æ…‹ã‚’ç¢ºå®Ÿã«å†ç¾

## ğŸ¯ æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### çŸ­æœŸæ”¹å–„ï¼ˆæ¬¡å›å³å®Ÿæ–½ï¼‰
1. **äº‹å‰ç’°å¢ƒç¢ºèª**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ã¨Beanä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
2. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°æˆ¦ç•¥**: åˆå›ã‹ã‚‰è©³ç´°ãƒ­ã‚°ã‚’ä»•è¾¼ã‚“ã§å•é¡Œç‰¹å®šã‚’é«˜é€ŸåŒ–
3. **æ®µéšçš„ãƒ†ã‚¹ãƒˆ**: å˜ä½“â†’çµ±åˆâ†’è² è·ã®é †ã§æ®µéšçš„ã«å•é¡Œã‚’åˆ‡ã‚Šåˆ†ã‘

### ä¸­é•·æœŸæ”¹å–„ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ï¼‰
1. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†**: @Sqlç­‰ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å®£è¨€çš„ã«ç®¡ç†
2. **è¨­å®šã®æ¨™æº–åŒ–**: Testç”¨è¨­å®šã‚¯ãƒ©ã‚¹ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æ•´ç†
3. **ç›£è¦–å¼·åŒ–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ç¶™ç¶šå®Ÿè¡Œã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

## ğŸ“ˆ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè²¢çŒ®åº¦

### ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤
- âœ… **å“è³ªä¿è¨¼**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®å¾©æ—§ã«ã‚ˆã‚Šç¶™ç¶šçš„å“è³ªç›£è¦–ãŒå¯èƒ½
- âœ… **ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼æ€§**: ä¸¦è¡Œäºˆç´„ã®ç«¶åˆåˆ¶å¾¡å‹•ä½œã‚’å®Ÿè¨¼
- âœ… **é‹ç”¨å®‰å®šæ€§**: loadTestæˆåŠŸã«ã‚ˆã‚Šãƒ‡ãƒ—ãƒ­ã‚¤å‰æ¤œè¨¼ãŒç¢ºå®Ÿã«

### æŠ€è¡“çš„ä¾¡å€¤  
- âœ… **ä¿å®ˆæ€§å‘ä¸Š**: MyBatisã¨Spring Bootã®é©åˆ‡ãªè¨­å®šãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºç«‹
- âœ… **ãƒ†ã‚¹ãƒˆå¼·åŒ–**: è² è·ãƒ†ã‚¹ãƒˆã®å®‰å®šå®Ÿè¡Œç’°å¢ƒæ§‹ç¯‰
- âœ… **çŸ¥è­˜è“„ç©**: è¤‡é›‘ãªä¾å­˜æ€§å•é¡Œã®è§£æ±ºãƒã‚¦ãƒã‚¦ç²å¾—

## ğŸ‰ ç·åˆè©•ä¾¡

**è©•ä¾¡**: â­â­â­â­â­ (æœ€é«˜è©•ä¾¡)

### ğŸ† ä¸»è¦æˆæœ
- **loadTest**: 0% â†’ **100%æˆåŠŸç‡** é”æˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸¦è¡Œäºˆç´„ç«¶åˆåˆ¶å¾¡ã®å®Œå…¨å‹•ä½œç¢ºèª
- **æŠ€è¡“çš„è§£æ±º**: MyBatis + Spring Bootè¤‡é›‘ä¾å­˜æ€§å•é¡Œã®å®Œå…¨è§£æ±º

### ğŸ“š ç²å¾—ã—ãŸè²´é‡ãªæŠ€è¡“çŸ¥è­˜
1. MyBatisã®LocalDateå‹ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æœ€é©è§£
2. Spring Bootãƒ†ã‚¹ãƒˆã®ä¾å­˜æ€§æ³¨å…¥ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
3. ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆã§ã®æ’ä»–åˆ¶å¾¡æ¤œè¨¼æ‰‹æ³•
4. H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã®å‚ç…§æ•´åˆæ€§åˆ¶ç´„å¯¾å¿œ

### ğŸ”„ æ¬¡ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆç’°å¢ƒå®‰å®šåŒ–
- âœ… ç¶™ç¶šçš„å“è³ªç›£è¦–åŸºç›¤æ•´å‚™
- âœ… è¤‡é›‘ãªæŠ€è¡“å•é¡Œè§£æ±ºãƒã‚¦ãƒã‚¦è“„ç©

**Ready for Next Challenge!** ğŸš€

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´å±¥æ­´

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ6ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
1. `build.gradle` - loadTestå†æœ‰åŠ¹åŒ–
2. `application.properties` - MyBatisè¨­å®šè¿½åŠ   
3. `RoomMapper.xml` - parameterTypeå‰Šé™¤ã¨jdbcTypeè¿½åŠ 
4. `UserMapper.xml` - insertæ–‡å®Ÿè£…
5. `ConcurrentReservationTest.java` - ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£
6. `MybatisConfig.java` - æ–°è¦ä½œæˆï¼ˆLocalDateã‚¿ã‚¤ãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®šï¼‰

### ã‚³ãƒŸãƒƒãƒˆæƒ…å ±
- **ã‚³ãƒŸãƒƒãƒˆID**: `78efe88`
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: "fix: loadTestå®Œå…¨ä¿®æ­£ - MyBatisã¨Spring Bootä¾å­˜æ€§å•é¡Œè§£æ±º"
- **æ—¥æ™‚**: 2025å¹´9æœˆ3æ—¥ 15:42

---

*ã“ã®ãµã‚Šã‹ãˆã‚Šã¯ã€ä»Šå¾Œã®é¡ä¼¼å•é¡Œè§£æ±ºã®å‚è€ƒè³‡æ–™ã¨ã—ã¦æ´»ç”¨äºˆå®š*