# 実装計画

- [x] 1. プロジェクト構造とコアHTML/CSS基盤のセットアップ





  - canvas要素と基本レイアウトを含むメインHTMLファイルを作成
  - レスポンシブデザインとゲームUIスタイリング用のCSSをセットアップ
  - ES6 imports/exportsを使用したJavaScriptモジュール構造を作成
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [x] 2. コアデータモデルとゲーム状態管理の実装





  - [x] 2.1 色、位置、状態プロパティを持つPuyoクラスの作成


    - 色と位置の検証を含むPuyoコンストラクターを記述
    - 状態管理メソッド（落下中、固定、消去中）を実装
    - Puyoクラス機能のユニットテストを作成
    - _要件: 5.1, 5.2, 5.3_


  - [x] 2.2 落下するぷよペアを管理するPuyoPairクラスの作成

    - 2つのPuyoインスタンスを持つPuyoPairコンストラクターを実装
    - 4つの向き（0°、90°、180°、270°）での回転ロジックを追加
    - ペアの回転と位置決めのユニットテストを記述
    - _要件: 2.1, 2.2, 2.3, 3.3_


  - [x] 2.3 全体的なゲーム状態追跡のためのGameStateクラスの実装

    - フィールド配列、スコア、レベル、ステータスプロパティを持つGameStateを作成
    - 状態遷移（プレイ中、一時停止、ゲームオーバー）のメソッドを追加
    - 状態管理のユニットテストを記述
    - _要件: 1.1, 1.2, 8.1, 8.2, 9.1, 9.2_

- [x] 3. フィールド管理システムの作成





  - [x] 3.1 12x6グリッド操作のためのFieldManagerクラスの実装


    - プレイフィールドの2D配列表現を作成
    - getCell、setCell、isValidPositionメソッドを実装
    - 境界チェックと衝突検出を追加
    - フィールド操作のユニットテストを記述
    - _要件: 4.2, 4.3, 5.1_


  - [x] 3.2 ぷよ落下メカニクスのための重力システムの追加

    - ぷよを空きスペースに落下させるapplyGravityメソッドを実装
    - 複数のぷよが落下する必要がある場合のカスケード落下を処理
    - 重力適用シナリオのユニットテストを記述
    - _要件: 4.3_

  - [x] 3.3 接続グループ検出アルゴリズムの作成


    - flood-fillアルゴリズムを使用したfindConnectedGroupsを実装
    - 水平/垂直方向の4つ以上の同色ぷよグループを検出
    - 様々なグループ検出シナリオのユニットテストを記述
    - _要件: 5.1, 5.4_

- [ ] 4. ぷよ移動と配置ロジックの実装
  - [ ] 4.1 ぷよライフサイクル管理のためのPuyoManagerクラスの作成
    - ランダム色生成を含むspawnPuyoPairメソッドを実装
    - ゲーム状態用のgetCurrentPairとgetNextPairメソッドを追加
    - ぷよ生成と管理のユニットテストを記述
    - _要件: 1.3, 4.4, 10.1, 10.2_

  - [ ] 4.2 左/右/下操作のための移動メソッドの追加
    - 方向検証を含むmovePairメソッドを実装
    - 無効な移動を防ぐ衝突検出を追加
    - フィールド端の境界チェックを処理
    - 移動検証のユニットテストを記述
    - _要件: 2.1, 2.2, 2.5, 3.1, 3.2_

  - [ ] 4.3 ぷよペアの回転ロジックの実装
    - 時計回り回転のrotatePairメソッドを作成
    - 回転が衝突を引き起こす場合のウォールキックを処理
    - 占有されたスペースへの回転を防ぐ検証を追加
    - エッジケースを含む回転シナリオのユニットテストを記述
    - _要件: 2.3, 3.3_

  - [ ] 4.4 自動落下と配置メカニクスの追加
    - 加速落下のためのdropPairメソッドを実装
    - ぷよが着地したときに配置するfixPairToFieldメソッドを作成
    - 自然落下速度のタイミングロジックを追加
    - 落下と配置メカニクスのユニットテストを記述
    - _要件: 2.4, 4.1, 4.2, 4.4_

- [ ] 5. 入力処理システムの作成
  - [ ] 5.1 キーボード入力ハンドラーの実装
    - キーボードイベントリスナーを持つInputHandlerクラスを作成
    - 矢印キーを移動と回転アクションにマップ
    - 滑らかな連続移動のためのキーリピート処理を追加
    - キーボード入力処理のユニットテストを記述
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [ ] 5.2 モバイルデバイス用のタッチ入力サポートの追加
    - タップとスワイプジェスチャーのタッチイベントハンドラーを実装
    - タッチゾーンをゲーム操作にマップ（左/右タップ、回転用ぷよタップ）
    - 高速落下のためのスワイプダウン検出を追加
    - タッチ入力認識のユニットテストを記述
    - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ] 6. スコアリングと連鎖反応システムの実装
  - [ ] 6.1 ぷよ消去のための基本スコアリングメカニズムの作成
    - 接続されたぷよを除去するclearGroupsメソッドを実装
    - 消去されたぷよの数に基づくポイント計算を追加
    - リアルタイムでスコア表示を更新
    - 基本スコアリング計算のユニットテストを記述
    - _要件: 5.2, 8.1, 8.2_

  - [ ] 6.2 連鎖反応検出と計算の追加
    - 多段階消去シーケンスを追跡するChainクラスを作成
    - 指数スケーリングによる連鎖倍率計算を実装
    - 連鎖数追跡と表示を追加
    - 連鎖検出とスコアリングのユニットテストを記述
    - _要件: 6.1, 6.2, 6.3, 6.4, 8.3_

  - [ ] 6.3 全消し（Zenkeshi）ボーナスシステムの実装
    - フィールドからすべてのぷよが消去されたときの検出を追加
    - 全消しに対する大幅なボーナスポイントを計算・授与
    - 全消し達成のための特別な視覚フィードバックを作成
    - 全消し検出とボーナス計算のユニットテストを記述
    - _要件: 7.1, 7.2, 7.3_

- [ ] 7. HTML5 Canvasを使用したレンダリングシステムの作成
  - [ ] 7.1 基本Canvasレンダラーの実装
    - canvasコンテキスト管理を持つRendererクラスを作成
    - 12x6グリッドを描画するrenderFieldメソッドを追加
    - 色分けされた円/四角形でrenderPuyoメソッドを実装
    - レンダリングメソッド呼び出しのユニットテストを記述
    - _要件: 11.4_

  - [ ] 7.2 ぷよとUIレンダリングの追加
    - スコア、連鎖数、次のぷよ表示のためのrenderUIメソッドを実装
    - 落下中と固定されたぷよの視覚的区別を追加
    - 次のぷよプレビューエリアレンダリングを作成
    - UI要素配置のユニットテストを記述
    - _要件: 8.1, 8.2, 8.3, 10.1, 10.3_

  - [ ] 7.3 視覚フィードバックのためのアニメーションシステムの実装
    - 滑らかなぷよ移動のためのAnimationクラスを作成
    - フェードアウト効果を含む消去アニメーションを追加
    - 連鎖反応の視覚ハイライトを実装
    - アニメーションタイミングと状態管理のユニットテストを記述
    - _要件: 5.3, 6.4, 7.3, 11.1, 11.2, 11.3_

- [ ] 8. ゲームループと状態管理の実装
  - [ ] 8.1 メインGameEngineクラスの作成
    - requestAnimationFrameを使用したゲームループを実装
    - 更新とレンダリングサイクル管理を追加
    - start、pause、resume、restartメソッドを作成
    - ゲームエンジンライフサイクルのユニットテストを記述
    - _要件: 1.1, 1.2_

  - [ ] 8.2 ゲームオーバー検出と処理の追加
    - フィールドオーバーフローをチェックするisGameOverメソッドを実装
    - 最終スコア表示を含むゲームオーバー画面を作成
    - ゲームオーバー時の再開とメニューオプションを追加
    - ゲームオーバー条件のユニットテストを記述
    - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 9. すべてのコンポーネントを統合し、完全なゲーム体験を作成
  - [ ] 9.1 すべてのゲームシステムの連携
    - 入力ハンドラーをぷよ移動とゲームアクションに接続
    - フィールド管理をレンダリングシステムと統合
    - スコアリングシステムをUI更新にリンク
    - 完全なゲームフローの統合テストを記述
    - _要件: すべての要件_

  - [ ] 9.2 レスポンシブデザインとモバイル最適化の追加
    - 異なる画面サイズ用のcanvasスケーリングを実装
    - モバイルデバイス用のタッチ操作を最適化
    - ビューポートメタタグとレスポンシブCSSを追加
    - 異なる画面解像度のテストを記述
    - _要件: 3.1, 3.2, 3.3, 3.4_

  - [ ] 9.3 最終的な仕上げとユーザーエクスペリエンス機能の実装
    - 効果音プレースホルダーとオーディオ統合ポイントを追加
    - ゲーム状態間の滑らかな遷移を作成
    - 改良されたグラフィックとアニメーションで視覚的な仕上げを追加
    - 完全なユーザーシナリオのエンドツーエンドテストを記述
    - _要件: 5.3, 6.4, 7.3, 11.1, 11.2, 11.3_