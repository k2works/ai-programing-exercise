# Implementation Plan

- [x] 1. プロジェクト基盤とコア型定義の設定


  - TypeScript設定とReact開発環境を構築
  - ドメイン型（PuyoColor、Position、Direction）を定義
  - 基本的なプロジェクト構造を作成
  - _Requirements: 1.1, 10.1_

- [x] 2. ドメインモデルの実装

- [x] 2.1 Puyoエンティティの実装


  - Puyoインターフェースと関連する型を定義
  - Puyo作成とプロパティアクセスの単体テストを作成
  - 不変性を保証するPuyo実装を作成
  - _Requirements: 2.1, 4.1_

- [x] 2.2 GameFieldモデルの実装


  - GameFieldインターフェースを定義
  - フィールド操作（placePuyo、removePuyos）の単体テストを作成
  - GameField実装とぷよ配置ロジックを作成
  - _Requirements: 3.1, 4.1, 10.1_

- [x] 2.3 GameStateモデルの実装


  - GameStateとPuyoPairインターフェースを定義
  - ゲーム状態管理の単体テストを作成
  - GameState実装と状態遷移ロジックを作成
  - _Requirements: 1.2, 3.1, 7.1_
  
- [x] 3. ドメインサービスの実装






- [x] 3.1 PuyoMatcherサービスの実装


  - 隣接するぷよの検索アルゴリズムの単体テストを作成
  - 同じ色のぷよを4つ以上見つけるロジックを実装
  - 連結されたぷよグループを特定する機能を実装
  - _Requirements: 4.1, 4.2_

- [x] 3.2 ChainCalculatorサービスの実装


  - 連鎖計算ロジックの単体テストを作成
  - 連鎖数とボーナス倍率の計算を実装
  - 全消しボーナスの判定と計算を実装
  - _Requirements: 5.1, 5.2, 6.1, 6.3_

- [x] 3.3 GameRuleEngineサービスの実装


  - ゲームルール検証の単体テストを作成
  - ぷよ移動・回転の有効性検証を実装
  - ゲームオーバー判定ロジックを実装
  - _Requirements: 2.5, 2.6, 7.1_

- [x] 4. アプリケーション層の実装





- [x] 4.1 ポートインターフェースの定義


  - GameRepository、InputHandler、GameRendererインターフェースを定義
  - インターフェースの契約を明確にする単体テストを作成
  - 依存性注入のための基盤を構築
  - _Requirements: 1.1, 2.1, 8.1_

- [x] 4.2 GameServiceの実装


  - ゲーム操作（移動、回転、落下）の統合テストを作成
  - GameServiceクラスとメソッドを実装
  - ドメインサービスとの連携ロジックを実装
  - _Requirements: 1.1, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2_
  
  - [x] 4.3 Zustand状態管理の実装


  - gameStoreとuiStoreの統合テストを作成
  - Zustandストアの実装とアクションを作成
  - 状態更新とリアクティブな変更通知を実装
  - _Requirements: 1.2, 1.3, 8.1, 8.2_

- [x] 5. インフラストラクチャ層の実装





- [x] 5.1 入力処理システムの実装


  - KeyboardInputHandlerの単体テストを作成
  - キーボード入力のマッピングと処理を実装
  - 入力イベントのゲームアクション変換を実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4_


- [x] 5.2 タッチ入力処理の実装

  - TouchInputHandlerの単体テストを作成
  - タッチジェスチャーの認識と処理を実装
  - スワイプとタップのゲームアクション変換を実装
  - _Requirements: 9.1, 9.2, 9.3, 9.4_



- [x] 5.3 ローカルストレージリポジトリの実装
  - LocalStorageGameRepositoryの単体テストを作成
  - ゲーム状態の保存と読み込み機能を実装
  - エラーハンドリングとデータ検証を実装
  - _Requirements: 1.1, 7.3_

- [x] 6. プレゼンテーション層の基盤実装

- [x] 6.1 カスタムフックの実装
  - useGameState、useInputHandler、useGameLoopフックの単体テストを作成
  - ゲーム状態管理とライフサイクル管理のフックを実装
  - 入力処理とゲームループの統合フックを実装
  - _Requirements: 1.1, 2.1, 3.1, 8.1_
  
- [x] 6.2 基本UIコンポーネントの実装


  - GameBoard、ScoreDisplay、NextPuyoDisplayコンポーネントのテストを作成
  - ゲームフィールドの視覚的表示コンポーネントを実装
  - スコアと次のぷよの表示コンポーネントを実装
  - _Requirements: 8.1, 8.2, 10.1, 10.2, 10.3_

- [x] 7. ゲームロジックの統合






- [x] 7.1 ぷよ落下システムの実装



  - 自動落下とぷよ固定の統合テストを作成
  - 重力システムとぷよ配置ロジックを実装
  - 新しい組ぷよ生成とフィールド更新を実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 7.2 ぷよ消去と連鎖システムの実装


  - ぷよ消去と連鎖反応の統合テストを作成
  - 消去判定と連鎖計算の統合ロジックを実装
  - アニメーション対応の消去処理を実装
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4_

- [x] 7.3 スコアシステムの統合


  - スコア計算と表示の統合テストを作成
  - 基本スコア、連鎖ボーナス、全消しボーナスの統合を実装
  - リアルタイムスコア更新とハイライト表示を実装
  - _Requirements: 4.2, 5.1, 5.2, 6.1, 6.3, 8.1, 8.2, 8.3_

- [ ] 8. ゲーム制御システムの実装
- [ ] 8.1 ゲーム開始・終了機能の実装
  - ゲーム開始、リスタート、ゲームオーバーの統合テストを作成
  - 新しいゲーム開始とフィールド初期化を実装
  - ゲームオーバー判定と終了処理を実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 7.1, 7.2, 7.3, 7.4_
  
- [ ] 8.2 ゲーム操作の統合
  - 全ての入力操作（キーボード・タッチ）の統合テストを作成
  - 入力処理からゲーム状態更新までの完全なフローを実装
  - 操作の無効化とエラーハンドリングを実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 9.1, 9.2, 9.3, 9.4_

- [ ] 9. UI/UXの完成
- [ ] 9.1 ゲーム画面の完成
  - 完全なゲーム画面の統合テストを作成
  - GamePageコンポーネントと全体レイアウトを実装
  - レスポンシブデザインとアクセシビリティ対応を実装
  - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [ ] 9.2 アニメーションと視覚効果の実装
  - ぷよ消去、連鎖、ゲームオーバーアニメーションのテストを作成
  - CSS/Framer Motionを使用したアニメーション効果を実装
  - パフォーマンス最適化されたアニメーションシステムを実装
  - _Requirements: 4.4, 5.3, 6.2, 7.2, 10.4_

- [ ] 10. 最終統合とテスト
- [ ] 10.1 E2Eテストの実装
  - 完全なゲームプレイフローのE2Eテストを作成
  - ユーザーシナリオベースのテストケースを実装
  - クロスブラウザ対応のテストを実装
  - _Requirements: 全要件_

- [ ] 10.2 パフォーマンス最適化
  - パフォーマンステストとベンチマークを作成
  - React.memoとuseMemoによる最適化を実装
  - バンドルサイズとロード時間の最適化を実装
  - _Requirements: 全要件_

- [ ] 10.3 最終的な統合とデプロイ準備
  - 全機能の統合テストを実行
  - プロダクションビルドの設定と検証を実装
  - デプロイメント設定とCI/CD準備を完了
  - _Requirements: 全要件_