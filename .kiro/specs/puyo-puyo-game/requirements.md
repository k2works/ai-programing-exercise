# Requirements Document

## Introduction

ぷよぷよは、落ちてくる色付きの「ぷよ」を操作して、同じ色のぷよを4つ以上つなげて消去するパズルゲームです。プレイヤーは連鎖反応を起こすことで高得点を狙うことができます。このアプリケーションは、TypeScriptとReactを使用してWebブラウザ上で動作するぷよぷよゲームを提供します。

## Requirements

### Requirement 1: ゲーム開始機能

**User Story:** プレイヤーとして、新しいゲームを開始できるようにしたい。そうすることで、いつでも新しいゲームセッションを始めることができる。

#### Acceptance Criteria

1. WHEN プレイヤーが「新しいゲーム」ボタンをクリック THEN システム SHALL 新しいゲームセッションを開始する
2. WHEN 新しいゲームが開始される THEN システム SHALL フィールドを空の状態に初期化する
3. WHEN 新しいゲームが開始される THEN システム SHALL スコアを0にリセットする
4. WHEN 新しいゲームが開始される THEN システム SHALL 最初の組ぷよを生成して表示する

### Requirement 2: ぷよ操作機能

**User Story:** プレイヤーとして、落ちてくるぷよを自由に操作できるようにしたい。そうすることで、戦略的にぷよを配置することができる。

#### Acceptance Criteria

1. WHEN プレイヤーが左矢印キーを押す THEN システム SHALL 組ぷよを左に1マス移動する
2. WHEN プレイヤーが右矢印キーを押す THEN システム SHALL 組ぷよを右に1マス移動する
3. WHEN プレイヤーが上矢印キーまたはスペースキーを押す THEN システム SHALL 組ぷよを時計回りに90度回転する
4. WHEN プレイヤーが下矢印キーを押す THEN システム SHALL 組ぷよを高速落下させる
5. IF 組ぷよが壁やフィールドの端に接触している THEN システム SHALL 移動操作を無効にする
6. IF 組ぷよが他のぷよと重なる位置に移動しようとする THEN システム SHALL 移動操作を無効にする

### Requirement 3: ぷよ落下システム

**User Story:** プレイヤーとして、ぷよが自然に落下する様子を見たい。そうすることで、リアルなゲーム体験を得ることができる。

#### Acceptance Criteria

1. WHEN ゲームが進行中 THEN システム SHALL 組ぷよを一定間隔で自動的に下に落下させる
2. WHEN 組ぷよが床または他のぷよに接触 THEN システム SHALL 組ぷよをその位置に固定する
3. WHEN ぷよが固定される THEN システム SHALL 新しい組ぷよを生成して上部から落下開始する
4. IF ぷよに下方向の空白がある THEN システム SHALL そのぷよを強制的に落下させる

### Requirement 4: ぷよ消去システム

**User Story:** プレイヤーとして、同じ色のぷよを4つ以上つなげて消去できるようにしたい。そうすることで、ゲームの基本的な目標を達成できる。

#### Acceptance Criteria

1. WHEN 同じ色のぷよが縦横に4つ以上隣接 THEN システム SHALL それらのぷよを消去する
2. WHEN ぷよが消去される THEN システム SHALL 消去されたぷよの数に応じてスコアを加算する
3. WHEN ぷよが消去される THEN システム SHALL 上にあるぷよを重力に従って落下させる
4. IF 消去後に再び4つ以上のぷよが隣接 THEN システム SHALL 連鎖として追加消去を実行する

### Requirement 5: 連鎖システム

**User Story:** プレイヤーとして、連鎖反応を起こしてより高いスコアを獲得したい。そうすることで、戦略的なプレイの楽しさを味わうことができる。

#### Acceptance Criteria

1. WHEN 連鎖が発生 THEN システム SHALL 連鎖数に応じたボーナス倍率をスコアに適用する
2. WHEN 連鎖が発生 THEN システム SHALL 連鎖数を画面に表示する
3. WHEN 連鎖が終了 THEN システム SHALL 連鎖数表示をリセットする
4. IF 複数色が同時に消去される THEN システム SHALL それを1連鎖として扱う

### Requirement 6: 全消しボーナス

**User Story:** プレイヤーとして、フィールドのすべてのぷよを消去したときに特別なボーナスを獲得したい。そうすることで、完璧なプレイに対する報酬を得ることができる。

#### Acceptance Criteria

1. WHEN フィールド上のすべてのぷよが消去される THEN システム SHALL 全消しボーナスを付与する
2. WHEN 全消しボーナスが発生 THEN システム SHALL 特別な演出を表示する
3. WHEN 全消しボーナスが発生 THEN システム SHALL ボーナススコアを加算する

### Requirement 7: ゲームオーバー判定

**User Story:** プレイヤーとして、ゲームオーバーの条件が明確に判定されるようにしたい。そうすることで、公平なゲーム終了を体験できる。

#### Acceptance Criteria

1. WHEN 新しい組ぷよが生成位置に配置できない THEN システム SHALL ゲームオーバーを判定する
2. WHEN ゲームオーバーが判定される THEN システム SHALL ゲーム終了の演出を表示する
3. WHEN ゲームオーバーが判定される THEN システム SHALL 最終スコアを表示する
4. WHEN ゲームオーバー演出が完了 THEN システム SHALL リスタートオプションを提供する

### Requirement 8: スコア表示システム

**User Story:** プレイヤーとして、現在のスコアをリアルタイムで確認したい。そうすることで、自分の進捗を把握できる。

#### Acceptance Criteria

1. WHEN ゲームが進行中 THEN システム SHALL 現在のスコアを常に画面に表示する
2. WHEN スコアが更新される THEN システム SHALL 新しいスコアを即座に反映する
3. WHEN 連鎖やボーナスが発生 THEN システム SHALL 獲得ポイントを一時的に強調表示する

### Requirement 9: タッチ操作対応

**User Story:** プレイヤーとして、タッチデバイスでもゲームを操作できるようにしたい。そうすることで、スマートフォンやタブレットでもプレイできる。

#### Acceptance Criteria

1. WHEN プレイヤーが画面をスワイプ THEN システム SHALL スワイプ方向に応じてぷよを移動する
2. WHEN プレイヤーが画面をタップ THEN システム SHALL ぷよを回転する
3. WHEN プレイヤーが画面を下方向にスワイプ THEN システム SHALL ぷよを高速落下させる
4. IF タッチ操作とキーボード操作が同時に発生 THEN システム SHALL 両方の入力を適切に処理する

### Requirement 10: ゲームフィールド表示

**User Story:** プレイヤーとして、ゲームフィールドとぷよの状態を視覚的に確認したい。そうすることで、適切な判断を下すことができる。

#### Acceptance Criteria

1. WHEN ゲームが表示される THEN システム SHALL 12×6のゲームフィールドを表示する
2. WHEN ぷよがフィールドに配置される THEN システム SHALL ぷよを適切な色で表示する
3. WHEN 次の組ぷよが決定される THEN システム SHALL NEXTぷよとして予告表示する
4. WHEN ぷよが消去される THEN システム SHALL 消去アニメーションを表示する