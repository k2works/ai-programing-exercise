# 要件定義書

## 概要

この文書は、ぷよぷよパズルゲームアプリケーションの開発要件を定義します。ぷよぷよは、落下する色付きブロック（「ぷよ」と呼ばれる）を操作して、同じ色のぷよを4つ以上つなげて消去し、連鎖反応を起こして高得点を狙う古典的なタイルマッチングパズルゲームです。ゲームは12×6のグリッド型プレイフィールド、キーボードとタッチ操作、戦略的な連鎖構築を報酬とするスコアリングメカニクスを特徴とします。

## 要件

### 要件1

**ユーザーストーリー:** プレイヤーとして、新しいゲームを開始したい。そうすることで、新しい状態からぷよぷよをプレイできる。

#### 受入基準

1. プレイヤーが「新しいゲーム」を選択したとき、システムは12×6のクリーンなプレイフィールドを初期化する
2. 新しいゲームが開始されたとき、システムはスコアをゼロにリセットする
3. 新しいゲームが開始されたとき、システムはフィールドの上部中央に最初のぷよペアを生成する
4. 新しいゲームが開始されたとき、システムはプレビューエリアに次のぷよペアを表示する

### 要件2

**ユーザーストーリー:** プレイヤーとして、キーボード入力で落下するぷよを操作したい。そうすることで、プレイフィールド上に戦略的に配置できる。

#### 受入基準

1. プレイヤーが左矢印キーを押したとき、スペースがある場合、システムは落下するぷよペアを左に1つ分移動させる
2. プレイヤーが右矢印キーを押したとき、スペースがある場合、システムは落下するぷよペアを右に1つ分移動させる
3. プレイヤーが上矢印キーまたはスペースバーを押したとき、システムはぷよペアを時計回りに回転させる
4. プレイヤーが下矢印キーを押したとき、システムは現在のぷよペアの落下速度を加速させる
5. ぷよペアが要求された方向に移動できない場合、システムは入力を無視する

### 要件3

**ユーザーストーリー:** プレイヤーとして、タッチ入力で落下するぷよを操作したい。そうすることで、モバイルデバイスでゲームをプレイできる。

#### 受入基準

1. プレイヤーが画面の左側をタップしたとき、スペースがある場合、システムは落下するぷよペアを左に1つ分移動させる
2. プレイヤーが画面の右側をタップしたとき、スペースがある場合、システムは落下するぷよペアを右に1つ分移動させる
3. プレイヤーがぷよペアをタップしたとき、システムはぷよペアを時計回りに回転させる
4. プレイヤーが下にスワイプしたとき、システムは現在のぷよペアの落下速度を加速させる

### 要件4

**ユーザーストーリー:** プレイヤーとして、ぷよが自動的に落下して定着してほしい。そうすることで、常に入力しなくてもゲームが自然に進行する。

#### 受入基準

1. ぷよが生成されたとき、システムは一定の速度で下向きに落下させる
2. 落下するぷよがフィールドの底または他の定着したぷよに当たったとき、システムはそれらをその場に固定する
3. 他のぷよが消去された後、ぷよの下に空きスペースがあるとき、システムはそのぷよを落下させて隙間を埋める
4. ぷよがその場に固定されたとき、システムは上部中央に次のぷよペアを生成する

### 要件5

**ユーザーストーリー:** プレイヤーとして、同じ色のぷよが4つ以上つながったときに消えてほしい。そうすることで、フィールドをクリアしてポイントを獲得できる。

#### 受入基準

1. 同じ色のぷよが4つ以上水平または垂直につながったとき、システムはそれらをフィールドから除去する
2. ぷよが除去されたとき、システムは消去されたぷよの数に基づいてプレイヤーのスコアにポイントを追加する
3. ぷよが消去されたとき、システムは消去アニメーションと効果音を再生する
4. 同じ色の複数のグループが同時に消去される場合、システムはそれを単一の連鎖リンクとして扱う

### 要件6

**ユーザーストーリー:** プレイヤーとして、連鎖反応を作りたい。そうすることで、戦略的なプレイを通じてより高いスコアを達成できる。

#### 受入基準

1. 消去後にぷよが落下して4つ以上の新しいグループを形成したとき、システムは別の消去（連鎖反応）をトリガーする
2. 連鎖反応が発生したとき、システムは連鎖倍率でスコアを乗算する
3. 各後続の連鎖リンクが発生したとき、システムは連鎖倍率を指数関数的に増加させる
4. 連鎖反応が完了したとき、システムは総連鎖数とボーナススコアを表示する

### 要件7

**ユーザーストーリー:** プレイヤーとして、フィールドからすべてのぷよを消去したときにボーナスを受け取りたい。そうすることで、完全なフィールド管理に対して報酬を得られる。

#### 受入基準

1. プレイフィールドからすべてのぷよが消去されたとき、システムは「全消し」ボーナスを授与する
2. 全消しが発生したとき、システムはスコアに大幅なポイントボーナスを追加する
3. 全消しが発生したとき、システムは特別なアニメーションと効果音を再生する

### 要件8

**ユーザーストーリー:** プレイヤーとして、現在のスコアを見たい。そうすることで、ゲーム中のパフォーマンスを追跡できる。

#### 受入基準

1. ゲームがアクティブなとき、システムは現在のスコアを継続的に表示する
2. ポイントが獲得されたとき、システムはスコア表示をリアルタイムで更新する
3. 連鎖が発生したとき、システムは連鎖数と獲得したボーナスポイントを表示する

### 要件9

**ユーザーストーリー:** プレイヤーとして、フィールドが満杯になったときにゲームが終了してほしい。そうすることで、明確な勝敗条件がある。

#### 受入基準

1. 新しいぷよが上部境界を超えて配置できないとき、システムはゲームオーバーをトリガーする
2. ゲームオーバーが発生したとき、システムはプレイヤーの入力の受け付けを停止する
3. ゲームオーバーが発生したとき、システムは最終スコアとともにゲームオーバー画面を表示する
4. ゲームオーバーが発生したとき、システムは再開またはメニューに戻るオプションを提供する

### 要件10

**ユーザーストーリー:** プレイヤーとして、次のぷよペアを見たい。そうすることで、事前に戦略を計画できる。

#### 受入基準

1. ゲームがアクティブなとき、システムはプレビューエリアに次のぷよペアを表示する
2. 現在のぷよペアが配置されたとき、システムはプレビューを更新して次のペアを表示する
3. 次のぷよを表示するとき、システムは両方のぷよをデフォルトの垂直配置で表示する

### 要件11

**ユーザーストーリー:** プレイヤーとして、レスポンシブな視覚的フィードバックがほしい。そうすることで、ゲーム状態と自分のアクションを明確に理解できる。

#### 受入基準

1. ぷよが落下しているとき、システムはその動きを滑らかにアニメーションする
2. ぷよが消去されたとき、システムは消失アニメーションを再生する
3. 連鎖が発生したとき、システムは視覚効果で連鎖をハイライトする
4. ゲームフィールドが変化したとき、システムは滑らかな60fpsゲームプレイのために16ms以内に表示を更新する