#!/bin/sh
# pre-commit hook for Sales Management DB
# コミット前に品質チェックを自動実行

echo "pre-commit hook: 品質チェックを実行中..."

# PATHを設定
export PATH=$PATH:$(go env GOPATH)/bin

# just が利用可能か確認
if ! command -v just >/dev/null 2>&1; then
    echo "❌ just がインストールされていません"
    echo "インストール方法: brew install just または cargo install just"
    exit 1
fi

# コードフォーマットチェック
if ! just fmt >/dev/null 2>&1; then
    echo "❌ フォーマットエラーが検出されました"
    exit 1
fi

# 静的解析
if command -v golangci-lint >/dev/null 2>&1; then
    if ! just lint >/dev/null 2>&1; then
        echo "❌ 静的解析エラーが検出されました"
        exit 1
    fi
else
    echo "⚠️  golangci-lintがインストールされていません"
fi

# テスト実行
if ! just test >/dev/null 2>&1; then
    echo "❌ テストが失敗しました"
    exit 1
fi

echo "✅ 品質チェック完了 - コミット可能です"
exit 0
