<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.sales.domain.repository.OrderDetailMapper">

    <!-- ResultMap定義 -->
    <resultMap id="orderDetailResultMap" type="com.example.sales.domain.model.OrderDetail">
        <id property="orderNo" column="受注番号"/>
        <id property="orderRowNo" column="受注行番号"/>
        <result property="productCode" column="商品コード"/>
        <result property="productName" column="商品名"/>
        <result property="unitPrice" column="販売単価"/>
        <result property="quantity" column="受注数量"/>
        <result property="consumptionTaxRate" column="消費税率"/>
        <result property="reserveQuantity" column="引当数量"/>
        <result property="deliveryOrderQuantity" column="出荷指示数量"/>
        <result property="deliveredQuantity" column="出荷済数量"/>
        <result property="completeFlag" column="完了フラグ"/>
        <result property="discount" column="値引金額"/>
        <result property="deliveryDate" column="納期"/>
        <result property="createdAt" column="作成日時"/>
        <result property="createdBy" column="作成者名"/>
        <result property="updatedAt" column="更新日時"/>
        <result property="updatedBy" column="更新者名"/>
    </resultMap>

    <!-- INSERT -->
    <insert id="insert" parameterType="com.example.sales.domain.model.OrderDetail">
        INSERT INTO 受注データ明細 (
            受注番号,
            受注行番号,
            商品コード,
            商品名,
            販売単価,
            受注数量,
            消費税率,
            引当数量,
            出荷指示数量,
            出荷済数量,
            完了フラグ,
            値引金額,
            納期,
            作成者名,
            更新者名
        ) VALUES (
            #{orderNo},
            #{orderRowNo},
            #{productCode},
            #{productName},
            #{unitPrice},
            #{quantity},
            #{consumptionTaxRate},
            #{reserveQuantity},
            #{deliveryOrderQuantity},
            #{deliveredQuantity},
            #{completeFlag},
            #{discount},
            #{deliveryDate},
            #{createdBy},
            #{updatedBy}
        )
    </insert>

    <!-- UPDATE -->
    <update id="update" parameterType="com.example.sales.domain.model.OrderDetail">
        UPDATE 受注データ明細
        SET
            商品コード = #{productCode},
            商品名 = #{productName},
            販売単価 = #{unitPrice},
            受注数量 = #{quantity},
            消費税率 = #{consumptionTaxRate},
            引当数量 = #{reserveQuantity},
            出荷指示数量 = #{deliveryOrderQuantity},
            出荷済数量 = #{deliveredQuantity},
            完了フラグ = #{completeFlag},
            値引金額 = #{discount},
            納期 = #{deliveryDate},
            更新日時 = CURRENT_TIMESTAMP,
            更新者名 = #{updatedBy}
        WHERE
            受注番号 = #{orderNo}
            AND 受注行番号 = #{orderRowNo}
    </update>

    <!-- DELETE -->
    <delete id="delete">
        DELETE FROM 受注データ明細
        WHERE
            受注番号 = #{orderNo}
            AND 受注行番号 = #{orderRowNo}
    </delete>

    <!-- SELECT BY ID -->
    <select id="findById" resultMap="orderDetailResultMap">
        SELECT
            受注番号,
            受注行番号,
            商品コード,
            商品名,
            販売単価,
            受注数量,
            消費税率,
            引当数量,
            出荷指示数量,
            出荷済数量,
            完了フラグ,
            値引金額,
            納期,
            作成日時,
            作成者名,
            更新日時,
            更新者名
        FROM
            受注データ明細
        WHERE
            受注番号 = #{orderNo}
            AND 受注行番号 = #{orderRowNo}
    </select>

    <!-- SELECT BY ORDER NO -->
    <select id="findByOrderNo" resultMap="orderDetailResultMap">
        SELECT
            受注番号,
            受注行番号,
            商品コード,
            商品名,
            販売単価,
            受注数量,
            消費税率,
            引当数量,
            出荷指示数量,
            出荷済数量,
            完了フラグ,
            値引金額,
            納期,
            作成日時,
            作成者名,
            更新日時,
            更新者名
        FROM
            受注データ明細
        WHERE
            受注番号 = #{orderNo}
        ORDER BY
            受注行番号
    </select>

    <!-- SELECT BY PRODUCT CODE -->
    <select id="findByProductCode" resultMap="orderDetailResultMap">
        SELECT
            受注番号,
            受注行番号,
            商品コード,
            商品名,
            販売単価,
            受注数量,
            消費税率,
            引当数量,
            出荷指示数量,
            出荷済数量,
            完了フラグ,
            値引金額,
            納期,
            作成日時,
            作成者名,
            更新日時,
            更新者名
        FROM
            受注データ明細
        WHERE
            商品コード = #{productCode}
        ORDER BY
            受注番号, 受注行番号
    </select>

    <!-- SELECT ALL -->
    <select id="findAll" resultMap="orderDetailResultMap">
        SELECT
            受注番号,
            受注行番号,
            商品コード,
            商品名,
            販売単価,
            受注数量,
            消費税率,
            引当数量,
            出荷指示数量,
            出荷済数量,
            完了フラグ,
            値引金額,
            納期,
            作成日時,
            作成者名,
            更新日時,
            更新者名
        FROM
            受注データ明細
        ORDER BY
            受注番号, 受注行番号
    </select>

</mapper>
