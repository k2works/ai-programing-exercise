<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title th:text="${isNew} ? 'BOM 登録' : 'BOM 編集'">BOM 登録</title>
</head>
<body>
<div layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 th:text="${isNew} ? 'BOM 登録' : 'BOM 編集'">BOM 登録</h1>
        <a th:href="${bom.parentItemCode != null} ? @{/bom/{code}/children(code=${bom.parentItemCode})} : @{/bom}"
           class="btn btn-secondary">戻る</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form th:action="${isNew} ? @{/bom} : @{/bom/update}" method="post">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="parentItemCode" class="form-label">親品目コード <span class="text-danger">*</span></label>
                        <select class="form-select" id="parentItemCode" name="parentItemCode" required
                                th:disabled="${!isNew}">
                            <option value="">選択してください</option>
                            <option th:each="item : ${items}"
                                    th:value="${item.itemCode}"
                                    th:text="${item.itemCode + ' - ' + item.itemName}"
                                    th:selected="${item.itemCode == bom.parentItemCode}"></option>
                        </select>
                        <input th:if="${!isNew}" type="hidden" name="parentItemCode" th:value="${bom.parentItemCode}">
                    </div>
                    <div class="col-md-6">
                        <label for="childItemCode" class="form-label">子品目コード <span class="text-danger">*</span></label>
                        <select class="form-select" id="childItemCode" name="childItemCode" required
                                th:disabled="${!isNew}">
                            <option value="">選択してください</option>
                            <option th:each="item : ${items}"
                                    th:value="${item.itemCode}"
                                    th:text="${item.itemCode + ' - ' + item.itemName}"
                                    th:selected="${item.itemCode == bom.childItemCode}"></option>
                        </select>
                        <input th:if="${!isNew}" type="hidden" name="childItemCode" th:value="${bom.childItemCode}">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="effectiveFrom" class="form-label">適用開始日 <span class="text-danger">*</span></label>
                        <input type="date" class="form-control" id="effectiveFrom" name="effectiveFrom"
                               th:value="${bom.effectiveFrom}" required th:readonly="${!isNew}">
                        <input th:if="${!isNew}" type="hidden" name="effectiveFrom" th:value="${bom.effectiveFrom}">
                    </div>
                    <div class="col-md-6">
                        <label for="effectiveTo" class="form-label">適用停止日</label>
                        <input type="date" class="form-control" id="effectiveTo" name="effectiveTo"
                               th:value="${bom.effectiveTo}">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="baseQuantity" class="form-label">基準数量 <span class="text-danger">*</span></label>
                        <input type="number" step="0.01" class="form-control" id="baseQuantity" name="baseQuantity"
                               th:value="${bom.baseQuantity}" required min="0.01">
                    </div>
                    <div class="col-md-4">
                        <label for="requiredQuantity" class="form-label">必要数量 <span class="text-danger">*</span></label>
                        <input type="number" step="0.01" class="form-control" id="requiredQuantity" name="requiredQuantity"
                               th:value="${bom.requiredQuantity}" required min="0.01">
                    </div>
                    <div class="col-md-4">
                        <label for="defectRate" class="form-label">不良率（%）</label>
                        <input type="number" step="0.1" class="form-control" id="defectRate" name="defectRate"
                               th:value="${bom.defectRate}" min="0" max="100">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="sequence" class="form-label">工順</label>
                        <input type="number" class="form-control" id="sequence" name="sequence"
                               th:value="${bom.sequence}" min="1">
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-2">
                    <a th:href="${bom.parentItemCode != null} ? @{/bom/{code}/children(code=${bom.parentItemCode})} : @{/bom}"
                       class="btn btn-secondary">キャンセル</a>
                    <button type="submit" class="btn btn-primary"
                            th:text="${isNew} ? '登録' : '更新'">登録</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 入力ガイド -->
    <div class="card mt-4">
        <div class="card-header">入力ガイド</div>
        <div class="card-body">
            <ul class="mb-0">
                <li><strong>親品目コード</strong>：組み立てられる製品や半製品</li>
                <li><strong>子品目コード</strong>：親品目を構成する部品や材料</li>
                <li><strong>基準数量</strong>：親品目 1 単位を作るための基準（通常は 1）</li>
                <li><strong>必要数量</strong>：基準数量の親品目を作るために必要な子品目の数量</li>
                <li><strong>不良率</strong>：製造時に見込まれる不良率（%）</li>
                <li><strong>工順</strong>：組み立て順序（小さい番号が先）</li>
            </ul>
        </div>
    </div>
</div>
</body>
</html>
