<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>使用先照会</title>
</head>
<body>
<div layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>使用先照会</h1>
        <a th:href="@{/bom}" class="btn btn-secondary">一覧に戻る</a>
    </div>

    <!-- 対象品目情報 -->
    <div class="card mb-4">
        <div class="card-header">
            <strong th:text="${item.itemCode}"></strong> -
            <span th:text="${item.itemName}"></span>
            <span class="badge ms-2"
                  th:classappend="${item.itemCategory.name() == 'PRODUCT'} ? 'bg-primary' :
                                  (${item.itemCategory.name() == 'PART'} ? 'bg-success' : 'bg-secondary')"
                  th:text="${item.itemCategory.displayName}"></span>
        </div>
    </div>

    <!-- 使用先一覧 -->
    <div class="card">
        <div class="card-header">この品目を使用している親品目</div>
        <div class="card-body">
            <table class="table table-striped table-hover" th:if="${not #lists.isEmpty(parents)}">
                <thead>
                    <tr>
                        <th>親品目コード</th>
                        <th class="text-end">基準数量</th>
                        <th class="text-end">必要数量</th>
                        <th>有効開始日</th>
                        <th>有効終了日</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="parent : ${parents}">
                        <td>
                            <a th:href="@{/items/{code}(code=${parent.parentItemCode})}"
                               th:text="${parent.parentItemCode}"></a>
                        </td>
                        <td class="text-end" th:text="${parent.baseQuantity}"></td>
                        <td class="text-end" th:text="${parent.requiredQuantity}"></td>
                        <td th:text="${parent.effectiveFrom}"></td>
                        <td th:text="${parent.effectiveTo ?: '-'}"></td>
                        <td>
                            <a th:href="@{/bom/{code}/explode(code=${parent.parentItemCode})}"
                               class="btn btn-sm btn-outline-primary">BOM 展開</a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div th:if="${#lists.isEmpty(parents)}" class="alert alert-info">
                この品目は他の品目で使用されていません。
            </div>
        </div>
    </div>

    <!-- 件数表示 -->
    <div class="mt-3 text-muted" th:if="${not #lists.isEmpty(parents)}">
        全 <span th:text="${#lists.size(parents)}">0</span> 件
    </div>

    <!-- 関連リンク -->
    <div class="mt-4">
        <a th:href="@{/bom/{code}/explode(code=${item.itemCode})}"
           class="btn btn-outline-primary">BOM 展開</a>
    </div>
</div>
</body>
</html>
