generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider                         = "zod-prisma-types"
  output                           = "../src/generated/zod"
  createRelationValuesTypes        = true
  createPartialTypes               = true
  createOptionalDefaultValuesTypes = true
  useDecimalJs                     = true
  prismaJsonNullability            = true
}

generator comments {
  provider = "prisma-db-comments-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// 品目区分
enum ItemCategory {
  PRODUCT      @map("製品")
  SEMI_PRODUCT @map("半製品")
  INTERMEDIATE @map("中間品")
  PART         @map("部品")
  MATERIAL     @map("材料")
  RAW_MATERIAL @map("原料")
  SUPPLY       @map("資材")

  @@map("item_category")
}

/// 就業区分
enum WorkdayType {
  WORKING  @map("稼働日")
  HOLIDAY  @map("休日")
  HALF_DAY @map("半日")

  @@map("workday_type")
}

/// 取引先区分
enum SupplierType {
  CUSTOMER @map("得意先")
  VENDOR   @map("仕入先")
  BOTH     @map("得意先・仕入先")

  @@map("supplier_type")
}

/// 場所区分
enum LocationType {
  WAREHOUSE @map("倉庫")
  FACTORY   @map("工場")
  OFFICE    @map("事務所")
  EXTERNAL  @map("外部倉庫")

  @@map("location_type")
}

/// 単位マスタ
model Unit {
  /// 単位コード
  unitCode   String @id @map("unit_code") @db.VarChar(10)
  /// 単位記号
  unitSymbol String @map("unit_symbol") @db.VarChar(10)
  /// 単位名
  unitName   String @map("unit_name") @db.VarChar(50)

  /// 品目との関連
  items Item[]

  @@map("units")
}

/// 品目マスタ（生産管理システムの基本となる品目情報）
model Item {
  /// 品目ID（主キー）
  id              Int          @id @default(autoincrement())
  /// 品目コード
  itemCode        String       @unique @map("item_code") @db.VarChar(20)
  /// 適用開始日
  effectiveFrom   DateTime     @map("effective_from") @db.Date
  /// 適用停止日
  effectiveTo     DateTime?    @map("effective_to") @db.Date
  /// 品名
  itemName        String       @map("item_name") @db.VarChar(100)
  /// 品目区分
  itemCategory    ItemCategory @map("item_category")
  /// 単位コード（外部キー）
  unitCode        String?      @map("unit_code") @db.VarChar(10)
  /// リードタイム（日数）
  leadTime        Int          @default(0) @map("lead_time")
  /// 安全リードタイム（日数）
  safetyLeadTime  Int          @default(0) @map("safety_lead_time")
  /// 安全在庫数
  safetyStock     Decimal      @default(0) @map("safety_stock") @db.Decimal(15, 2)
  /// 歩留率（%）
  yieldRate       Decimal      @default(100) @map("yield_rate") @db.Decimal(5, 2)
  /// 最小ロット数
  minLotSize      Decimal      @default(1) @map("min_lot_size") @db.Decimal(15, 2)
  /// 刻みロット数
  lotIncrement    Decimal      @default(1) @map("lot_increment") @db.Decimal(15, 2)
  /// 最大ロット数
  maxLotSize      Decimal?     @map("max_lot_size") @db.Decimal(15, 2)
  /// 有効期間（日数）
  shelfLife       Int?         @map("shelf_life")
  /// 作成日時
  createdAt       DateTime     @default(now()) @map("created_at")
  /// 更新日時
  updatedAt       DateTime     @default(now()) @updatedAt @map("updated_at")

  /// 単位との関連
  unit Unit? @relation(fields: [unitCode], references: [unitCode])

  /// BOMの親品目として参照されている
  bomAsParent Bom[] @relation("ParentItem")
  /// BOMの子品目として参照されている
  bomAsChild Bom[] @relation("ChildItem")

  @@map("items")
}

/// BOM（部品構成表）
model Bom {
  /// 親品目コード
  parentItemCode   String   @map("parent_item_code") @db.VarChar(20)
  /// 子品目コード
  childItemCode    String   @map("child_item_code") @db.VarChar(20)
  /// 適用開始日
  effectiveFrom    DateTime @map("effective_from") @db.Date
  /// 適用停止日
  effectiveTo      DateTime? @map("effective_to") @db.Date
  /// 基準量（親品目の数量）
  baseQuantity     Decimal  @map("base_quantity") @db.Decimal(15, 2)
  /// 必要量（子品目の数量）
  requiredQuantity Decimal  @map("required_quantity") @db.Decimal(15, 2)
  /// 不良率（%）
  defectRate       Decimal  @default(0) @map("defect_rate") @db.Decimal(5, 2)
  /// 工順
  sequence         Int?     @map("sequence")

  /// 親品目との関連
  parentItem Item @relation("ParentItem", fields: [parentItemCode], references: [itemCode])
  /// 子品目との関連
  childItem  Item @relation("ChildItem", fields: [childItemCode], references: [itemCode])

  @@id([parentItemCode, childItemCode, effectiveFrom])
  @@map("bom")
}

/// シフトマスタ
model Shift {
  /// シフトコード
  shiftCode String   @id @map("shift_code") @db.VarChar(10)
  /// シフト名
  shiftName String   @map("shift_name") @db.VarChar(50)
  /// 開始時刻
  startTime DateTime @map("start_time") @db.Time()
  /// 終了時刻
  endTime   DateTime @map("end_time") @db.Time()

  /// 就業日との関連
  workdays Workday[]

  @@map("shifts")
}

/// 就業日マスタ
model Workday {
  /// 日付
  date        DateTime    @id @map("date") @db.Date
  /// 就業区分
  workdayType WorkdayType @map("workday_type")
  /// シフトコード
  shiftCode   String?     @map("shift_code") @db.VarChar(10)
  /// 備考
  note        String?     @map("note") @db.VarChar(200)
  /// 更新日時
  updatedAt   DateTime    @default(now()) @updatedAt @map("updated_at")

  /// シフトとの関連
  shift Shift? @relation(fields: [shiftCode], references: [shiftCode])

  @@map("workdays")
}

/// 部門マスタ
model Department {
  /// 部門コード
  departmentCode String   @map("department_code") @db.VarChar(10)
  /// 適用開始日
  effectiveFrom  DateTime @map("effective_from") @db.Date
  /// 適用停止日
  effectiveTo    DateTime? @map("effective_to") @db.Date
  /// 親部門コード
  parentCode     String?  @map("parent_code") @db.VarChar(10)
  /// 階層レベル
  level          Int      @map("level")
  /// 部門名
  departmentName String   @map("department_name") @db.VarChar(100)
  /// 略称
  shortName      String?  @map("short_name") @db.VarChar(50)
  /// 更新日時
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")

  @@id([departmentCode, effectiveFrom])
  @@map("departments")
}

/// 担当者マスタ
model Employee {
  /// 担当者コード
  employeeCode     String   @map("employee_code") @db.VarChar(10)
  /// 適用開始日
  effectiveFrom    DateTime @map("effective_from") @db.Date
  /// 適用停止日
  effectiveTo      DateTime? @map("effective_to") @db.Date
  /// 担当者名
  employeeName     String   @map("employee_name") @db.VarChar(100)
  /// 担当者名カナ
  employeeNameKana String?  @map("employee_name_kana") @db.VarChar(100)
  /// 部門コード（参照のみ、外部キー制約なし）
  departmentCode   String?  @map("department_code") @db.VarChar(10)
  /// メールアドレス
  email            String?  @map("email") @db.VarChar(100)
  /// 更新日時
  updatedAt        DateTime @default(now()) @updatedAt @map("updated_at")

  @@id([employeeCode, effectiveFrom])
  @@map("employees")
}

/// 取引先マスタ
model Supplier {
  /// 取引先コード
  supplierCode     String       @id @map("supplier_code") @db.VarChar(10)
  /// 取引先名
  supplierName     String       @map("supplier_name") @db.VarChar(100)
  /// 取引先名カナ
  supplierNameKana String?      @map("supplier_name_kana") @db.VarChar(100)
  /// 取引先区分
  supplierType     SupplierType @map("supplier_type")
  /// 郵便番号
  postalCode       String?      @map("postal_code") @db.VarChar(8)
  /// 住所
  address          String?      @map("address") @db.VarChar(200)
  /// 電話番号
  phone            String?      @map("phone") @db.VarChar(20)
  /// FAX番号
  fax              String?      @map("fax") @db.VarChar(20)
  /// メールアドレス
  email            String?      @map("email") @db.VarChar(100)
  /// 更新日時
  updatedAt        DateTime     @default(now()) @updatedAt @map("updated_at")

  @@map("suppliers")
}

/// 場所マスタ
model Location {
  /// 場所コード
  locationCode   String       @id @map("location_code") @db.VarChar(10)
  /// 場所名
  locationName   String       @map("location_name") @db.VarChar(100)
  /// 場所区分
  locationType   LocationType @map("location_type")
  /// 管理部門コード（参照のみ、外部キー制約なし）
  departmentCode String?      @map("department_code") @db.VarChar(10)
  /// 取引先コード（参照のみ、外部キー制約なし）
  supplierCode   String?      @map("supplier_code") @db.VarChar(10)
  /// 郵便番号
  postalCode     String?      @map("postal_code") @db.VarChar(8)
  /// 住所
  address        String?      @map("address") @db.VarChar(200)
  /// 電話番号
  phone          String?      @map("phone") @db.VarChar(20)
  /// 更新日時
  updatedAt      DateTime     @default(now()) @updatedAt @map("updated_at")

  @@map("locations")
}
