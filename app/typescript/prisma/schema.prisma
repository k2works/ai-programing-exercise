generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider                         = "zod-prisma-types"
  output                           = "../src/generated/zod"
  createRelationValuesTypes        = true
  createPartialTypes               = true
  createOptionalDefaultValuesTypes = true
  useDecimalJs                     = true
  prismaJsonNullability            = true
}

generator comments {
  provider = "prisma-db-comments-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// 勘定科目マスタ（財務会計システムの基本となる勘定科目情報）
model Account {
  /// 勘定科目ID（主キー）
  id          Int         @id @default(autoincrement()) @map("勘定科目ID")
  /// 勘定科目コード（例：1000, 2000）
  code        String      @unique @map("勘定科目コード") @db.VarChar(20)
  /// 勘定科目名（例：現金、売掛金）
  name        String      @map("勘定科目名") @db.VarChar(100)
  /// 勘定科目種別（資産、負債、純資産、収益、費用）
  accountType AccountType @map("勘定科目種別")
  /// 残高
  balance     Decimal     @default(0) @map("残高") @db.Decimal(15, 2)
  /// 課税取引コード
  taxCode     String?     @map("課税取引コード") @db.VarChar(2)
  /// 作成日時
  createdAt   DateTime    @default(now()) @map("作成日時")
  /// 更新日時
  updatedAt   DateTime    @updatedAt @map("更新日時")

  // リレーション
  taxTransaction TaxTransaction?  @relation(fields: [taxCode], references: [taxCode])
  structure      AccountStructure?

  @@index([taxCode], map: "idx_tax_code")
  @@map("勘定科目マスタ")
}

/// 課税取引マスタ（消費税計算のための課税区分情報）
model TaxTransaction {
  /// 課税取引コード（主キー）
  taxCode     String    @id @map("課税取引コード") @db.VarChar(2)
  /// 課税取引名
  taxName     String    @map("課税取引名") @db.VarChar(40)
  /// 税率（%）
  taxRate     Float     @map("税率") @db.Real
  /// 課税区分（課税、非課税、免税、不課税）
  taxType     String    @map("課税区分") @db.VarChar(10)
  /// 説明
  description String?   @map("説明") @db.VarChar(200)
  /// 適用開始日
  validFrom   DateTime? @map("適用開始日")
  /// 適用終了日
  validTo     DateTime? @map("適用終了日")
  /// 作成日時
  createdAt   DateTime  @default(now()) @map("作成日時")
  /// 更新日時
  updatedAt   DateTime  @updatedAt @map("更新日時")

  // リレーション
  accounts Account[]

  @@index([taxType], map: "idx_tax_type")
  @@index([validFrom, validTo], map: "idx_valid_period")
  @@map("課税取引マスタ")
}

/// 勘定科目構成マスタ（チルダ連結方式による階層構造管理）
model AccountStructure {
  /// 勘定科目コード（主キー、外部キー）
  accountCode String   @id @map("勘定科目コード") @db.VarChar(20)
  /// 勘定科目パス（チルダ連結、例：11^11000^11190^11110）
  accountPath String   @map("勘定科目パス") @db.VarChar(200)
  /// 作成日時
  createdAt   DateTime @default(now()) @map("作成日時")
  /// 更新日時
  updatedAt   DateTime @updatedAt @map("更新日時")

  // リレーション
  account Account @relation(fields: [accountCode], references: [code], onDelete: Cascade)

  @@index([accountPath], map: "idx_account_path")
  @@map("勘定科目構成マスタ")
}

/// 勘定科目種別（Assets: 資産, Liabilities: 負債, Equity: 純資産, Revenue: 収益, Expense: 費用）
enum AccountType {
  ASSET     @map("資産")
  LIABILITY @map("負債")
  EQUITY    @map("純資産")
  REVENUE   @map("収益")
  EXPENSE   @map("費用")

  @@map("account_type")
}
