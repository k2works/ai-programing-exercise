# Chapter 7: アクションゲームアプリケーション開発TODO

## プロジェクト概要
テスト駆動開発（TDD）を用いてPyxelベースのアクションゲーム「Cursed Caverns」を作成します。
プレイヤーが洞窟を探索し、宝石を集めて出口を目指す本格的な2Dアクションゲームです。

## ✅ 完成済み機能

### 1. ゲーム基本システム
- [x] ゲームクラスの初期化（画面サイズ、タイトル設定）
- [x] シーン管理システム（タイトル、プレイ、ゲームオーバー、クリア）
- [x] ゲームループの基本構造（update、draw）
- [x] スコア管理機能

### 2. プレイヤー機能
- [x] プレイヤーキャラクターの初期化（位置、当たり判定）
- [x] キーボード・ゲームパッド入力による移動制御
- [x] ジャンプアクション（重力、加速度）
- [x] アニメーション（歩行、ジャンプ）
- [x] 画面境界制限処理

### 3. ワールド・レベルデザイン
- [x] タイルマップシステム
- [x] スクロール機能（カメラ制御）
- [x] タイル種別定義（壁、床、宝石、出口、ギミック）
- [x] 衝突判定システム（タイルベース）
- [x] プッシュバック処理

### 4. ゲームオブジェクト
- [x] 宝石システム（収集、スコア加算）
- [x] キノコ（ジャンプパッド）
- [x] 危険物（トゲ、溶岩）
- [x] 出口（ゴール判定）

### 5. 敵キャラクター
- [x] スライム（グリーン・レッド）
- [x] マミー（追跡AI）
- [x] フラワー（遠距離攻撃）
- [x] 敵の基本AI（移動パターン）
- [x] プレイヤーとの衝突判定

### 6. メインアプリケーション統合
- [x] 全機能を統合したメインアプリケーション
- [x] エラーハンドリング
- [x] リソースファイル管理
- [x] ユーザーレビュー対応（ジャンプ機能修正）

## 📊 開発実績

### テスト結果
- **テストケース数**: 74個（100%通過）
- **テストカバレッジ**: 83%
- **循環的複雑度**: 全関数7以下
- **静的解析**: Ruff、mypy完全通過

## 🚀 拡張可能機能（将来的実装）

### 6. サウンドシステム
- [ ] 効果音システム（ジャンプ、宝石取得、ダメージ）
- [ ] BGM再生機能
- [ ] サウンド管理

### 7. ビジュアルエフェクト
- [ ] スプライトアニメーション
- [ ] パーティクルエフェクト
- [ ] 画面エフェクト

### 8. ゲーム進行管理
- [ ] シーン遷移管理
- [ ] ゲームオーバー条件
- [ ] クリア条件
- [ ] リトライ機能

### 9. 統合とデモ
- [ ] 全機能を統合したメインアプリケーション
- [ ] ゲームバランスの調整
- [ ] エラーハンドリング
- [ ] リソースファイル管理

## 開発フェーズ

### Phase 1: 基礎システム
1. ゲーム基本構造
2. プレイヤー基本機能
3. タイルマップシステム

### Phase 2: ゲームメカニクス
4. 衝突判定システム
5. ゲームオブジェクト
6. スクロール機能

### Phase 3: 完成度向上
7. 敵キャラクター
8. サウンドシステム
9. 統合とバランス調整

## 技術的要件

### TDD実践ルール
- 各機能は必ずテストファーストで実装
- Red-Green-Refactorサイクルを厳守
- テストカバレッジ90%以上を目指す
- 循環的複雑度7以下を維持

### 品質保証
- Ruffによるコード品質チェック
- mypyによる型チェック
- pytestによる包括的テスト

### アーキテクチャ
- オブジェクト指向設計: 各ゲーム要素を独立したクラスとして実装
- 責任分離: ゲームロジック、描画処理、入力処理の分離
- テスト容易性: 外部依存を最小限に抑えたテスト設計

## ゲーム仕様

### 操作方法
- **左右矢印キー / ゲームパッド**: プレイヤー移動
- **スペースキー / Bボタン**: ジャンプ
- **ESCキー**: ゲーム終了

### ゲーム要素
- **プレイヤー**: 8x8ピクセルのキャラクター
- **敵キャラクター**: 4種類の異なる行動パターン
- **宝石**: 収集してスコア獲得
- **ギミック**: キノコ、トゲ、溶岩、出口

### 物理パラメータ
- プレイヤー移動速度: 2ピクセル/フレーム
- ジャンプ力: -6ピクセル/フレーム
- 重力加速度: 1ピクセル/フレーム²
- 最大落下速度: 4ピクセル/フレーム

### 画面仕様
- 画面サイズ: 128x128ピクセル
- フレームレート: 60fps
- タイトル: "Cursed Caverns"

## アセット要件

### スプライト
- プレイヤーキャラクター（アニメーション）
- 4種類の敵キャラクター
- タイルセット（地形、ギミック）
- UI要素

### サウンド
- BGM（タイトル、ゲーム中）
- 効果音（ジャンプ、宝石取得、ダメージ）

### マップデータ
- Pyxelリソースファイル（.pyxres）
- タイルマップデータ

## 想定される課題と対策

### 技術的課題
1. **タイルベース衝突判定**: 正確で効率的な判定処理
   - 対策: グリッドベースのAABB衝突判定
2. **スクロール処理**: 滑らかなカメラ制御
   - 対策: カメラ境界とプレイヤー位置の連動
3. **敵AI**: 自然な移動パターン
   - 対策: ステートマシンによる行動制御

### 開発上の課題
1. **アセット依存**: リソースファイルのテスト
   - 対策: モック・スタブを活用した単体テスト
2. **フレームレート依存**: ゲーム速度の一定性
   - 対策: 時間ベースの更新処理
3. **統合の複雑性**: 複数システムの連携
   - 対策: 段階的統合とインクリメンタル開発