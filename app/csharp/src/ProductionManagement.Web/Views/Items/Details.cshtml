@model ProductionManagement.Web.Models.ItemViewModel
@{
    ViewData["Title"] = "品目詳細";
}

<div class="row mb-3">
    <div class="col">
        <h2><i class="bi bi-info-circle me-2"></i>品目詳細</h2>
    </div>
    <div class="col-auto">
        <a asp-action="Edit" asp-route-id="@Model.ItemCode" class="btn btn-primary">
            <i class="bi bi-pencil me-1"></i>編集
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">@Model.ItemCode - @Model.ItemName</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6 class="text-muted mb-3">基本情報</h6>
                <dl class="row">
                    <dt class="col-sm-5">品目コード</dt>
                    <dd class="col-sm-7">@Model.ItemCode</dd>

                    <dt class="col-sm-5">品目名</dt>
                    <dd class="col-sm-7">@Model.ItemName</dd>

                    <dt class="col-sm-5">品目区分</dt>
                    <dd class="col-sm-7">
                        <span class="badge @GetCategoryBadgeClass(Model.ItemCategory)">
                            @Model.ItemCategoryDisplayName
                        </span>
                    </dd>

                    <dt class="col-sm-5">単位</dt>
                    <dd class="col-sm-7">@(Model.UnitCode ?? "-")</dd>
                </dl>
            </div>

            <div class="col-md-6">
                <h6 class="text-muted mb-3">リードタイム</h6>
                <dl class="row">
                    <dt class="col-sm-5">リードタイム</dt>
                    <dd class="col-sm-7">@Model.LeadTime 日</dd>

                    <dt class="col-sm-5">安全リードタイム</dt>
                    <dd class="col-sm-7">@Model.SafetyLeadTime 日</dd>

                    <dt class="col-sm-5">安全在庫</dt>
                    <dd class="col-sm-7">@Model.SafetyStock.ToString("N2")</dd>

                    <dt class="col-sm-5">歩留率</dt>
                    <dd class="col-sm-7">@Model.YieldRate.ToString("N1") %</dd>
                </dl>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="col-md-6">
                <h6 class="text-muted mb-3">ロット情報</h6>
                <dl class="row">
                    <dt class="col-sm-5">最小ロットサイズ</dt>
                    <dd class="col-sm-7">@Model.MinLotSize.ToString("N3")</dd>

                    <dt class="col-sm-5">ロット増分</dt>
                    <dd class="col-sm-7">@Model.LotIncrement.ToString("N3")</dd>

                    <dt class="col-sm-5">最大ロットサイズ</dt>
                    <dd class="col-sm-7">@(Model.MaxLotSize?.ToString("N3") ?? "-")</dd>

                    <dt class="col-sm-5">有効期限</dt>
                    <dd class="col-sm-7">@(Model.ShelfLife.HasValue ? $"{Model.ShelfLife} 日" : "-")</dd>
                </dl>
            </div>

            <div class="col-md-6">
                <h6 class="text-muted mb-3">有効期間・登録情報</h6>
                <dl class="row">
                    <dt class="col-sm-5">有効開始日</dt>
                    <dd class="col-sm-7">@Model.EffectiveFrom.ToString("yyyy/MM/dd")</dd>

                    <dt class="col-sm-5">有効終了日</dt>
                    <dd class="col-sm-7">@(Model.EffectiveTo?.ToString("yyyy/MM/dd") ?? "-")</dd>

                    <dt class="col-sm-5">作成日時</dt>
                    <dd class="col-sm-7">@Model.CreatedAt.ToString("yyyy/MM/dd HH:mm")</dd>

                    <dt class="col-sm-5">更新日時</dt>
                    <dd class="col-sm-7">@Model.UpdatedAt.ToString("yyyy/MM/dd HH:mm")</dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="mt-3 d-flex justify-content-between">
    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>一覧に戻る
    </a>
    <a asp-action="Delete" asp-route-id="@Model.ItemCode" class="btn btn-outline-danger">
        <i class="bi bi-trash me-1"></i>削除
    </a>
</div>

@functions {
    string GetCategoryBadgeClass(ProductionManagement.Domain.Models.Item.ItemCategory category)
    {
        return category switch
        {
            ProductionManagement.Domain.Models.Item.ItemCategory.Product => "bg-primary",
            ProductionManagement.Domain.Models.Item.ItemCategory.SemiProduct => "bg-info",
            ProductionManagement.Domain.Models.Item.ItemCategory.Intermediate => "bg-secondary",
            ProductionManagement.Domain.Models.Item.ItemCategory.Part => "bg-warning text-dark",
            ProductionManagement.Domain.Models.Item.ItemCategory.Material => "bg-success",
            ProductionManagement.Domain.Models.Item.ItemCategory.RawMaterial => "bg-dark",
            ProductionManagement.Domain.Models.Item.ItemCategory.Supply => "bg-light text-dark",
            _ => "bg-secondary"
        };
    }
}
