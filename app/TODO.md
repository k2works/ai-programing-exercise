# ぷよぷよアプリケーション - TODOリスト

本TODOリストは、`docs/requirements/仕様.md` を基に、テスト駆動開発（TDD）のアプローチで段階的に実装するためのタスクを整理したものです。

## 🎯 実装フェーズ概要

### Phase 1: 基盤システム (Foundation)
基本的なゲームボードとぷよの表現を確立

### Phase 2: ぷよ管理システム (Puyo Management)
ぷよの生成、配置、移動の基本機能

### Phase 3: ゲームロジック (Game Logic)
ぷよの消去、連鎖、スコア計算の実装

### Phase 4: ユーザーインターフェース (User Interface)
キーボード・タッチ操作とゲーム状態表示

### Phase 5: ゲームフロー (Game Flow)
ゲーム開始、終了、リスタートの機能

### Phase 6: 高度な機能 (Advanced Features)
連鎖演出、全消しボーナス、その他の拡張機能

---

## 📋 詳細TODOリスト

### Phase 1: 基盤システム (Foundation)

#### 1.1 ゲームボード実装
- [ ] **T001**: ゲームボードの作成（6x12マス）
  - [ ] 空のボードを生成する関数を実装
  - [ ] ボードの座標システム（x: 0-5, y: 0-12）を定義
  - [ ] 座標の有効性チェック機能
  - [ ] ボードの状態を文字列で表示する機能（デバッグ用）

#### 1.2 ぷよの基本実装
- [ ] **T002**: ぷよの基本データ構造
  - [ ] ぷよの色を表現する列挙型（赤、青、緑、黄、紫）
  - [ ] ぷよの位置を表現する座標構造
  - [ ] ぷよの基本プロパティ（色、座標）

#### 1.3 組ぷよ実装
- [ ] **T003**: 組ぷよ（2個セット）の実装
  - [ ] 2つのぷよで構成される組ぷよ構造
  - [ ] 組ぷよの回転状態（0°, 90°, 180°, 270°）
  - [ ] 組ぷよの相対位置計算

#### 1.4 ボード操作
- [ ] **T004**: ボードへのぷよ配置
  - [ ] ボードの指定位置にぷよを配置する機能
  - [ ] ボードの指定位置からぷよを取得する機能
  - [ ] ボードの指定位置が空かどうかチェックする機能

### Phase 2: ぷよ管理システム (Puyo Management)

#### 2.1 ぷよ生成システム
- [ ] **T005**: ランダムなぷよ生成
  - [ ] ランダムな色のぷよを生成する機能
  - [ ] 組ぷよをランダム生成する機能
  - [ ] NEXTぷよの管理機能

#### 2.2 ぷよの移動
- [ ] **T006**: 組ぷよの基本移動
  - [ ] 組ぷよを左に移動する機能
  - [ ] 組ぷよを右に移動する機能
  - [ ] 移動可能性のチェック（境界、他のぷよとの衝突）

#### 2.3 ぷよの回転
- [ ] **T007**: 組ぷよの回転
  - [ ] 組ぷよを時計回りに回転する機能
  - [ ] 回転可能性のチェック（境界、他のぷよとの衝突）
  - [ ] 回転時の壁蹴り（kick）機能

#### 2.4 ぷよの落下
- [ ] **T008**: ぷよの重力システム
  - [ ] 組ぷよの自然落下（重力）
  - [ ] 高速落下（ソフトドロップ）機能
  - [ ] 瞬間落下（ハードドロップ）機能
  - [ ] 落下停止条件の判定

#### 2.5 ぷよの固定
- [ ] **T009**: ぷよの固定処理
  - [ ] 組ぷよがボードに固定される条件判定
  - [ ] 固定時の各ぷよの個別配置
  - [ ] 浮いているぷよの落下処理

### Phase 3: ゲームロジック (Game Logic)

#### 3.1 ぷよの消去判定
- [ ] **T010**: 隣接ぷよの検索
  - [ ] 指定位置から同色のぷよを探索する機能（幅優先探索）
  - [ ] 4つ以上の隣接ぷよグループの検出
  - [ ] 消去対象ぷよの特定

#### 3.2 ぷよの消去実行
- [ ] **T011**: ぷよ消去の実行
  - [ ] 消去対象ぷよをボードから削除
  - [ ] 消去されたぷよの数をカウント
  - [ ] 消去後のボード状態更新

#### 3.3 連鎖システム
- [ ] **T012**: 連鎖の実装
  - [ ] 消去後のぷよ落下処理
  - [ ] 連鎖回数のカウント
  - [ ] 連鎖の再帰的実行
  - [ ] 連鎖終了条件の判定

#### 3.4 スコア計算
- [ ] **T013**: 基本スコア計算
  - [ ] 消去ぷよ数に基づくベーススコア
  - [ ] 連鎖倍率の計算
  - [ ] 同時消し倍率の計算
  - [ ] 色数ボーナスの計算

#### 3.5 全消し判定
- [ ] **T014**: 全消し（ぜんけし）ボーナス
  - [ ] ボードが完全に空になったかの判定
  - [ ] 全消しボーナススコアの計算
  - [ ] 全消しフラグの管理

### Phase 4: ユーザーインターフェース (User Interface)

#### 4.1 ゲーム状態表示
- [ ] **T015**: ゲーム画面の描画
  - [ ] ボードの視覚的表示（HTML5 Canvas）
  - [ ] ぷよの色別表示
  - [ ] 現在の組ぷよの表示
  - [ ] NEXTぷよの表示

#### 4.2 スコア・ステータス表示
- [ ] **T016**: ゲーム情報の表示
  - [ ] 現在のスコア表示
  - [ ] 連鎖数の表示
  - [ ] レベル・難易度の表示
  - [ ] ゲーム時間の表示

#### 4.3 キーボード操作
- [ ] **T017**: キーボード入力処理
  - [ ] 左右矢印キーでの移動
  - [ ] 上矢印キーでの回転
  - [ ] 下矢印キーでの高速落下
  - [ ] スペースキーでの瞬間落下

#### 4.4 タッチ操作（オプション）
- [ ] **T018**: タッチ・マウス操作
  - [ ] タップでの回転
  - [ ] スワイプでの移動
  - [ ] 長押しでの高速落下

### Phase 5: ゲームフロー (Game Flow)

#### 5.1 ゲーム開始
- [ ] **T019**: ゲーム初期化
  - [ ] 新しいゲームの開始処理
  - [ ] ゲーム状態の初期化
  - [ ] 最初の組ぷよの生成

#### 5.2 ゲームオーバー
- [ ] **T020**: ゲーム終了判定
  - [ ] ゲームオーバー条件の判定（ぷよがフィールド上部に達する）
  - [ ] ゲームオーバー時の処理
  - [ ] ゲーム結果の表示

#### 5.3 ゲーム制御
- [ ] **T021**: ゲーム制御機能
  - [ ] ゲームの一時停止機能
  - [ ] ゲームのリスタート機能
  - [ ] ゲーム設定の管理

### Phase 6: 高度な機能 (Advanced Features)

#### 6.1 演出システム
- [ ] **T022**: ゲーム演出
  - [ ] ぷよ消去時のアニメーション
  - [ ] 連鎖時の特殊演出
  - [ ] 全消し時の特殊演出

#### 6.2 サウンド（オプション）
- [ ] **T023**: 効果音システム
  - [ ] ぷよ移動音
  - [ ] ぷよ消去音
  - [ ] 連鎖音
  - [ ] BGM管理

#### 6.3 難易度調整
- [ ] **T024**: ゲームバランス
  - [ ] 落下速度の調整
  - [ ] ぷよ色数の設定
  - [ ] スコア倍率の調整

---

## 🔄 TDD実装サイクル

各TODOアイテムに対して以下のサイクルを実行：

1. **Red**: 機能のテストを書く（失敗する）
2. **Green**: テストを通すための最小限の実装
3. **Refactor**: コードの品質向上（重複排除、可読性向上）

## 📊 進捗管理

### Phase 1: 基盤システム (3/4 completed - 75%)
- [x] **T001**: ゲームボードの作成（8x12マス）※実装済み
  - [x] 空のボードを生成する関数を実装
  - [x] ボードの座標システム（x: 0-7, y: 0-11）を定義
  - [x] 座標の有効性チェック機能
  - [x] ボードの状態を文字列で表示する機能（デバッグ用）

- [x] **T002**: ぷよの基本データ構造 ※実装済み
  - [x] ぷよの色を表現する列挙型（赤、青、緑、黄、紫）
  - [x] ぷよの位置を表現する座標構造
  - [x] ぷよの基本プロパティ（色、座標）

- [ ] **T003**: 組ぷよ（2個セット）の実装
  - [ ] 2つのぷよで構成される組ぷよ構造
  - [ ] 組ぷよの回転状態（0°, 90°, 180°, 270°）
  - [ ] 組ぷよの相対位置計算

- [x] **T004**: ボードへのぷよ配置 ※実装済み
  - [x] ボードの指定位置にぷよを配置する機能
  - [x] ボードの指定位置からぷよを取得する機能
  - [x] ボードの指定位置が空かどうかチェックする機能

### Phase 2: ぷよ管理システム (0/5 completed - 0%)
- [ ] **T005**: ランダムなぷよ生成
- [ ] **T006**: 組ぷよの基本移動
- [ ] **T007**: 組ぷよの回転
- [ ] **T008**: ぷよの重力システム
- [ ] **T009**: ぷよの固定処理

### Phase 3: ゲームロジック (0/5 completed - 0%)
- [ ] **T010**: 隣接ぷよの検索
- [ ] **T011**: ぷよ消去の実行
- [ ] **T012**: 連鎖システム
- [ ] **T013**: 基本スコア計算
- [ ] **T014**: 全消し（ぜんけし）ボーナス

### Phase 4: ユーザーインターフェース (2/4 completed - 50%)
- [x] **T015**: ゲーム画面の描画 ※一部実装済み
  - [x] ボードの視覚的表示（HTML5 Canvas）
  - [x] ぷよの色別表示
  - [ ] 現在の組ぷよの表示
  - [ ] NEXTぷよの表示

- [x] **T016**: ゲーム情報の表示 ※一部実装済み
  - [x] 現在のスコア表示
  - [ ] 連鎖数の表示
  - [x] レベル・難易度の表示
  - [ ] ゲーム時間の表示

- [ ] **T017**: キーボード入力処理 ※一部実装済み（イベントハンドラのみ）
  - [ ] 左右矢印キーでの移動
  - [ ] 上矢印キーでの回転
  - [ ] 下矢印キーでの高速落下
  - [ ] スペースキーでの瞬間落下

- [ ] **T018**: タッチ・マウス操作
  - [ ] タップでの回転
  - [ ] スワイプでの移動
  - [ ] 長押しでの高速落下

### Phase 5: ゲームフロー (2/3 completed - 67%)
- [x] **T019**: ゲーム初期化 ※実装済み
  - [x] 新しいゲームの開始処理
  - [x] ゲーム状態の初期化
  - [ ] 最初の組ぷよの生成

- [ ] **T020**: ゲーム終了判定
  - [ ] ゲームオーバー条件の判定（ぷよがフィールド上部に達する）
  - [ ] ゲームオーバー時の処理
  - [ ] ゲーム結果の表示

- [x] **T021**: ゲーム制御機能 ※一部実装済み
  - [ ] ゲームの一時停止機能
  - [x] ゲームのリスタート機能
  - [ ] ゲーム設定の管理

### Phase 6: 高度な機能 (0/3 completed - 0%)
- [ ] **T022**: ゲーム演出
- [ ] **T023**: 効果音システム
- [ ] **T024**: ゲームバランス

**総合進捗: 7/24 phases completed (29%)**

### 🎯 現在の実装状況サマリー

#### ✅ 完了済み機能
1. **基本ゲームボード**: 8x12マスのゲームボード作成・管理
2. **ぷよ色システム**: 5色（赤、緑、青、黄、紫）の色定義
3. **ゲーム状態管理**: スコア、レベル、ゲーム実行状態の管理
4. **Canvas描画**: HTML5 Canvasによるボード描画
5. **基本UI**: スコア・レベル表示
6. **ゲーム制御**: 開始・リセット機能
7. **イベントハンドラ**: キーボード入力の受付（処理は未実装）

#### 🚧 次に実装すべき機能（優先度順）
1. **組ぷよシステム**: 2つのぷよで構成される基本単位
2. **ぷよ生成**: ランダムな色の組ぷよ生成
3. **ぷよ移動**: 左右移動と回転の実装
4. **重力システム**: ぷよの落下処理
5. **ぷよ固定**: ボードへの配置処理

#### 📏 品質指標
- **テストカバレッジ**: 基本機能（ボード、色、状態管理）
- **現在のテスト数**: 6テスト、25アサーション
- **品質チェック**: 全項目パス（0エラー、0警告）

---

## 📝 注意事項

- 各タスクは独立してテスト可能な単位で分割されています
- 実装順序は依存関係を考慮していますが、必要に応じて調整可能です
- テストファースト（Test-First）のアプローチを維持してください
- 各フェーズ完了時に統合テストを実行することを推奨します

### ⚠️ 仕様との相違点

**ボードサイズ**: 
- 仕様書: 6x12マス
- 現在の実装: 8x12マス

この相違により、以下の調整が必要になる可能性があります：
- ゲームバランス（難易度）の調整
- UI表示領域の最適化
- スコア計算アルゴリズムの見直し

### 🔄 次回開発セッションの推奨タスク

**Priority 1: 組ぷよシステムの実装 (T003)**
```clojure
;; 実装すべき構造例
(def puyo-pair {:puyo1 {:color 1 :x 3 :y 0}
                :puyo2 {:color 2 :x 3 :y 1}
                :rotation 0})  ; 0=縦, 1=右, 2=逆, 3=左
```

**Priority 2: ぷよ生成システムの実装 (T005)**
```clojure
;; 実装すべき関数例
(defn generate-random-puyo-pair []
  "ランダムな色の組ぷよを生成")

(defn setup-next-puyo []
  "NEXTぷよの管理")
```
