Feature: 予約キャンセル機能

  Background:
    Given システムに以下のユーザーが存在する:
      | userId | name     | password | role  |
      | taro   | 山田太郎 | pass123  | USER  |
      | hanako | 田中花子 | pass456  | USER  |
      | admin  | 管理者   | admin123 | ADMIN |
    And 以下の会議室が予約可能である:
      | roomId | roomName | date       |
      | 1      | 会議室A  | 2025-09-03 |

  Scenario: 本人による予約キャンセル
    Given ユーザー "taro" としてログインしている
    And ユーザー "taro" が会議室 1 を "2025-09-03" の "14:00" から "15:00" まで予約済み
    When 予約をキャンセルする
    Then レスポンスステータスは 204 である
    And 予約が削除されている

  Scenario: 他人の予約をキャンセルしようとして失敗
    Given ユーザー "taro" が会議室 1 を "2025-09-03" の "14:00" から "15:00" まで予約済み
    And ユーザー "hanako" としてログインしている
    When 他人の予約をキャンセルしようとする
    Then レスポンスステータスは 403 である
    And エラーメッセージ "他人の予約はキャンセルできません。" が返される
    And 予約がまだ存在している

  Scenario: 管理者による他人の予約キャンセル
    Given ユーザー "taro" が会議室 1 を "2025-09-03" の "14:00" から "15:00" まで予約済み
    And ユーザー "admin" としてログインしている
    When 予約をキャンセルする
    Then レスポンスステータスは 204 である
    And 予約が削除されている

  Scenario: 存在しない予約をキャンセルしようとして失敗
    Given ユーザー "taro" としてログインしている
    When 存在しない予約ID 999999 をキャンセルしようとする
    Then レスポンスステータスは 404 である

  Scenario: 認証なしで予約キャンセルを試みて失敗
    Given ユーザー "taro" が会議室 1 を "2025-09-03" の "14:00" から "15:00" まで予約済み
    When 認証なしで予約をキャンセルしようとする
    Then レスポンスステータスは 401 である
    And 予約がまだ存在している