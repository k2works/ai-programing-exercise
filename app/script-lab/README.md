# Excel Script-Lab クライアント

Excel Script-Labを使用してDDD書籍管理システムのAPIを呼び出すクライアントです。

## セットアップ

### 1. APIサーバーの起動

```bash
# データベースを起動
cd app
docker compose up -d

# マイグレーション実行
npm run migrate:dev

# APIサーバーを起動
npm run dev
```

APIサーバーは http://localhost:3000 で起動します。

### 2. Script-Labのインストール

1. Excelを開く
2. 「挿入」タブから「アドインを入手」をクリック
3. 「Script Lab」を検索してインストール

### 3. スニペットのインポート

1. Excelで Script Lab を開く
2. 「Import」ボタンをクリック
3. `book-registration-client.yaml` ファイルの内容をコピー＆ペースト
4. 「Import」をクリック

## 使い方

### 書籍の登録

1. ISBN、タイトル、価格を入力
2. 「登録」ボタンをクリック
3. 成功メッセージが表示されます

例:
- ISBN: `9784167158057`
- タイトル: `吾輩は猫である`
- 価格: `770`

### 書籍の取得とシートへの出力

1. ISBNを入力
2. 「取得してシートに出力」ボタンをクリック
3. アクティブなワークシートに書籍情報が出力されます

**出力形式:**
- 1行目: ヘッダー（ISBN、タイトル、価格、在庫ID、在庫数、ステータス）
- 2行目以降: データ
- 同じISBNが既に存在する場合は更新されます

### シートのクリア

「シートをクリア」ボタンでアクティブシートの全データをクリアできます。

### 一括登録

シートに入力されている書籍データを一括で登録します。

**必要なカラム:**
- ISBN
- タイトル
- 価格

**手順:**
1. シートに上記のヘッダーを含むデータを用意
2. 「シートから一括登録」ボタンをクリック
3. 各行のデータが順次APIに送信されます
4. 結果（成功件数、エラー件数）が表示されます

### 一括取得

シートに入力されているISBNを元に、書籍情報を一括で取得して更新します。

**必要なカラム:**
- ISBN

**手順:**
1. シートにISBNカラムを含むデータを用意
2. 「シートのISBNから一括取得」ボタンをクリック
3. 各ISBNの書籍情報が取得され、該当行が更新されます
4. 結果（成功件数、エラー件数）が表示されます

## API エンドポイント

### POST /book
書籍を登録

**リクエスト:**
```json
{
  "isbn": "9784167158057",
  "title": "吾輩は猫である",
  "priceAmount": 770
}
```

**レスポンス:**
```json
{
  "message": "success"
}
```

### GET /book/:isbn
書籍を取得

**レスポンス:**
```json
{
  "bookId": "9784167158057",
  "title": "吾輩は猫である",
  "price": 770,
  "stockId": "xxx",
  "quantityAvailable": 0,
  "status": "在庫切れ"
}
```

## トラブルシューティング

### CORSエラーが発生する場合

APIサーバーにCORS設定が追加されているか確認してください。

### 通信エラーが発生する場合

- APIサーバーが起動しているか確認
- データベースが起動しているか確認
- ブラウザのコンソールでエラーメッセージを確認
